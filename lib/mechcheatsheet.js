var yt=Object.defineProperty;var _t=(e,t,s)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var U=(e,t,s)=>_t(e,typeof t!="symbol"?t+"":t,s);var at=(()=>{try{return typeof window<"u"?window.localStorage:{getItem(){return""},setItem(){}}}catch{return{getItem(){return""},setItem(){}}}})(),r={seed:1,warseed:1,resource:{},evolution:{},tech:{},city:{},space:{},interstellar:{},portal:{},eden:{},tauceti:{},civic:{},race:{},genes:{},blood:{},stats:{start:Date.now(),days:0,tdays:0},event:{t:200,l:!1},m_event:{t:499,l:!1}};Math.rand=function(e,t){return Math.floor(Math.random()*(t-e))+e};r.seed=2;r.warseed=2;function H(e,t,s,a){t=t||1,e=e||0;let l=((a||r[s?"warseed":"seed"])*9301+49297)%233280,p=l/233280;return a||(r[s?"warseed":"seed"]=l),e+p*(t-e)}function it(e){r=e}r.version||(r.version="0.2.0");r.version="1.4.8";delete r.revision;delete r.beta;r.settings||(r.settings={showEvolve:!0,showAchieve:!1,animated:!0,disableReset:!1,font:"standard",q_merge:"merge_nearby",cLabels:!0,theme:"gruvboxDark",locale:"en-US",icon:"star"});r.eden||(r.eden={});r.settings.locale||(r.settings.locale="en-US");function $t(){["reset","plasmid","antiplasmid","universes","phage","starved","tstarved","died","tdied","sac","tsac","know","tknow","portals","dkills","attacks","cfood","tfood","cstone","tstone","clumber","tlumber","mad","bioseed","cataclysm","blackhole","ascend","descend","apotheosis","terraform","aiappoc","matrix","retire","eden","geck","dark","harmony","blood","cores","artifact","supercoiled","cattle","tcattle","murders","tmurders","psykill","tpsykill","pdebt","uDead"].forEach(function(e){r.stats.hasOwnProperty(e)||(r.stats[e]=0)}),r.stats.achieve||(r.stats.achieve={}),r.stats.feat||(r.stats.feat={}),r.stats.hasOwnProperty("womling")||(r.stats.womling={god:{l:0},lord:{l:0},friend:{l:0}}),r.stats.spire||(r.stats.spire={}),r.stats.synth||(r.stats.synth={}),r.stats.hasOwnProperty("banana")||(r.stats.banana={b1:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b2:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b3:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b4:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b5:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1}}),r.stats.hasOwnProperty("endless_hunger")||(r.stats.endless_hunger={b1:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b2:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b3:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b4:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b5:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1}}),r.stats.hasOwnProperty("death_tour")||(r.stats.death_tour={ct:{l:0,h:0,a:0,e:0,m:0,mg:0},bh:{l:0,h:0,a:0,e:0,m:0,mg:0},di:{l:0,h:0,a:0,e:0,m:0,mg:0},ai:{l:0,h:0,a:0,e:0,m:0,mg:0},vc:{l:0,h:0,a:0,e:0,m:0,mg:0},md:{l:0,h:0,a:0,e:0,m:0,mg:0}}),r.stats.death_tour&&!r.stats.death_tour.hasOwnProperty("md")&&(r.stats.death_tour.md={l:0,h:0,a:0,e:0,m:0,mg:0}),r.stats.warlord||(r.stats.warlord={k:!1,p:!1,a:!1,r:!1,g:!1})}$t();r.race.universe||(r.race.universe="standard");r.settings.affix||(r.settings.affix="si");var Be=[{short:"mcs_stng_truncate_t_short",full:"mcs_stng_truncate_t_full",val:!0},{short:"mcs_stng_truncate_f_short",full:"mcs_stng_truncate_f_full",val:!1}],Y=[{short:"mcs_stng_disabled",full:"mcs_stng_disabled",val:0},{short:"mcs_stng_sorting_1_short",full:"mcs_stng_sorting_1_full",val:1},{short:"mcs_stng_sorting_2_short",full:"mcs_stng_sorting_2_full",val:2},{short:"mcs_stng_sorting_3_short",full:"mcs_stng_sorting_3_full",val:3},{short:"mcs_stng_sorting_4_short",full:"mcs_stng_sorting_4_full",val:4}],me=[{short:"\u2191",full:"Descending",val:-1},{short:"\u2193",full:"Ascending",val:1}],Ie=[{short:"mcs_stng_disabled",full:"mcs_stng_disabled",val:0},{short:"mcs_stng_group_1_short",full:"mcs_stng_group_1_full",val:1},{short:"mcs_stng_group_2_short",full:"mcs_stng_group_2_full",val:2}],ge=[{short:"A",full:"Style A",val:"visStyleA"},{short:"B",full:"Style B",val:"visStyleB"},{short:"C",full:"Style C",val:"visStyleC"}],rt=[{short:'<svg class="bi" width="1em" height="1em" fill="currentColor"><use xlink:href="./icons/icons.svg#info-square-fill"/></svg>',full:"Display effectiveness summary table",val:!0},{short:'<svg class="bi" width="1em" height="1em" fill="currentColor"><use xlink:href="./icons/icons.svg#info-square-fill"/></svg>',full:"Hide effectiveness summary table",val:!1}],Re=[{short:'<svg class="bi" width="1.1em" height="1.1em" fill="currentColor"><use xlink:href="./icons/icons.svg#eye"/></svg>',full:"Display mech lists",val:!0},{short:'<svg class="bi" width="1.1em" height="1.1em" fill="currentColor"><use xlink:href="./icons/icons.svg#eye-slash"/></svg>',full:"Hide mech lists",val:!1}];var nt=[{size:"small",hardpoint:["flame"],chassis:"wheel",equip:["special"],infernal:!0},{size:"small",hardpoint:["kinetic"],chassis:"spider",equip:["stabilizer"],infernal:!1},{size:"medium",hardpoint:[],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"medium",hardpoint:["flame"],chassis:"tread",equip:["stabilizer","shields"],infernal:!1},{size:"medium",hardpoint:["missile"],chassis:"tread",equip:["stabilizer","shields"],infernal:!1},{size:"titan",hardpoint:["tesla","tesla","tesla","tesla"],chassis:"spider",equip:["special","radiator","shields","sonar","stabilizer"],infernal:!0},{size:"large",hardpoint:["laser","laser"],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"hover",equip:["special","coolant","shields"],infernal:!0},{size:"titan",hardpoint:["tesla","tesla","tesla","tesla"],chassis:"hover",equip:["special","coolant","shields","sonar","stabilizer"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"medium",hardpoint:["sonic"],chassis:"quad",equip:["shields","flare"],infernal:!1},{size:"titan",hardpoint:["laser","kinetic","sonic","shotgun"],chassis:"quad",equip:["shields","sonar","flare","grapple","stabilizer"],infernal:!1},{size:"large",hardpoint:["laser","kinetic"],chassis:"wheel",equip:["shields","flare","grapple"],infernal:!1},{size:"titan",hardpoint:["flame","flame","flame","flame"],chassis:"hover",equip:["ablative","radiator","grapple","sonar","stabilizer"],infernal:!1}],lt=[{size:"small",hardpoint:["flame"],chassis:"wheel",equip:["special"],infernal:!0},{size:"minion",hardpoint:["shock"],chassis:"hound",equip:["scouter"],infernal:!1},{size:"collector",hardpoint:[],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"medium",hardpoint:["flame"],chassis:"tread",equip:["stabilizer","shields"],infernal:!1},{size:"medium",hardpoint:["missile"],chassis:"tread",equip:["stabilizer","shields"],infernal:!1},{size:"archfiend",hardpoint:["venom","shock"],chassis:"snake",equip:["darkvision","echo","thermal","manashield","cold"],infernal:!0},{size:"large",hardpoint:["laser","laser"],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"hover",equip:["special","coolant","shields"],infernal:!0},{size:"titan",hardpoint:["tesla","tesla","tesla","tesla"],chassis:"hover",equip:["special","coolant","shields","sonar","stabilizer"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"fiend",hardpoint:["cold"],chassis:"nightmare",equip:["darkvision","echo"],infernal:!1},{size:"titan",hardpoint:["laser","kinetic","sonic","shotgun"],chassis:"quad",equip:["shields","sonar","flare","grapple","stabilizer"],infernal:!1},{size:"cyberdemon",hardpoint:["laser","kinetic"],chassis:"wheel",equip:["shields","flare","grapple"],infernal:!1},{size:"titan",hardpoint:["flame","flame","flame","flame"],chassis:"hover",equip:["ablative","radiator","grapple","sonar","stabilizer"],infernal:!1}],ot=[{size:"collector",hardpoint:[],chassis:"wheel",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"biped",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"spider",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"hover",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"wheel",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"tread",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"biped",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"quad",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"spider",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"hover",equip:["stabilizer","radiator","grapple"],infernal:!1}];var ae=new Intl.NumberFormat(void 0),d={version:"1.0.2",LS_SString:"storedSaveString",LS_Config:"storedConfig",LS_MechList:"favMechs",LS_MechBucket:"mechBucket_",LS_PageLabels:"storedLabels",LS_Heap:"storedRandomStuff",info:["Mech Cheat Sheet","by Akudeu Kie","https://github.com/akudeukie/MechCheatSheet/","for %0 v%1 %2","https://pmotschmann.github.io/Evolve/","Evolve Incremental","1.4.8","by Demagorddon"],maxMechBuckets:4,maxStatus:4,maxMechPages:15,localStorage:!1,config:{warlord:!1,prepared:0,wrath:0,gladiator:0,scouts:0,resets:0,showInfoTable:!0,defaultMSize:"medium",defaultMType:"tread",truncateWeapons:!0,sortingType:Y[0].val,sortingDirection:me[0].val,groupingType:0,mathVisStyle:0,calculatorVisibility:!1,avgStart:1,avgLength:20,avgRepeats:10,avgThreads:4,preciseMedians:!1,avgEdenTax:!0,pagerVisibility:0,defaultPage:0,virtualList:!0,locale:"en-US"},labels:{},heap:{},events:{},EV_CONSTRUCTOR:"eon_constructor",EV_OPEN_DROPDOWN:"eon_openedropdown",EV_CLOSE_DROPDOWNS:"eon_closedropdowns",on:function(e,t){let s=d.events[e]||[];s.push(t),d.events[e]=s},off:function(e,t){let s=d.events[e]||[];if(t){let a=s.indexOf(t);a!=-1&&s.splice(a,1),d.events[e]=s}else d.events[e]=[]},dispatchEvent:function(e,t){let s=d.events[e];!s||s.length<1||s.forEach(function(a){a(t)})}};function je(){r.portal.mechbay={count:0,on:0,bay:0,max:0,active:0,scouts:0,mechs:[]},r.portal.spire={count:1,progress:0,boss:"",type:"",status:{}},r.stats.achieve.gladiator={l:0},r.blood.prepared=0,r.blood.wrath=0,r.stats.reset=0}function xt(){if(!d.localStorage)return;let e=localStorage.getItem(d.LS_Config);e=e?JSON.parse(LZString.decompressFromBase64(e)):null,e&&(Object.keys(d.config).forEach(function(a){e[a]??(e[a]=d.config[a])}),d.config=e,r.stats.achieve.gladiator.l=d.config.gladiator||0,r.race.warlord=d.config.warlord||!1,r.blood.wrath=d.config.wrath||0,r.blood.prepared=d.config.prepared||0,r.portal.mechbay.scouts=d.config.scouts||0,r.stats.reset=d.config.resets||0);let t=localStorage.getItem(d.LS_PageLabels);t=t?JSON.parse(LZString.decompressFromBase64(t)):null,t&&(d.labels=t);let s=localStorage.getItem(d.LS_Heap);s=s?JSON.parse(LZString.decompressFromBase64(s)):null,s&&(d.heap=s),r.settings.locale=d.config.locale}function T(){d.config.warlord=r.race.warlord,d.config.prepared=r.blood.prepared,d.config.wrath=r.blood.wrath,d.config.gladiator=r.stats.achieve.gladiator.l,d.config.scouts=r.portal.mechbay.scouts,d.config.resets=r.stats.reset,d.localStorage&&localStorage.setItem(d.LS_Config,LZString.compressToBase64(JSON.stringify(d.config)))}function ct(){d.localStorage&&localStorage.setItem(d.LS_PageLabels,LZString.compressToBase64(JSON.stringify(d.labels)))}function We(){d.localStorage&&localStorage.setItem(d.LS_Heap,LZString.compressToBase64(JSON.stringify(d.heap)))}var P={};function Ct(){for(var e=0;e<d.maxMechBuckets;e++){let t;d.localStorage&&(t=localStorage.getItem(`${d.LS_MechBucket}${e}`),t=t?JSON.parse(LZString.decompressFromBase64(t)):null),t&&Array.isArray(t)?P[e]=t:P[e]=[]}}function ue(e){if(e>=d.maxMechPages||e<0)return[];let t=ht(e);if(P.hasOwnProperty(t.b)){for(;t.i>=P[t.b].length;)P[t.b].push([]);return P[t.b][t.i].length==0&&(e==5&&(P[t.b][t.i]=ot),e==6&&(P[t.b][t.i]=nt),e==7&&(P[t.b][t.i]=lt)),P[t.b][t.i]}else return[]}function Ae(e,t){let s=ht(e);if(!P.hasOwnProperty(s.b)||e>=d.maxMechPages||e<0||s.b>d.maxMechBuckets)return[!1,"Could not save list - invalid page number"];for(;s.i>=P[s.b].length;)P[s.b].push([]);return P[s.b][s.i]=t,d.localStorage?(localStorage.setItem(`${d.LS_MechBucket}${s.b}`,LZString.compressToBase64(JSON.stringify(P[s.b]))),[!0,`Saved page ${e+1} successfully`]):[!1,"Failed to access local storage"]}function ht(e){let t=e%d.maxMechBuckets,s=Math.floor(e/d.maxMechBuckets);return{b:t,i:s}}function be(e,t){let s=null;return function(...a){s===null&&(e(...a),s=setTimeout(()=>{s=null},t))}}var Ve;try{Ve=window.localStorage;let e="_test_";Ve.setItem(e,e),Ve.removeItem(e),d.localStorage=!0}catch{d.localStorage=!1}je();xt();Ct();var ie={fire_elm:{weapon:{laser:1.05,flame:0,plasma:.25,kinetic:.5,missile:.5,sonic:1,shotgun:.75,tesla:.65,claws:.5,venom:.62,cold:1.25,shock:.68,fire:0,acid:.25,stone:.5,iron:.5,flesh:.3,ice:1.12,magma:0,axe:.5,hammer:.5},nozone:{freeze:!0,flooded:!0},amp:{hot:1.75,humid:.8,steam:.9}},water_elm:{weapon:{laser:.65,flame:.5,plasma:1,kinetic:.2,missile:.5,sonic:.5,shotgun:.25,tesla:.75,claws:.4,venom:.8,cold:1.1,shock:.68,fire:.8,acid:.25,stone:.4,iron:.3,flesh:.5,ice:1.1,magma:.75,axe:.45,hammer:.45},nozone:{hot:!0,freeze:!0},amp:{steam:1.5,river:1.1,flooded:2,rain:1.75,humid:1.25}},rock_golem:{weapon:{laser:1,flame:.5,plasma:1,kinetic:.65,missile:.95,sonic:.75,shotgun:.35,tesla:0,claws:.7,venom:.25,cold:.35,shock:0,fire:.9,acid:1,stone:.5,iron:.65,flesh:.3,ice:.3,magma:.9,axe:.2,hammer:1},nozone:{},amp:{}},bone_golem:{weapon:{laser:.45,flame:.35,plasma:.55,kinetic:1,missile:1,sonic:.75,shotgun:.75,tesla:.15,claws:.75,venom:0,cold:.2,shock:.15,fire:.4,acid:.85,stone:.9,iron:1,flesh:.15,ice:.3,magma:.9,axe:.65,hammer:1.2},nozone:{},amp:{}},mech_dino:{weapon:{laser:.85,flame:.05,plasma:.55,kinetic:.45,missile:.5,sonic:.35,shotgun:.5,tesla:1,claws:.38,venom:.1,cold:.5,shock:1.1,fire:.5,acid:.75,stone:.5,iron:.5,flesh:.15,ice:.3,magma:.9,axe:.6,hammer:.4},nozone:{},amp:{}},plant:{weapon:{laser:.42,flame:1,plasma:.65,kinetic:.2,missile:.25,sonic:.75,shotgun:.35,tesla:.38,claws:.25,venom:.25,cold:.65,shock:.28,fire:1,acid:.45,stone:.6,iron:.5,flesh:.5,ice:.55,magma:1,axe:.25,hammer:.15},nozone:{},amp:{}},crazed:{weapon:{laser:.5,flame:.85,plasma:.65,kinetic:1,missile:.35,sonic:.15,shotgun:.95,tesla:.6,claws:1,venom:.5,cold:.5,shock:.75,fire:.5,acid:.5,stone:.7,iron:.8,flesh:.9,ice:.4,magma:.5,axe:1,hammer:.75},nozone:{},amp:{}},minotaur:{weapon:{laser:.32,flame:.5,plasma:.82,kinetic:.44,missile:1,sonic:.15,shotgun:.2,tesla:.35,claws:.6,venom:1.1,cold:.5,shock:.3,fire:.5,acid:1,stone:.6,iron:.9,flesh:.3,ice:.4,magma:.55,axe:.75,hammer:.6},nozone:{},amp:{}},ooze:{weapon:{laser:.2,flame:.65,plasma:1,kinetic:0,missile:0,sonic:.85,shotgun:0,tesla:.15,claws:0,venom:.15,cold:1.5,shock:.2,fire:.6,acid:.5,stone:0,iron:0,flesh:0,ice:1.25,magma:.7,axe:0,hammer:0},nozone:{},amp:{}},zombie:{weapon:{laser:.35,flame:1,plasma:.45,kinetic:.08,missile:.8,sonic:.18,shotgun:.95,tesla:.05,claws:.85,venom:0,cold:.2,shock:.35,fire:.95,acid:.5,stone:.5,iron:.5,flesh:.35,ice:.25,magma:.9,axe:1,hammer:.5},nozone:{},amp:{}},raptor:{weapon:{laser:.68,flame:.55,plasma:.85,kinetic:1,missile:.44,sonic:.22,shotgun:.33,tesla:.66,claws:.85,venom:.5,cold:.5,shock:.88,fire:.6,acid:.6,stone:1,iron:.85,flesh:.45,ice:.5,magma:.65,axe:.9,hammer:.6},nozone:{},amp:{}},frost_giant:{weapon:{laser:.9,flame:.82,plasma:1,kinetic:.25,missile:.08,sonic:.45,shotgun:.28,tesla:.5,claws:.35,venom:.15,cold:0,shock:.6,fire:1.2,acid:.5,stone:.35,iron:1,flesh:.3,ice:0,magma:1.1,axe:.5,hammer:1},nozone:{hot:!0},amp:{freeze:2.5,hail:1.65}},swarm:{weapon:{laser:.02,flame:1,plasma:.04,kinetic:.01,missile:.08,sonic:.66,shotgun:.38,tesla:.45,claws:.05,venom:.01,cold:.8,shock:.75,fire:.8,acid:.75,stone:.03,iron:.03,flesh:.03,ice:.3,magma:.5,axe:.01,hammer:.05},nozone:{},amp:{}},dragon:{weapon:{laser:.18,flame:0,plasma:.12,kinetic:.35,missile:1,sonic:.22,shotgun:.65,tesla:.15,claws:.38,venom:.88,cold:.8,shock:.35,fire:0,acid:.85,stone:.03,iron:.03,flesh:.03,ice:.3,magma:0,axe:.4,hammer:.55},nozone:{},amp:{}},mech_dragon:{weapon:{laser:.84,flame:.1,plasma:.68,kinetic:.18,missile:.75,sonic:.22,shotgun:.28,tesla:1,claws:.28,venom:0,cold:.35,shock:1,fire:.15,acid:.72,stone:.5,iron:.5,flesh:.5,ice:.2,magma:.15,axe:.25,hammer:.8},nozone:{},amp:{}},construct:{weapon:{laser:.5,flame:.2,plasma:.6,kinetic:.34,missile:.9,sonic:.08,shotgun:.28,tesla:1,claws:.28,venom:0,cold:.45,shock:1.1,fire:.22,acid:.68,stone:.55,iron:.55,flesh:.4,ice:.4,magma:.18,axe:.42,hammer:.95},nozone:{},amp:{}},beholder:{weapon:{laser:.75,flame:.15,plasma:1,kinetic:.45,missile:.05,sonic:.01,shotgun:.12,tesla:.3,claws:.48,venom:.9,cold:.88,shock:.24,fire:.18,acid:.9,stone:.72,iron:.45,flesh:.85,ice:.92,magma:.16,axe:.44,hammer:.08},nozone:{},amp:{}},worm:{weapon:{laser:.55,flame:.38,plasma:.45,kinetic:.2,missile:.05,sonic:1,shotgun:.02,tesla:.01,claws:.18,venom:.65,cold:1,shock:.02,fire:.38,acid:.48,stone:.22,iron:.24,flesh:.35,ice:1,magma:.4,axe:.15,hammer:.05},nozone:{},amp:{}},hydra:{weapon:{laser:.85,flame:.75,plasma:.85,kinetic:.25,missile:.45,sonic:.5,shotgun:.6,tesla:.65,claws:.3,venom:.65,cold:.55,shock:.65,fire:.75,acid:.85,stone:.25,iron:.15,flesh:.2,ice:.55,magma:.75,axe:.45,hammer:.65},nozone:{},amp:{}},colossus:{weapon:{laser:1,flame:.05,plasma:.75,kinetic:.45,missile:1,sonic:.35,shotgun:.35,tesla:.5,claws:.48,venom:.22,cold:.25,shock:.65,fire:.15,acid:.95,stone:.55,iron:.95,flesh:.25,ice:.35,magma:.2,axe:.55,hammer:.35},nozone:{},amp:{}},lich:{weapon:{laser:.1,flame:.1,plasma:.1,kinetic:.45,missile:.75,sonic:.35,shotgun:.75,tesla:.5,claws:.4,venom:.01,cold:.1,shock:.5,fire:.1,acid:.1,stone:.35,iron:.25,flesh:.95,ice:.1,magma:.1,axe:.4,hammer:1},nozone:{},amp:{}},ape:{weapon:{laser:1,flame:.95,plasma:.85,kinetic:.5,missile:.5,sonic:.05,shotgun:.35,tesla:.68,claws:.65,venom:.95,cold:.5,shock:.5,fire:.75,acid:.65,stone:.5,iron:.5,flesh:.5,ice:.5,magma:.75,axe:.65,hammer:.5},nozone:{},amp:{}},bandit:{weapon:{laser:.65,flame:.5,plasma:.85,kinetic:1,missile:.5,sonic:.25,shotgun:.75,tesla:.25,claws:1,venom:.15,cold:.5,shock:.25,fire:.5,acid:.5,stone:.5,iron:.8,flesh:.5,ice:.5,magma:.5,axe:1,hammer:.5},nozone:{},amp:{}},croc:{weapon:{laser:.65,flame:.05,plasma:.6,kinetic:.5,missile:.5,sonic:1,shotgun:.2,tesla:.75,claws:1,venom:.5,cold:1,shock:.75,fire:.05,acid:.08,stone:.6,iron:.5,flesh:.25,ice:.95,magma:.05,axe:.75,hammer:.5},nozone:{},amp:{}},djinni:{weapon:{laser:0,flame:.35,plasma:1,kinetic:.15,missile:0,sonic:.65,shotgun:.22,tesla:.4,claws:.18,venom:.12,cold:.9,shock:.45,fire:.3,acid:.1,stone:.2,iron:.95,flesh:.2,ice:.9,magma:.3,axe:.12,hammer:0},nozone:{},amp:{}},snake:{weapon:{laser:.5,flame:.5,plasma:.5,kinetic:.5,missile:.5,sonic:.5,shotgun:.5,tesla:.5,claws:.5,venom:.02,cold:.75,shock:.5,fire:.5,acid:.5,stone:.5,iron:.5,flesh:.5,ice:.75,magma:.5,axe:.5,hammer:.5},nozone:{},amp:{}},centipede:{weapon:{laser:.5,flame:.85,plasma:.95,kinetic:.65,missile:.6,sonic:0,shotgun:.5,tesla:.01,claws:.65,venom:.01,cold:0,shock:.01,fire:.88,acid:.95,stone:.6,iron:.45,flesh:.55,ice:0,magma:.88,axe:.7,hammer:.4},nozone:{},amp:{}},spider:{weapon:{laser:.65,flame:1,plasma:.22,kinetic:.75,missile:.15,sonic:.38,shotgun:.9,tesla:.18,claws:.12,venom:.05,cold:.5,shock:.32,fire:1,acid:.65,stone:.8,iron:.5,flesh:.5,ice:.5,magma:1,axe:.18,hammer:.75},nozone:{},amp:{}},manticore:{weapon:{laser:.05,flame:.25,plasma:.95,kinetic:.5,missile:.15,sonic:.48,shotgun:.4,tesla:.6,claws:.5,venom:.5,cold:.8,shock:.75,fire:.15,acid:.95,stone:.25,iron:.5,flesh:.8,ice:.8,magma:.15,axe:.5,hammer:.25},nozone:{},amp:{}},fiend:{weapon:{laser:.75,flame:.25,plasma:.5,kinetic:.25,missile:.75,sonic:.25,shotgun:.5,tesla:.5,claws:.65,venom:.1,cold:.65,shock:.5,fire:.2,acid:.5,stone:.25,iron:.75,flesh:1,ice:.65,magma:.2,axe:.75,hammer:.25},nozone:{},amp:{}},bat:{weapon:{laser:.16,flame:.18,plasma:.12,kinetic:.25,missile:.02,sonic:1,shotgun:.9,tesla:.58,claws:.1,venom:.1,cold:.8,shock:.65,fire:.15,acid:.5,stone:.1,iron:.1,flesh:.5,ice:.8,magma:.2,axe:.1,hammer:.1},nozone:{},amp:{}},medusa:{weapon:{laser:.35,flame:.1,plasma:.3,kinetic:.95,missile:1,sonic:.15,shotgun:.88,tesla:.26,claws:.42,venom:.3,cold:.48,shock:.28,fire:.1,acid:.85,stone:1,iron:.25,flesh:.75,ice:.52,magma:.12,axe:.34,hammer:1},nozone:{},amp:{}},ettin:{weapon:{laser:.5,flame:.35,plasma:.8,kinetic:.5,missile:.25,sonic:.3,shotgun:.6,tesla:.09,claws:.5,venom:.95,cold:.3,shock:.8,fire:.38,acid:.9,stone:.6,iron:.75,flesh:.4,ice:.28,magma:.32,axe:.45,hammer:.25},nozone:{},amp:{}},faceless:{weapon:{laser:.6,flame:.28,plasma:.6,kinetic:0,missile:.05,sonic:.8,shotgun:.15,tesla:1,claws:.02,venom:.01,cold:0,shock:1,fire:.25,acid:.55,stone:.15,iron:.15,flesh:.95,ice:0,magma:.25,axe:.01,hammer:.05},nozone:{},amp:{}},enchanted:{weapon:{laser:1,flame:.02,plasma:.95,kinetic:.2,missile:.7,sonic:.05,shotgun:.65,tesla:.01,claws:.1,venom:0,cold:.5,shock:.01,fire:.02,acid:1,stone:.25,iron:.75,flesh:.1,ice:.5,magma:.03,axe:.1,hammer:.5},nozone:{},amp:{}},gargoyle:{weapon:{laser:.15,flame:.4,plasma:.3,kinetic:.5,missile:.5,sonic:.85,shotgun:1,tesla:.2,claws:.45,venom:.05,cold:.15,shock:.08,fire:.38,acid:.85,stone:1,iron:.85,flesh:.25,ice:.15,magma:.35,axe:.42,hammer:1},nozone:{},amp:{}},chimera:{weapon:{laser:.38,flame:.6,plasma:.42,kinetic:.85,missile:.35,sonic:.5,shotgun:.65,tesla:.8,claws:.92,venom:.5,cold:.45,shock:.8,fire:.56,acid:.4,stone:.5,iron:.5,flesh:.5,ice:.48,magma:.54,axe:.88,hammer:.42},nozone:{},amp:{}},gorgon:{weapon:{laser:.65,flame:.65,plasma:.64,kinetic:.65,missile:.66,sonic:.65,shotgun:.65,tesla:.65,claws:.65,venom:.65,cold:.65,shock:.65,fire:.65,acid:.65,stone:.65,iron:.65,flesh:.65,ice:.65,magma:.65,axe:.65,hammer:.65},nozone:{},amp:{}},kraken:{weapon:{laser:.75,flame:.35,plasma:.75,kinetic:.35,missile:.5,sonic:.18,shotgun:.05,tesla:.85,claws:.32,venom:.8,cold:.66,shock:.82,fire:.33,acid:.75,stone:.45,iron:.35,flesh:.4,ice:.66,magma:.33,axe:.36,hammer:.5},nozone:{},amp:{}},homunculus:{weapon:{laser:.05,flame:1,plasma:.1,kinetic:.85,missile:.65,sonic:.5,shotgun:.75,tesla:.2,claws:.85,venom:.4,cold:.12,shock:.22,fire:1,acid:.13,stone:.65,iron:.68,flesh:.95,ice:.18,magma:.9,axe:.85,hammer:.65},nozone:{},amp:{}},giant_chicken:{weapon:{laser:.95,flame:.95,plasma:.95,kinetic:.95,missile:.95,sonic:.95,shotgun:.95,tesla:.95,claws:.95,venom:.96,cold:.95,shock:.95,fire:.95,acid:.95,stone:.95,iron:.95,flesh:.94,ice:.95,magma:.95,axe:.95,hammer:.95},nozone:{},amp:{}},skeleton_pack:{weapon:{laser:.5,flame:.1,plasma:.5,kinetic:1,missile:1.2,sonic:.5,shotgun:1.05,tesla:.2,claws:.65,venom:0,cold:.11,shock:.22,fire:.1,acid:.5,stone:1,iron:.65,flesh:.25,ice:.1,magma:.12,axe:.15,hammer:1.08},nozone:{},amp:{}}};function re(e,t){let s=ie[e].weapon[t],a=r.stats.reset+(r.portal?.spire?.count||1),n=Math.floor(H(0,25e3,!1,a+(r.portal?.spire?.count||1)*2)),l=Math.floor(H(0,25e3,!1,a+r.stats.reset*2)),p=r.race.warlord?["laser","kinetic","shotgun","missile","flame","plasma","sonic","tesla","claws","venom","cold","shock","fire","acid","stone","iron","flesh","ice","magma","axe","hammer"]:["laser","kinetic","shotgun","missile","flame","plasma","sonic","tesla"],c=p[Math.floor(H(0,p.length,!1,n))],m=p[Math.floor(H(0,p.length,!1,l))];if(t===c){let f=Math.floor(H(0,25e3,!1,n+(r.portal?.spire?.count||1)*3));s-=Math.floor(H(0,26,!1,f))/100,s<0&&(s=0)}else if(t===m){let f=Math.floor(H(0,25e3,!1,l+r.stats.reset*3));s+=Math.floor(H(0,26,!1,f))/100}return s}function G(e,t,s){let a=["laser","kinetic","shotgun","missile","flame","plasma","sonic","tesla"];if(r.race.warlord)switch(e){case"minion":t==="harpy"?a=["claws","venom"]:t==="hound"?a=["cold","shock","fire","acid"]:t==="barghest"&&(a=["claws","venom"]);break;case"fiend":t==="minotaur"?a=["axe","hammer"]:t==="nightmare"?a=["cold","shock","fire","acid"]:t==="golem"&&(a=["stone","iron","flesh","ice","magma"]);break;case"archfiend":if(s===void 0||s===!1)switch(a=["claws","venom","cold","shock","fire","acid"],t){case"dragon":a=["claws","cold","shock","fire","acid"];break;case"snake":a=["venom","cold","shock","fire","acid"];break;case"gorgon":a=["axe","hammer","cold","shock","fire","acid"];break;case"hydra":a=["cold","shock","fire","acid"];break}else switch(t){case"dragon":a=s===0?["claws"]:["cold","shock","fire","acid"];break;case"snake":a=s===0?["venom"]:["cold","shock","fire","acid"];break;case"gorgon":a=s===0?["axe","hammer"]:["cold","shock","fire","acid"];break;case"hydra":a=[["cold","shock","fire","acid"][s]];break}break}return a}function V(e,t,s){let a=["special","shields","sonar","grapple","infrared","flare","radiator","coolant","ablative","stabilizer","seals"];if(r.race.warlord)switch(e){case"minion":a=["scavenger","scouter","darkvision","echo","thermal","manashield","cold","heat","athletic","lucky","stoneskin"];break;case"fiend":case"archfiend":a=["darkvision","echo","thermal","manashield","cold","heat","athletic","lucky","stoneskin"];break}return a}function j(e){switch(e){case"minion":return 1;case"small":return 2;case"fiend":return r.blood.prepared&&r.blood.prepared>=2?3:4;case"medium":return r.blood.prepared&&r.blood.prepared>=2?4:5;case"cyberdemon":return r.blood.prepared&&r.blood.prepared>=2?6:8;case"large":return r.blood.prepared&&r.blood.prepared>=2?8:10;case"archfiend":return r.blood.prepared&&r.blood.prepared>=2?15:20;case"titan":return r.blood.prepared&&r.blood.prepared>=2?20:25;case"collector":return 1;case"default":return 25}}function He(e,t,s){return e.equip.includes("special")&&(e.size==="small"||e.size==="medium"||e.size==="collector")&&t<1&&(t+=(1-t)*(s.includes("gravity")?.1:.2)),e.size!=="small"&&t<1&&(t+=(s.includes("fog")||s.includes("dark")?.005:.01)*r.portal.mechbay.scouts,t>1&&(t=1)),t}function ve(e,t){return t<1&&t!==0&&e.equip.includes("special")&&e.size==="titan"&&(t+=(1-t)*.25),e.equip.includes("special")&&(e.size==="large"||e.size==="cyberdemon")&&(t*=1.02),t}function B(e,t){let s=1;switch(t){case"freeze":!e.equip.includes("radiator")&&!e.equip.includes("cold")&&(s=.25);break;case"hot":!e.equip.includes("coolant")&&!e.equip.includes("heat")&&(s=.25);break;case"corrosive":e.equip.includes("ablative")||(e.equip.includes("stoneskin")?s=.9:e.equip.includes("shields")?s=.75:s=e.equip.includes("manashield")?.5:.25);break;case"humid":e.equip.includes("seals")||(s=e.equip.includes("heat")?.85:.75);break;case"windy":["hover","flying_imp","harpy","dragon"].includes(e.chassis)&&(s=.5);break;case"hilly":["spider","flying_imp","harpy","dragon"].includes(e.chassis)||(s=.75);break;case"mountain":e.chassis!=="spider"&&!e.equip.includes("grapple")&&(s=e.equip.includes("flare")||e.equip.includes("echo")?.75:.5);break;case"radioactive":!e.equip.includes("shields")&&e.equip.includes("manashield")&&(s=.5);break;case"quake":e.equip.includes("stabilizer")||(s=e.equip.includes("athletic")?.75:.25);break;case"dust":!e.equip.includes("seals")&&!e.equip.includes("thermal")&&(s=.5);break;case"river":["hover","flying_imp","harpy","dragon"].includes(e.chassis)||(s=.65);break;case"tar":e.chassis!=="quad"&&(s=e.chassis==="tread"||e.chassis==="wheel"?.5:.75);break;case"steam":!e.equip.includes("shields")&&!e.equip.includes("heat")&&(s=.75);break;case"flooded":e.chassis!=="hover"&&(s=["snake"].includes(e.chassis)?.85:.35);break;case"fog":!e.equip.includes("sonar")&&!e.equip.includes("echo")&&(s=.2);break;case"rain":e.equip.includes("seals")||(s=e.equip.includes("cold")?.9:.75);break;case"hail":!e.equip.includes("ablative")&&!e.equip.includes("shields")&&!e.equip.includes("manashield")&&!e.equip.includes("stoneskin")&&(s=.75);break;case"chasm":!e.equip.includes("grapple")&&!["flying_imp","harpy","dragon"].includes(e.chassis)&&(s=e.equip.includes("athletic")?.35:.1);break;case"dark":!e.equip.includes("infrared")&&!e.equip.includes("darkvision")&&(s=e.equip.includes("flare")?.25:.1);break;case"gravity":{switch(e.size){case"fiend":case"medium":s=.8;break;case"cyberdemon":s=.5;case"large":s=.45;break;case"archfiend":s=.35;case"titan":s=.25;break}["flying_imp","harpy","dragon"].includes(e.chassis)&&(s-=.15),e.equip.includes("athletic")&&s<1&&(s+=.1)}break}return e.equip.includes("lucky")&&(s+=.01*Math.floor(H(1,10,!1,r.stats.resets+(r.portal?.spire?.count||1)*42)),s>1&&(s=1)),s}function Q(e,t){let s=t||r.portal.spire.type,a=1;switch(e.chassis){case"wheel":case"nightmare":case"hound":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?.9:.85;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.35:.18;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.92:.85;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.65:.5;break;case"gravel":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.85:.58;break;case"grass":a=["small","medium","minion","fiend"].includes(e.size)?1.3:1.2;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?.9:.8;break;case"concrete":a=["small","medium","minion","fiend"].includes(e.size)?1.1:1;break}break;case"tread":case"rakshasa":case"harpy":case"dragon":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?1.15:1.1;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.55:.4;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.65:.5;break;case"gravel":a=["small","medium","minion","fiend"].includes(e.size)?1.3:1.2;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.88:.72;break}break;case"cambion":case"biped":case"imp":case"gorgon":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?.78:.65;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.68:.5;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.82:.7;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.48:.4;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.85:.7;break;case"grass":a=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?.92:.85;break}break;case"quad":case"golem":case"barghest":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?.86:.75;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.58:.42;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break;case"gravel":a=["small","medium","minion","fiend"].includes(e.size)?.9:.8;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.68:.5;break;case"grass":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break}break;case"spider":case"minotaur":case"hydra":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?.75:.65;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.9:.78;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?.82:.75;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.77:.65;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"gravel":a=["small","medium","minion","fiend"].includes(e.size)?.86:.75;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.92:.82;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break}break;case"hover":case"flying_imp":case"snake":switch(s){case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?1.35:1.2;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?.65:.48;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.55:.35;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.82:.68;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?1.15:1.08;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?.78:.7;break}break}return a}function St(e){switch(e){case"minion":return .0015;case"small":return .0025;case"fiend":return .006;case"medium":return .0075;case"cyberdemon":return .009;case"large":return .01;case"archfiend":return .011;case"titan":return .012;default:return 0}}function ne(e,t){let s=St(e.size);if(s===0)return 0;if(e.hasOwnProperty("infernal")&&e.infernal&&r.blood.prepared&&r.blood.prepared>=3&&(s*=1.25),r.blood.wrath&&(s*=1+r.blood.wrath/20),e.size==="archfiend"&&e.chassis!="hydra"&&(s*=2),t){r.stats.achieve.gladiator&&r.stats.achieve.gladiator.l>0&&(s*=1+r.stats.achieve.gladiator.l*.1),(e.size==="titan"||e.size==="archfiend")&&(s*=1.1);let a=universeAffix();r.stats.spire.hasOwnProperty(a)&&r.stats.spire[a].hasOwnProperty("dlstr")?s/=100+r.stats.spire[a].dlstr*25:s/=100;let n=0;for(let l=0;l<e.hardpoint.length;l++)n+=s*ve(e,1);return n}else{if(r.stats.achieve.gladiator&&r.stats.achieve.gladiator.l>0&&(s*=1+r.stats.achieve.gladiator.l*.2),r.portal.spire.type==="concrete")switch(e.size){case"minion":case"small":s*=.92;break;case"fiend":case"medium":s*=.95;break;case"archfiend":case"titan":s*=1.25;break}let a=Q(e),n=[];Object.keys(r.portal.spire.status).forEach(function(p){n.push(p),s*=B(e,p)}),s*=He(e,a,n),s/=r.portal.spire.count;let l=0;for(let p=0;p<e.hardpoint.length;p++){let c=re(r.portal.spire.boss,e.hardpoint[p]);l+=s*ve(e,c)}return l}}var Ge;zt(r.settings.locale);function u(e,t){let s=Ge[e];if(!s)return r.settings.expose&&(console.error(`string ${e} not found`),console.log(Ge)),e;if(t)if(t instanceof Array){for(let l=0;l<t.length;l++){let p=new RegExp(`%${l}(?!\\d)`,"g");if(!p.exec(s)){r.settings.expose&&console.error(`"%${l}" was not found in the string "${e}" to be replace by "${t[l]}"`);continue}s=s.replace(p,t[l])}let a=new RegExp("%\\d+(?!\\d)","g"),n=s.match(a);n&&r.settings.expose&&console.error(`${n} was found in the string, but there is no variables to make the replacement`)}else r.settings.expose&&console.error('"variables" need be a instance of "Array"');return s}function zt(e){$.ajaxSetup({async:!1});let t;if($.getJSON("strings/strings.json",a=>{t=a}),e!="en-US"){let a;try{$.getJSON(`strings/strings.${e}.json`,l=>{a=l})}catch(l){console.error(l,l.stack)}let n=t.length;a&&Object.assign(t,a),t.length!=n&&r.settings.expose&&console.error(`string.${e}.json has extra keys.`)}let s=at.getItem("string_pack")||!1;if(s&&r.settings.sPackOn){let a;try{a=JSON.parse(LZString.decompressFromUTF16(s))}catch(l){console.error(l,l.stack)}let n=t.length;a&&Object.assign(t,a),t.length!=n&&r.settings.expose&&console.error("string pack has extra keys.")}$.ajaxSetup({async:!0}),Ge=t}var we={"en-US":"English (US)","es-ES":"Spanish (ESP)","pt-BR":"Portugu\xEAs (BR)","de-DE":"Deutsch","it-IT":"Italiano","ru-RU":"\u0420\u0443\u0441\u0441\u043A\u0438\u0439","cs-CZ":"\u010Ce\u0161tina","pl-PL":"Polski","zh-CN":"\u7B80\u4F53\u4E2D\u6587","zh-TW":"\u7E41\u9AD4\u4E2D\u6587","ko-KR":"\uD55C\uAD6D\uC5B4","im-PL":"Igpay-Atinlay"};function L(e){let t;if(e<0)t=u("time_never");else{e=+e.toFixed(0);let s=60;if(e<s)t=`${e}s`;else{let n=s*60,l=e%s,p=Math.floor(e/s)%60;if(e<n)l>0?t=`${p}m ${l}s`:t=`${p}m`;else{let m=n*24,f=Math.floor(e/n)%24;if(e<m)p>0?t=`${f}h ${p}m`:l>0?t=`${f}h ${l}s`:t=`${f}h`;else{let g=Math.floor(e/m);f>0?t=`${g}d ${f}h`:p>0?t=`${g}d ${p}m`:l>0?t=`${g}d ${l}s`:t=`${g}d`}}}}return t}function O(){this.min=Number.MAX_VALUE,this.max=Number.MIN_VALUE,this.med=0,this.avg=0}function I(e,t,s,a){this.count=e,this.boss=t,this.type=s,this.status=structuredClone(a)}I.areEqual=function(e,t){if(!e||!t||e.count!=t.count||e.boss!=t.boss||e.type!=t.type)return!1;let s=Object.keys(e.status),a=Object.keys(t.status);if(s.length!=a.length)return!1;for(let n of s)if(!a.includes(n))return!1;return!0};function X(e){return e.length==0?0:e.length%2==0?(e[e.length/2-1]+e[e.length/2])/2:e[(e.length+1)/2-1]}function R(e,t,s){return e+s*(t-e)}function J(e,t,s){return t==e?0:(s-e)/(t-e)}function le(e,t){return e-t}function ke(e,t,s){let a=this&&Number.isInteger(this)?this-1:199;if(s.length<=a)return!0;let n=(s.length+1)%2,l=(s.length-n+1)/2+n-1,p=t-l>>31;return(t-l-p*n)%Math.floor(s.length/a)==0||t%(s.length-1)==0}var x={spire:{terrain:["sand","swamp","forest","jungle","rocky","gravel","muddy","grass","brush","concrete"],hazards:["freeze","hot","corrosive","humid","windy","hilly","mountain","radioactive","quake","dust","river","tar","steam","flooded","fog","rain","hail","chasm","dark","gravity"]},mech:{size:{standard:["small","medium","large","titan","collector"],warlord:["minion","fiend","cyberdemon","archfiend"]},type:{standard:["wheel","tread","biped","quad","spider","hover"],minion:["imp","flying_imp","hound","harpy","barghest"],fiend:["cambion","minotaur","nightmare","rakshasa","golem"],cyberdemon:["wheel","tread","biped","quad","spider","hover"],archfiend:["dragon","snake","gorgon","hydra"]},equip:{standard:["special","shields","sonar","grapple","infrared","flare","radiator","coolant","ablative","stabilizer","seals"],warlord:["scavenger","scouter","darkvision","echo","thermal","manashield","cold","heat","athletic","lucky","stoneskin"]}}};function oe(e){if(!r||!r.portal?.spire||r.portal?.spire.boss=="")return 0;let t=1,s=Q(e),a=[];return Object.keys(r.portal.spire.status).forEach(function(n){a.push(n),t*=B(e,n)}),t*=He(e,s,a),t}function ce(e){if(!r||!r.portal?.spire||r.portal?.spire.boss==""||e.hardpoint.length==0)return 0;let t=0;for(let s=0;s<e.hardpoint.length;s++){let a=re(r.portal.spire.boss,e.hardpoint[s]);t+=ve(e,a)}return t/e.hardpoint.length}function dt(e,t,s){if(!r||!r.portal?.spire||r.portal?.spire.boss=="")return 0;let a=1;return s&&(a=Math.floor(he()/j(e.size))),ne(e,t)*r.portal.spire.count*a}function Je(e,t){return t*r.portal.spire.count*Math.floor(he()/j(e.size))}function he(e=!1){return e?r.blood.prepared&&r.blood.prepared>=2?120:200:r.blood.prepared&&r.blood.prepared>=2?r.race.warlord?30:40:r.race.warlord?40:50}var h={currentPage:0,initialized:!1,inTransition:!1,isVisible:!0,armed:!1,copied:!1,copyPage:0,pages:[],specialPages:[],userLabel:null,init(){if(h.initialized)return;d.heap.pageFilters||(d.heap.pageFilters={});let e=$("#pageSelector"),t=$(e.next(".dropdownContent").get(0)).empty(),s=$("#mechLists");h.userLabel=$('<input type="text" id="pageUserLabel" class="fullSpan spanImpostor" maxlength="32"></input>'),h.userLabel.on("click",m=>{m.stopPropagation()}),h.userLabel.on("input",h.updateLabel),h.userLabel.on("keyup",m=>{m.which==13}),t.append(h.userLabel),h.pages.length=d.maxMechPages;for(var a=0;a<h.pages.length;a++){let m=d.labels[a]?`P${a+1} | ${d.labels[a]}`:`${u("mcs_pager_page")} ${a+1}`;h.pages[a]=d.config.virtualList?new xe(a,m,ue(a),a,!0):new fe(a,m,ue(a),a,!0),t.append($(`<a data-val="${a}">${a+1}</a>`).on("click",{i:a},f=>{setTimeout(()=>{h.showPage(f.data.i),h.update(!0)},0)})),s.append(h.pages[a].dom)}let n=new Ue("hvt",u("mcs_pager_page_heavy_v_titan",[u("portal_mech_size_large"),u("portal_mech_size_titan")]),[],!1);h.specialPages.push(n),t.append($('<a class="fullSpan"></a>').text(n.name).on("click",{i:-h.specialPages.length},m=>{setTimeout(()=>{h.showPage(m.data.i),h.update(!0)},0)})),s.append(n.dom);let l=d.config.virtualList?new xe("mechbay",u("portal_mechbay_title"),r.portal.mechbay.mechs??[],-1,!0):new fe("mechbay",u("portal_mechbay_title"),r.portal.mechbay.mechs??[],-1,!0);h.specialPages.push(l),t.append($('<a class="fullSpan"></a>').text(l.name).on("click",{i:-h.specialPages.length},m=>{setTimeout(()=>{h.showPage(m.data.i),h.update(!0)},0)})),s.append(l.dom),d.on(d.EV_CLOSE_DROPDOWNS,h.disarmClearList),d.on(d.EV_OPEN_DROPDOWN,m=>{$("#listJsonString").val("")});let p=$("#listJsonString").on("click",m=>{m.stopPropagation()}).on("focus",m=>{m.target.select()});$("#listJsonExport").on("click",m=>{m.stopPropagation(),$("#listJsonString").val(JSON.stringify(h.getCurrentList())).select(),document.execCommand("copy")}),$("#listJsonForm").on("submit",m=>{m.preventDefault(),h.importJSONList()});let c=$($("#clearList").next(".dropdownContent").get(0));c.on("click",m=>{m.stopPropagation()}),$("#clearList").on("click",h.disarmClearList),$("#clearListArm").on("click",m=>{h.armed=!h.armed,h.armed?$("#clearListAbsolutely").toggleClass("inactive",!1).on("click",f=>{c.toggleClass("show",!1),h.clearList(),h.disarmClearList()}):$("#clearListAbsolutely").toggleClass("inactive",!0).off("click")}),$("#copyList").on("click",m=>{h.copied=!0,h.copyPage=h.currentPage,h.setPasteControls(h.copyPage!=h.currentPage),M("info",u("mcs_info_page_copied"))}),$("#pasteListConfirm").on("click",m=>{h.copyPage!=h.currentPage&&(h.copied=!1,h.copyFromTo(h.copyPage,h.currentPage),h.setPasteControls(!1))}),$("#pasteListClear").on("click",m=>{h.copyPage!=h.currentPage&&(h.copied=!1,h.setPasteControls(!1))}),h.currentPage=d.config.defaultPage,h.initialized=!0,h.showPage(h.currentPage)},showPage(e){if(h.initialized!=!1){for(var t=0;t<h.pages.length;t++)t!=e&&h.pages[t].hide();for(var t=0;t<h.specialPages.length;t++)t!=-(e+1)&&h.specialPages[t].hide();if(e<0){if(Math.abs(e)>h.specialPages.length)return;switch(h.currentPage=e,h.specialPages[-(e+1)].key){case"mechbay":h.specialPages[-(e+1)].hide(),h.specialPages[-(e+1)].mechList=r.portal.mechbay.mechs??[];break}h.isVisible&&h.specialPages[-(e+1)].show(),h.userLabel.attr("style","display: none");let s=$($("#pageSelector").text(`${h.specialPages[-(e+1)].name}`).next(".dropdownContent").get(0));$(s.children("a").toggleClass("current",!1).get(h.pages.length+Math.abs(e)-1)).toggleClass("current",!0),h.setCopyControls(h.specialPages[-(e+1)].mechList.length>0)}else{if(e>=h.pages.length)return;h.currentPage=e,h.isVisible&&h.pages[e].show(),h.userLabel.attr("style",""),h.userLabel.attr("placeholder",`${u("mcs_pager_page")} ${e+1}`),h.userLabel.val(d.labels[e]?d.labels[e]:"");let s=$($("#pageSelector").text(d.labels[e]?`P${e+1} | ${d.labels[e]}`:`${u("mcs_pager_page")} ${e+1}`).next(".dropdownContent").get(0));$(s.children("a").toggleClass("current",!1).get(e)).toggleClass("current",!0),h.setCopyControls(h.pages[e].mechList.length>0)}h.setPasteControls(h.copied&&h.copyPage!=h.currentPage),d.config.defaultPage=h.currentPage,T()}},update(e){if(h.initialized!=!1&&h.isVisible&&!(e&&!F()))if(h.currentPage<0){if(Math.abs(h.currentPage)>h.specialPages.length)return;let t=-(h.currentPage+1);h.specialPages[t].update(e)}else{if(h.currentPage>=h.pages.length)return;h.pages[h.currentPage].update(e)}},hide(){if(h.initialized!=!1){for(var e=0;e<h.pages.length;e++)h.pages[e].hide();for(var e=0;e<h.specialPages.length;e++)h.specialPages[e].hide()}},addMech(e){if(h.currentPage<0){if(Math.abs(h.currentPage)>h.specialPages.length)return;h.specialPages[-(h.currentPage+1)].addMech(e)}else{if(h.currentPage>=h.pages.length)return;h.pages[h.currentPage].addMech(e)}},getCurrent(){if(h.currentPage<0){if(Math.abs(h.currentPage)>h.specialPages.length)return null;let e=-(h.currentPage+1);return h.specialPages[e]}else return h.currentPage>=h.pages.length?null:h.pages[h.currentPage]},getCurrentList(){if(h.currentPage<0){if(Math.abs(h.currentPage)>h.specialPages.length)return[];let e=-(h.currentPage+1);return h.specialPages[e].mechList}else return h.currentPage>=h.pages.length?[]:h.pages[h.currentPage].mechList},disarmClearList(){h.armed=!1,$("#clearListAbsolutely").toggleClass("inactive",!0).off("click")},clearList(e){if(!h.armed)return;Number.isInteger(e)||(e=h.currentPage);let t;if(h.currentPage<0){if(Math.abs(h.currentPage)>h.specialPages.length)return[];let s=-(h.currentPage+1);t=h.specialPages[s]}else{if(h.currentPage>=h.pages.length)return[];t=h.pages[h.currentPage]}t.clearable&&(t.mechList=[],h.currentPage>=0&&Ae(h.currentPage,[]),h.setCopyControls(!1),M("~",`Cleared list ${h.currentPage} ${e}`),setTimeout(()=>{t.hide(),t.show(),t.update(F())},0))},saveMechList(e,t){e<0||(M("log",Ae(e,t)),e==h.copyPage&&(!t||t.length==0)&&(h.copied=!1,h.setPasteControls(!1)),e==h.currentPage&&h.setCopyControls(t&&t.length>0))},updateLabel(e){if(h.currentPage<0)return;let t=e.target.value?e.target.value:"";d.labels[h.currentPage]=t.trim().substring(0,32),h.pages[h.currentPage].name=d.labels[h.currentPage]?`P${h.currentPage+1} | ${d.labels[h.currentPage]}`:`${u("mcs_pager_page")} ${h.currentPage+1}`,ct(),$("#pageSelector").text(h.pages[h.currentPage].name)},setPasteControls(e){e&&h.currentPage>=0?$("#pasteList").attr("style",""):$("#pasteList").attr("style","visibility: hidden")},setCopyControls(e){e?$("#copyList").attr("style",""):$("#copyList").attr("style","visibility: hidden")},copyFromTo(e,t){if(e==t||t<0)return;let s=e<0?h.specialPages[-(e+1)]:h.pages[e];if(s.mechList.length==0)return;h.saveMechList(t,s.mechList);let a=h.pages[t];M("info",u("mcs_info_page_pasted",[s.name,a.name])),a.mechList=ue(t),setTimeout(()=>{a.hide(),a.show(),a.update(F())},0)},importJSONList(){let e=Tt($("#listJsonString").val());if(e.length>0){let t=h.getCurrent();t&&t.modifiable?(M("success",u("mcs_success_import")),h.saveMechList(h.currentPage,e),t.mechList=h.currentPage<0?e:ue(h.currentPage),setTimeout(()=>{t.hide(),t.show(),t.update(F())},0)):M("error",u("mcs_error_page_unmodifiable"))}else $("#listJsonString").val(""),M("error",u("mcs_error_invalid_str"))}};function Tt(e){let t=[];try{t=JSON.parse(e)}catch{return[]}if(!Array.isArray(t))return[];let s=!0;for(var a=0;a<t.length&&s;a++)s=s&&t[a].hasOwnProperty("size")&&t[a].hasOwnProperty("hardpoint")&&t[a].hasOwnProperty("chassis")&&t[a].hasOwnProperty("equip")&&t[a].hasOwnProperty("infernal")&&Array.isArray(t[a].hardpoint)&&Array.isArray(t[a].equip);return s?t:[]}var $e=class{constructor(){U(this,"shown",!1)}show(){this.shown||(this.shown=!0)}hide(){this.shown&&(this.shown=!1)}update(){this.shown}},xe=class extends $e{constructor(s,a,n,l,p=!0){super();U(this,"filter",s=>{if(this.shown&&s&&s.target&&s.target.dataset.hasOwnProperty("pageFilter")){switch(s.target.dataset.pageFilter){case"minion":case"small":this.pageFilters.minion=!this.pageFilters.minion,this.pageFilters.small=!this.pageFilters.small;break;case"fiend":case"medium":this.pageFilters.fiend=!this.pageFilters.fiend,this.pageFilters.medium=!this.pageFilters.medium;break;case"cyberdemon":case"large":this.pageFilters.cyberdemon=!this.pageFilters.cyberdemon,this.pageFilters.large=!this.pageFilters.large;break;case"archfiend":case"titan":this.pageFilters.archfiend=!this.pageFilters.archfiend,this.pageFilters.titan=!this.pageFilters.titan;break;default:this.pageFilters[s.target.dataset.pageFilter]=!this.pageFilters[s.target.dataset.pageFilter]}d.heap.pageFilters[this.key]=this.pageFilters,We(),setTimeout(()=>{this.hide(),this.show(),this.pageMeta.update(this.pageFilters),this.update(F())},0)}});U(this,"removeMech",s=>{if(!s||s.mechItem===null)return;let a=this.mechList.indexOf(s.mechItem.mech),n=this.items.indexOf(s.mechItem);a<0||n<0||(this.pageMeta.totals[this.mechList[a].size]--,this.mechList.splice(a,1),this.items.splice(n,1),h.saveMechList(this.id,this.mechList),this.key=="mechbay"&&r.eden?.mech_station?.mechs&&(r.eden.mech_station.mechs=0),setTimeout(()=>{this.hide(),this.show(),this.pageMeta.update(this.pageFilters),this.update(F())},0))});this.key=s,this.name=a,this.id=l,this.mechList=n,this.items=[],this.filteredItems=[],this.lines=[],this.heights=[],this.dom=$(`<div id="mpage-${l}" class="smaller vlist"></div>`).get(0),this.modifiable=p,this.clearable=!0,this.originalOrder=!0,this.pageFilters=Object.create(ut),d.heap.pageFilters[this.key]&&Object.assign(this.pageFilters,d.heap.pageFilters[this.key]),this.pageMeta=new Se,this.pageMeta.dom=this.pageMeta.dom.get(0),this.pageMeta.summaryDom.addEventListener("click",this.filter),this.pageMeta.totals=Object.create(Ce),this.container=document.createElement("div"),this.container.className="mpage-cont",this.dudString=mt(s=="mechbay"?u("mcs_pager_dud_mechbay"):u("mcs_pager_dud_empty")),this.delimiters=0,this.observer,this.cobserver,this.scrollHandler=be(this.scrollHandler.bind(this),25),this.positionVirtualItems=this.positionVirtualItems.bind(this),this.viewport={scroll:0,top:0,start:0,end:0,overscan:10,length:50,height:480},s=="mechbay"&&(this.pageFilters.collector=!1)}show(){if(this.shown)return;this.shown=!0,this.cobserver=new IntersectionObserver(l=>{for(let c of l)if(c.target==this.container){let m=c.target;for(this.viewport.top=0,this.viewport.height=c.rootBounds.height,this.viewport.length=Math.min(90,Math.max(40,Math.ceil(this.viewport.height/22)+5));m!==null;)this.viewport.top+=m.offsetTop,m=m.offsetParent}else c.boundingClientRect.height>0&&c.target.dataset.idx>=0&&(this.filteredItems[c.target.dataset.idx].height=c.boundingClientRect.height+2);let p=0;for(let c=0;c<this.filteredItems.length;c++)this.heights[c]=p,p+=this.filteredItems[c].height},{root:null,threshold:[0,.01,.05,.1,.5,.75,.9,.99,1]}),this.observer=new ResizeObserver(l=>{for(let c of l)c.contentRect.height>0&&c.target.dataset.idx>=0&&(this.filteredItems[c.target.dataset.idx].height=c.contentRect.height+2);let p=0;for(let c=0;c<this.filteredItems.length;c++)this.heights[c]=p,p+=this.filteredItems[c].height});let s=this.mechList.length!=this.items.length,a=0,n=0;this.pageMeta.totals=Object.create(Ce),s&&(this.items.length=0),this.mechList.forEach(function(l,p){let c;s?(c=new ze(l,p),this.items.push(c)):c=this.items[p],this.pageFilters[l.size]&&(this.heights.push(a),this.filteredItems.push(c),a+=c.height),n+=j(l.size),this.pageMeta.totals[l.size]++},this);for(let l=0;l<this.viewport.length+this.viewport.overscan*2;l++){let p=new Te(this.modifiable,this.removeMech);this.lines.push(p),this.observer.observe(p.line,pt),this.cobserver.observe(p.line),this.container.appendChild(p.line)}if(this.mechList.length==0)this.dom.appendChild($(this.dudString).get(0)),this.pageMeta.update(this.pageFilters);else{let l=document.createElement("span");l.appendChild(document.createTextNode(`${n}`));let p;this.key=="mechbay"?(p=` / ${r.portal.mechbay.max}`,n>r.portal.mechbay.max&&(l.className="error")):p="/ \u221E",this.pageMeta.spaceDom.replaceChildren(l,p),this.pageMeta.update(this.pageFilters),this.dom.appendChild(this.container),this.cobserver.observe(this.container)}this.dom.prepend(this.pageMeta.dom),this.scrollHandler(),window.addEventListener("resize",this.scrollHandler),document.addEventListener("scroll",this.scrollHandler)}hide(){this.shown&&(this.shown=!1,window.removeEventListener("resize",this.scrollHandler),document.removeEventListener("scroll",this.scrollHandler),this.lines.length=0,this.filteredItems.length=0,this.heights.length=0,this.dom.removeChild(this.pageMeta.dom),this.container.parentElement&&this.dom.removeChild(this.container),this.container.replaceChildren(),this.dom.replaceChildren(),this.delimiters=0,this.cobserver.disconnect(),this.observer.disconnect())}update(s){if(!this.shown)return;let a=0,n=0,l=this.key=="mechbay"&&r.eden?.mech_station?.mechs||0,p=s?Object.keys(this.pageMeta.factors):{};if(s?(this.delimiters>0&&(this.dom.children(".delimiter").remove(),this.delimiters=0),this.pageMeta.factors.reset(),this.items.forEach(function(c){n+=j(c.mech.size),c.calc(),c.mech.size!=="collector"&&(p.forEach(function(m,f){switch(m){case"rr":l>0?l--:(n<=r.portal.mechbay.max||this.key!="mechbay")&&(this.pageMeta.factors[m].val+=c.factors[m].val);break;default:this.pageMeta.factors[m].val=(c.factors[m].val+a*this.pageMeta.factors[m].val)/(a+1)}},this),a++)},this)):this.items.forEach(function(c){n+=j(c.mech.size)}),s){this.pageMeta.factors.applyValues(),this.pageMeta.factors.ar.dom.setAttribute("title",`${u("mcs_pager_total_raw_rate")}: ${ae.format(Math.round(this.pageMeta.factors.rr.val*1e3*r.portal.spire.count))}`);let c="ET ["+(this.pageMeta.factors.rr?.val?L(100/this.pageMeta.factors.rr.val):L(-1))+"]";if(this.key=="mechbay"){let m=document.createElement("span");n>r.portal.mechbay.max&&(m.className="error"),m.appendChild(document.createTextNode(`${n}`)),this.pageMeta.spaceDom.replaceChildren(m,` / ${r.portal.mechbay.max}`),c+=`    - ${(100-r.portal.spire.progress).toFixed(2)}% left [`+(this.pageMeta.factors.rr?.val?L((100-r.portal.spire.progress)/this.pageMeta.factors.rr.val):L(-1))+"]",r.eden?.mech_station?.mechs>0&&(c+=` - ${r.eden.mech_station.mechs} mechs busy in ${u("tab_eden")}`)}this.pageMeta.etaDom.textContent=c}if(this.key!="mechbay"){let c=document.createElement("span");c.appendChild(document.createTextNode(`${n}`)),this.pageMeta.spaceDom.replaceChildren(c,"/ \u221E")}s&&this.sort(!0),this.setVirtualItems(s,this.viewport.start,this.viewport.end)}sort(s){let a=!1,n,l,p=d.config.sortingType==4?0:d.config.groupingType;switch(p){case 1:case 2:l=(c,m)=>c.v2<m.v2?1:c.v2>m.v2?-1:c.v1<m.v1?-d.config.sortingDirection:c.v1>m.v1?d.config.sortingDirection:0;break;default:l=(c,m)=>c.v1<m.v1?-d.config.sortingDirection:c.v1>m.v1?d.config.sortingDirection:0;break}switch(d.config.sortingType){case 1:case 2:case 3:n=this.filteredItems.map((c,m)=>({i:m,v1:(()=>{switch(d.config.sortingType){case 1:return c.factors.ff.val;case 2:return c.factors.ar.val;case 3:return ee[c.mech.size]}})(),v2:(()=>{switch(p){case 1:return ee[c.mech.size];case 2:return _e[c.mech.chassis];default:return null}})()})),a=!0,this.originalOrder=!1;break;case 4:if(this.originalOrder)return!1;n=this.filteredItems.map((c,m)=>({i:m,v1:this.mechList.indexOf(c.mech),v2:null}),this),l=(c,m)=>m.v1<c.v1?1:m.v1>c.v1?-1:0,a=!0,this.originalOrder=!0;break;default:return!1}return n.sort(l),this.filteredItems=n.map(c=>this.filteredItems[c.i]),a}getTotalHeight(s=-1){return this.heights[this.heights.length-1]+42}getTopHeight(s=-1){return s<0||s>=this.heights.length?0:this.heights[s]}findStartIndex(s,a){let n=0,l=s.length-1;for(;n<=l;){let p=n+Math.floor((l-n)/2);if(s[p]<a)n=p+1;else if(s[p]>a)l=p-1;else return p-1}return s.length>0&&n>0?l-1:0}scrollHandler(){let s=window.scrollY;if(s-this.viewport.top>0?this.viewport.start=this.findStartIndex(this.heights,s-this.viewport.top):this.viewport.start=0,this.lines.length<this.viewport.length+this.viewport.overscan*2)for(let a=this.lines.length;a<this.viewport.length+this.viewport.overscan*2;a++){let n=new Te(this.modifiable,this.removeMech);this.lines.push(n),this.observer.observe(n.line,pt),this.cobserver.observe(n.line),this.container.appendChild(n.line)}this.viewport.end=Math.min(this.filteredItems.length,this.viewport.start+this.viewport.length+this.viewport.overscan),this.viewport.start=Math.min(this.filteredItems.length>0?this.filteredItems.length-1:0,Math.max(0,this.viewport.start-this.viewport.overscan)),this.container.style=`height: ${this.getTotalHeight()}px`,this.setVirtualItems(F(),this.viewport.start,this.viewport.end),setTimeout(a=>{window.requestAnimationFrame(this.positionVirtualItems)},0)}setVirtualItems(s,a,n){let l=a,p=this.getTopHeight(l);for(;l<n&&l-a<this.lines.length;l++)this.lines[l-a].set(this.filteredItems[l],l,d.config.truncateWeapons),s&&this.lines[l-a].calc(),this.lines[l-a].line.style.display=null,this.lines[l-a].line.style.transform=`translate(0px, ${p}px)`,p+=this.filteredItems[l].height;for(;l-a<this.lines.length;l++)this.lines[l-a].line.style.display="none",this.lines[l-a].set(null,-1,d.config.truncateWeapons)}positionVirtualItems(){for(let s=this.viewport.start;s<this.viewport.end&&s-this.viewport.start<this.lines.length;s++)this.lines[s-this.viewport.start].line.style.transform=`translate(0px, ${this.getTopHeight(s)}px)`}addMech(s){if(!this.modifiable){M("error",u("mcs_error_page_unmodifiable"));return}this.key=="mechbay"&&r.eden?.mech_station?.mechs&&(r.eden.mech_station.mechs=0),this.mechList.push(s),h.saveMechList(this.id,this.mechList);let a=new ze(s,this.mechList.length);this.items.push(a),this.pageMeta.totals[s.size]++,this.pageMeta.update(this.pageFilters),this.hide(),this.show(),M("log","Mech added","added_mech")}},fe=class extends $e{constructor(s,a,n,l,p=!0){super();U(this,"filter",s=>{if(this.shown&&s&&s.target&&s.target.dataset.hasOwnProperty("pageFilter")){switch(s.target.dataset.pageFilter){case"minion":case"small":this.pageFilters.minion=!this.pageFilters.minion,this.pageFilters.small=!this.pageFilters.small;break;case"fiend":case"medium":this.pageFilters.fiend=!this.pageFilters.fiend,this.pageFilters.medium=!this.pageFilters.medium;break;case"cyberdemon":case"large":this.pageFilters.cyberdemon=!this.pageFilters.cyberdemon,this.pageFilters.large=!this.pageFilters.large;break;case"archfiend":case"titan":this.pageFilters.archfiend=!this.pageFilters.archfiend,this.pageFilters.titan=!this.pageFilters.titan;break;default:this.pageFilters[s.target.dataset.pageFilter]=!this.pageFilters[s.target.dataset.pageFilter]}d.heap.pageFilters[this.key]=this.pageFilters,We(),setTimeout(()=>{this.pageMeta.update(this.pageFilters),this.update(!1)},0)}});U(this,"removeMech",s=>{let a=this.mechList.indexOf(s.mech),n=this.lines.indexOf(s);a<0||n<0||(s.dom.remove(),this.pageMeta.totals[this.mechList[a].size]--,this.mechList.splice(a,1),this.lines.splice(n,1),h.saveMechList(this.id,this.mechList),this.lines.length==0&&(this.pageMeta.dom.detach(),this.dom.empty(),this.dom.append(this.pageMeta.dom),this.dom.append(this.dudString)),this.key=="mechbay"&&r.eden?.mech_station?.mechs&&(r.eden.mech_station.mechs=0),setTimeout(()=>{this.pageMeta.update(this.pageFilters),this.update(F())},0))});this.key=s,this.name=a,this.id=l,this.mechList=n,this.lines=[],this.dom=$(`<div id="mpage-${l}" class="smaller"></div>`),this.modifiable=p,this.clearable=!0,this.originalOrder=!0,this.pageFilters=Object.create(ut),d.heap.pageFilters[this.key]&&Object.assign(this.pageFilters,d.heap.pageFilters[this.key]),this.pageMeta=new Se,this.pageMeta.summaryDom.addEventListener("click",this.filter),this.pageMeta.totals=Object.create(Ce),this.dudString=mt(s=="mechbay"?u("mcs_pager_dud_mechbay"):u("mcs_pager_dud_empty")),this.delimiters=0,s=="mechbay"&&(this.pageFilters.collector=!1)}show(){if(this.shown)return;this.pageMeta.dom.detach(),this.dom.empty(),this.shown=!0;let s=0;if(this.pageMeta.totals=Object.create(Ce),this.mechList.forEach(function(a,n){let l=new Me(a,n,d.config.truncateWeapons,this.modifiable,this.removeMech);this.lines.push(l),this.pageFilters[a.size]&&this.dom.append(l.dom),s+=j(a.size),this.pageMeta.totals[a.size]++},this),this.lines.length==0)this.dom.append(this.dudString),this.pageMeta.update(this.pageFilters);else{let a=document.createElement("span");a.appendChild(document.createTextNode(`${s}`));let n;this.key=="mechbay"?(n=` / ${r.portal.mechbay.max}`,s>r.portal.mechbay.max&&(a.className="error")):n="/ \u221E",this.pageMeta.spaceDom.replaceChildren(a,n),this.pageMeta.update(this.pageFilters)}this.dom.prepend(this.pageMeta.dom)}hide(){this.shown&&(this.shown=!1,this.lines.length=0,this.pageMeta.dom.detach(),this.dom.empty(),this.delimiters=0)}update(s){if(!this.shown)return;let a=0,n=0,l=this.key=="mechbay"&&r.eden?.mech_station?.mechs||0,p=s?Object.keys(this.pageMeta.factors):{};if(s){this.pageMeta.factors.reset();for(var c=0;c<this.mechList.length;c++)n+=j(this.mechList[c].size),l>0&&this.mechList[c].size!=="collector"?l--:(n<=r.portal.mechbay.max||this.key!="mechbay")&&(this.pageMeta.factors.rr.val+=ne(this.mechList[c],!1))}if(n=0,s)this.delimiters>0&&(this.dom.children(".delimiter").remove(),this.delimiters=0),this.lines.forEach(function(m){n+=j(m.mech.size),m.calc(),m.mech.size!=="collector"&&(p.forEach(function(f,g){switch(f){case"rr":break;default:this.pageMeta.factors[f].val=(m.factors[f].val+a*this.pageMeta.factors[f].val)/(a+1)}},this),a++)},this);else{let m,f=-1,g=0,v=-1,b=0,_=d.config.sortingType!=0&&d.config.sortingType!=4&&d.config.groupingType==2&&F();this.delimiters>0&&(this.dom.children(".delimiter").remove(),this.delimiters=0),this.lines.forEach(function(w,k){n+=j(w.mech.size);let S=!1;this.pageFilters[w.mech.size]&&w.dom.parent().length==0?(m?.dom.parent().length>0?m.dom.after(w.dom):this.pageMeta.dom.after(w.dom),m=w,S=!0):this.pageFilters[w.mech.size]==!1?w.dom.detach():(m=w,S=!0),_&&S&&(v=_e[w.mech.chassis],f>=0&&f!=v?(this.lines[g].dom.before(ye("portal_mech_chassis_",this.lines[g].mech.chassis,b)),this.delimiters++,b=1,g=k):b++,f==-1&&(g=k),f=v),w.truncate(d.config.truncateWeapons)},this),_&&g>=0&&g<this.lines.length&&(this.lines[g].dom.before(ye("portal_mech_chassis_",this.lines[g].mech.chassis,b)),this.delimiters++)}if(s){this.pageMeta.factors.applyValues(),this.pageMeta.factors.ar.dom.setAttribute("title",`${u("mcs_pager_total_raw_rate")}: ${ae.format(Math.round(this.pageMeta.factors.rr.val*1e3*r.portal.spire.count))}`);let m="ET ["+(this.pageMeta.factors.rr?.val?L(100/this.pageMeta.factors.rr.val):L(-1))+"]";if(this.key=="mechbay"){let f=document.createElement("span");n>r.portal.mechbay.max&&(f.className="error"),f.appendChild(document.createTextNode(`${n}`)),this.pageMeta.spaceDom.replaceChildren(f,` / ${r.portal.mechbay.max}`),m+=`    - ${(100-r.portal.spire.progress).toFixed(2)}% left [`+(this.pageMeta.factors.rr?.val?L((100-r.portal.spire.progress)/this.pageMeta.factors.rr.val):L(-1))+"]",r.eden?.mech_station?.mechs>0&&(m+=` - ${r.eden.mech_station.mechs} mechs busy in ${u("tab_eden")}`)}this.pageMeta.etaDom.textContent=m}if(this.key!="mechbay"){let m=document.createElement("span");m.appendChild(document.createTextNode(`${n}`)),this.pageMeta.spaceDom.replaceChildren(m,"/ \u221E")}if(s&&this.sort(!0)){let m=-1,f=-1,g=-1,v=0,b=d.config.sortingType!=0&&d.config.sortingType!=4&&d.config.groupingType==2;for(var c=this.lines.length-1;c>=0;c--)this.pageFilters[this.lines[c].mech.size]?(b&&(g=_e[this.lines[c].mech.chassis],m>=0&&m!=g?(this.pageMeta.dom.after(ye("portal_mech_chassis_",this.lines[f].mech.chassis,v)),this.delimiters++,v=1):v++,m=g,f=c),this.pageMeta.dom.after(this.lines[c].dom)):this.lines[c].dom.detach();b&&f>=0&&f<this.lines.length&&(this.pageMeta.dom.after(ye("portal_mech_chassis_",this.lines[f].mech.chassis,v)),this.delimiters++)}}sort(s){let a=!1,n,l,p=d.config.sortingType==4?0:d.config.groupingType;switch(p){case 1:case 2:l=(c,m)=>c.v2<m.v2?1:c.v2>m.v2?-1:c.v1<m.v1?-d.config.sortingDirection:c.v1>m.v1?d.config.sortingDirection:0;break;default:l=(c,m)=>c.v1<m.v1?-d.config.sortingDirection:c.v1>m.v1?d.config.sortingDirection:0;break}switch(d.config.sortingType){case 1:case 2:case 3:n=this.lines.map((c,m)=>({i:m,v1:(()=>{switch(d.config.sortingType){case 1:return c.factors.ff.val;case 2:return c.factors.ar.val;case 3:return ee[c.mech.size]}})(),v2:(()=>{switch(p){case 1:return ee[c.mech.size];case 2:return _e[c.mech.chassis];default:return null}})()})),a=!0,this.originalOrder=!1;break;case 4:if(this.originalOrder)return!1;n=this.lines.map((c,m)=>({i:m,v1:this.mechList.indexOf(c.mech),v2:null}),this),l=(c,m)=>m.v1<c.v1?1:m.v1>c.v1?-1:0,a=!0,this.originalOrder=!0;break;default:return!1}return n.sort(l),this.lines=n.map(c=>this.lines[c.i]),a}addMech(s){if(!this.modifiable){M("error",u("mcs_error_page_unmodifiable"));return}this.lines.length==0&&(this.pageMeta.dom.detach(),this.dom.empty(),this.dom.append(this.pageMeta.dom)),this.key=="mechbay"&&r.eden?.mech_station?.mechs&&(r.eden.mech_station.mechs=0);let a=new Me(s,this.mechList.length,d.config.truncateWeapons,this.modifiable,this.removeMech);this.mechList.push(s),this.lines.push(a),this.dom.append(a.dom),this.pageMeta.totals[s.size]++,this.pageMeta.update(this.pageFilters),h.saveMechList(this.id,this.mechList),M("log","Mech added","added_mech")}},Ue=class extends fe{constructor(s,a,n,l,p=!1){super(s,a,[{size:"large",hardpoint:["tesla","tesla"],chassis:"hover",equip:["special","coolant","shields"],infernal:!1},{size:"titan",hardpoint:["tesla","tesla","tesla","tesla"],chassis:"hover",equip:["special","coolant","shields","sonar","stabilizer"],infernal:!1}],l,!1);U(this,"removeMech",s=>{});this.clearable=!1,this.explainLine=$('<div class="line"><div class="text" id="hvtExplain"></div></div>');let m=`<span class="titan">${u("portal_mech_size_titan")}</span>`,f=`<span class="large">${u("portal_mech_size_large")}</span>`,g=`<i>${u("portal_mech_equip_target")}</i>`;this.explainLine.children("#hvtExplain").append(`<p>${u("mcs_hvt_p1",[m,f,g])}</p>`).append(`<p>${u("mcs_hvt_p2")}</p>`)}syncWithConstructor(){if(x.mech.size.standard.includes(o.mech.size))for(let s of this.mechList){s.chassis=o.mech.chassis,s.infernal=o.mech.infernal;for(let a=0;a<s.hardpoint.length;a++)a<o.mech.hardpoint.length&&(s.hardpoint[a]=o.mech.hardpoint[a]);for(let a=0;a<s.equip.length;a++)a<o.mech.equip.length&&(s.equip[a]=o.mech.equip[a])}}show(){this.syncWithConstructor(),super.show(),this.dom.append(this.explainLine),d.on(d.EV_CONSTRUCTOR,s=>{this.hide(),this.show(),this.update(F())})}hide(){d.off(d.EV_CONSTRUCTOR),this.explainLine.detach(),super.hide()}update(s){this.syncWithConstructor(),this.explainLine.detach(),super.update(s),this.dom.append(this.explainLine)}addMech(s){M("error",u("mcs_error_page_unmodifiable"))}},mt=e=>`<div class="line" ><div class="text"><span><i>&lt; ${e.replaceAll("<","&lt;").replaceAll(">","&gt;")} &gt;</i></span></div></div>`,Ze=x.mech.size.standard.concat(x.mech.size.warlord),ee={collector:0,minion:1,small:2,fiend:3,medium:4,cyberdemon:5,large:6,archfiend:7,titan:8};Ze.forEach(e=>{ee[e]??(ee[e]=0)});var _e=Object.fromEntries([...new Set([...x.mech.type.standard,...x.mech.type.minion,...x.mech.type.fiend,...x.mech.type.cyberdemon,...x.mech.type.archfiend])].sort().map((e,t)=>[e,t])),ut=Object.fromEntries(Ze.map(e=>[e,!0])),Ce=Object.fromEntries(Ze.map(e=>[e,0]));function ye(e,t,s){let a=document.createElement("div");a.className=`mcLn line delimiter ${t}`;let n=document.createElement("div");n.className="title";let l=document.createElement("span");return l.textContent=`${s}x ${u(`${e}${t}`)}`,n.appendChild(l),a.appendChild(n),a}function se(){this.tf={val:0,dom:null},this.wf={val:0,dom:null},this.ff={val:0,dom:null},this.ar={val:0,dom:null},this.rr={val:0,dom:null}}var te=Object.keys(new se);se.prototype.applyValues=function(){te.forEach(function(e){switch(e){case"rr":break;case"ar":this[e].val!=0?this[e].dom.textContent=ae.format((this[e].val*1e3).toFixed(0)):this[e].dom.textContent="-";break;default:this[e].dom.textContent=(this[e].val*100).toFixed(1)+"%"}},this)};se.prototype.reset=function(){te.forEach(function(e){this[e].val=0},this)};var Se=class{constructor(){this.factors=new se;let t=[];te.forEach(function(l,p){if(l=="rr")return;let c=document.createElement("div");c.className=`stat sco${p}`,t.push(c),this.factors[l].dom=c},this);let s=document.createElement("div");s.className="mcLn line meta";let a=document.createElement("div");a.className="title",this.spaceDom=document.createElement("span"),this.summaryDom=document.createElement("span"),this.summaryDom.className="summary",this.summaryDom.setAttribute("title",u("mcs_pager_filter")),a.appendChild(this.spaceDom),a.appendChild(this.summaryDom);let n=document.createElement("div");n.className="form",this.etaDom=document.createElement("span"),n.appendChild(this.etaDom),s.appendChild(a);for(let l of t)s.appendChild(l);s.appendChild(n),this.dom=$(s)}update(t){let s=[];s.push(["titan",this.totals.titan+this.totals.archfiend,t.titan]),s.push(["large",this.totals.large+this.totals.cyberdemon,t.large]),s.push(["medium",this.totals.medium+this.totals.fiend,t.medium]),s.push(["small",this.totals.small+this.totals.minion,t.small]),s.push(["collector",this.totals.collector,t.collector]);let a=[];s.forEach(function(n){if(n[1]>0){let l=document.createElement("a");l.className=`${n[0]} clickable`,l.appendChild(document.createTextNode(`${n[2]?"\u25FC":"\u25FB"} ${n[1]}`)),l.dataset.pageFilter=`${n[0]}`,a.push(l)}}),this.summaryDom.replaceChildren(...a)}},pt={box:"border-box"},ze=class{constructor(t,s){this.idx=s,this.mech=t,this.factors=new se,this.height=22}calc(){this.factors.tf.val=oe(this.mech),this.factors.wf.val=this.mech.size!="collector"?ce(this.mech):0,this.factors.ff.val=this.mech.size!="collector"?this.factors.tf.val*this.factors.wf.val:this.factors.tf.val,this.factors.rr.val=ne(this.mech,!1),this.factors.ar.val=Je(this.mech,this.factors.rr.val)}},Te=class{constructor(t=!0,s){this.deletable=t,this.removeCallback=s,this.mechItem=null,this.idx=-1;let a=document.createElement("div");a.className="mcLn line",a.dataset.idx=this.idx;let n=document.createElement("div");n.className="title";let l=document.createElement("span");l.className="mcCls";let p=document.createElement("span");n.appendChild(l),n.appendChild(p),this.factors=new se;let c=[];te.forEach(function(b,_){if(b=="rr")return;let w=document.createElement("div");w.className=`stat sco${_}`,c.push(w),this.factors[b].dom=w},this);let m=document.createElement("div");m.className="text";let f=document.createElement("span"),g=document.createElement("span");g.className="mcCls";let v;t&&(v=document.createElement("span"),v.className="delete",v.appendChild(document.createTextNode("x")),m.appendChild(v),v.addEventListener("click",s.bind(null,this))),m.appendChild(f),m.appendChild(g),a.appendChild(n);for(let b of c)a.appendChild(b);a.appendChild(m),this.line=a,this.size=l,this.type=p,this.wep=f,this.equip=g,this.delet=t?v:null}set(t,s,a){if(this.mechItem=t,this.idx=s,!this.mechItem)return;let n=[];t.mech.hardpoint.forEach(function(p,c){if(a&&c>0){n.push("..");return}n.push(u(`portal_mech_weapon_${p}`))});let l=[];t.mech.equip.forEach(function(p){l.push(u(`portal_mech_equip_${o.filterEquip(t.mech.size,p)}`))}),this.line.dataset.idx=this.idx,this.line.className=`mcLn line ${t.mech.size} ${t.mech.chassis} ${t.mech.infernal&&r.blood.prepared==3?"infernal":""}`,this.size.textContent=u(`portal_mech_size_${t.mech.size}`),this.type.textContent=u(`portal_mech_chassis_${t.mech.chassis}`),te.forEach(function(p,c){p!="rr"&&(this.factors[p].val=t.factors[p].val)},this),this.wep.textContent=n.join(" | "),this.equip.textContent=l.join(" | ")}calc(){this.mechItem!==null&&(te.forEach(function(t,s){t!="rr"&&(this.factors[t].val=this.mechItem.factors[t].val)},this),this.factors.applyValues())}},Me=class{constructor(t,s,a,n=!0,l){this.idx=s,this.mech=t,this.factors=new se;let p=[];this.mech.hardpoint.forEach(function(k,S){if(a&&S>0){p.push("..");return}p.push(u(`portal_mech_weapon_${k}`))});let c=[];this.mech.equip.forEach(function(k){c.push(u(`portal_mech_equip_${o.filterEquip(this.mech.size,k)}`))},this);let m=document.createElement("div");m.className=`mcLn line ${this.mech.size} ${this.mech.chassis} ${this.mech.infernal&&r.blood.prepared==3?"infernal":""}`;let f=document.createElement("div");f.className="title";let g=document.createElement("span");if(g.className="mcCls",g.appendChild(document.createTextNode(u(`portal_mech_size_${this.mech.size}`))),this.mech.infernal){let k=document.createElement("sup");k.appendChild(document.createTextNode("Inf")),g.appendChild(k)}let v=document.createElement("span");v.appendChild(document.createTextNode(u(`portal_mech_chassis_${this.mech.chassis}`))),f.appendChild(g),f.appendChild(v);let b=[];te.forEach(function(k,S){if(k=="rr")return;let E=document.createElement("div");E.className=`stat sco${S}`,b.push(E),this.factors[k].dom=E},this);let _=document.createElement("div");_.className="text",this.wepDom=document.createElement("span"),this.wepDom.appendChild(document.createTextNode(p.join(" | ")));let w=document.createElement("span");if(w.className="mcCls",w.appendChild(document.createTextNode(c.join(" | "))),n){let k=document.createElement("span");k.className="delete",k.appendChild(document.createTextNode("x")),_.appendChild(k),k.addEventListener("click",l.bind(null,this),{once:!0})}_.appendChild(this.wepDom),_.appendChild(w),m.appendChild(f);for(let k of b)m.appendChild(k);m.appendChild(_),this.dom=$(m)}truncate(t){let s=[];this.mech.hardpoint.forEach(function(a,n){if(t&&n>0){s.push("..");return}s.push(u(`portal_mech_weapon_${a}`))}),this.wepDom.textContent=s.join(" | ")}calc(){this.factors.tf.val=oe(this.mech),this.factors.wf.val=this.mech.size!="collector"?ce(this.mech):0,this.factors.ff.val=this.mech.size!="collector"?this.factors.tf.val*this.factors.wf.val:this.factors.tf.val,this.factors.rr.val=ne(this.mech,!1),this.factors.ar.val=Je(this.mech,this.factors.rr.val),this.factors.applyValues()}};var o={mech:{size:"small",hardpoint:["laser"],chassis:"tread",equip:[],infernal:!1},dummy:{size:"small",hardpoint:["laser"],chassis:"tread",equip:[],infernal:!1},config:{initialized:!1,warlord:!1,wrath:0,prepared:0},callbacks:{saveMech:null},statusTable:{},init(){o.config.warlord=r.race.warlord||!1,o.config.prepared=r.blood.prepared||!1,o.config.wrath=r.blood.wrath||0,o.config.initialized||($("#cMechInfernal").on("click",e=>{o.setInfernal(!o.mech.infernal)}),$("#cMechAdd").on("click",e=>{o.save()}),o.statusTable=Mt(),$("#cMechChassis").on("mouseenter",{chassis:!0},q).on("mouseleave",{not:!0},q),$($("#cMechChassis").next(".dropdownContent").get(0)).on("mouseenter",{target:"#spireTerrain"},de).on("mouseleave",{not:!0},de),$(".cMechWeapon").each((e,t)=>{$($(t).next(".dropdownContent").get(0)).on("mouseenter",{target:"#spireBoss"},de).on("mouseleave",{not:!0},de).on("click",s=>{s.target?.dataset?.val&&(o.setWeapon(s.target.dataset.val,e),o.calc())})}),$(".cMechEquip").each((e,t)=>{$($(t).next(".dropdownContent").get(0)).on("click",s=>{s.target?.dataset?.val&&(o.setEquip(s.target.dataset.val,e),s.target?.dataset?.delta?t.dataset.delta=s.target.dataset.delta:delete t.dataset.delta,o.calc())})}).on("mouseenter",{equip:!0},q).on("mouseleave",{not:!0},q)),o.config.initialized=!0,o.draw()},draw(){if(!o.config.initialized)return;$("#cMechInfernal").text(o.mech.infernal?"\u2714":"\u{1F7AD}").parent().toggleClass("faded",!o.mech.infernal);let e="",t=$("#cMechSize"),s=$(t.next(".dropdownContent").get(0)).empty(),a=o.config.warlord?x.mech.size.warlord:x.mech.size.standard;a.forEach(function(g,v){let b=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(w){o.statusTable[w].size[g]&&(b+=o.statusTable[w].size[g])});let _=b>0?`<span style="pointer-events: none;" class="${K[Math.floor((1-Math.min(b,1))*(K.length-1))]}"> -${Math.round(b*100)}%</span>`:"";e+=`<a data-val="${g}"${b>0?` data-delta="${b}"`:""}>${u(`portal_mech_size_${g}`)}${_}</a>`}),s.append($(e).on("click",g=>{o.setSize(g.currentTarget.dataset.val),o.draw(),d.config.defaultMSize=o.mech.size,T()})),s.children("a[data-delta]").on("mouseenter",{size:!0},q).on("mouseleave",{not:!0},q),a.includes(o.mech.size)||o.setSize(a[0]);let n=o.mech.size;a.includes(t.val())&&(n=t.val(),o.mech.size=n),t.val(n).text(u(`portal_mech_size_${n}`));let l=$("#cMechChassis"),p=$(l.next(".dropdownContent").get(0)).empty(),c=ft(o.mech);e="",o.dummy.size=o.mech.size,c.forEach(function(g,v){o.dummy.chassis=g;let b=r.portal?.spire?.type?Q(o.dummy):0,_=r.portal?.spire?.type?`<span class="${K[Math.floor(Math.min(b,1)*(K.length-1))]}">[${(b*100).toFixed(0)}%]</span>`:"",w=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(k){o.statusTable[k].chassis[g]&&(w+=o.statusTable[k].chassis[g])}),e+=`<a data-val="${g}" ${w!=0?`data-delta="${w}" class="${w>0?"notreally ":""}recommended strength-1"`:""}"><span>${u(`portal_mech_chassis_${g}`)}</span> ${_}</a>`}),p.append($(e).on("click",g=>{o.setType(g.currentTarget.dataset.val),o.draw(),d.config.defaultMType=o.mech.chassis,T(),q(),de()})),p.children("a[data-delta]").on("mouseenter",{chassis:!0},q).on("mouseleave",{not:!0},q),c.includes(o.mech.chassis)?o.setType(o.mech.chassis):o.setType(c[0]);let m=o.mech.chassis;c.includes(l.val())&&(m=l.val(),o.mech.chassis=m),l.val(m).text(u(`portal_mech_chassis_${m}`)),$(".cMechWeapon").each((g,v)=>{let b=$(v),_=G(o.mech.size,o.mech.chassis,g),w=b.next(".dropdownContent").get(0);if(w.replaceChildren(),_.forEach(function(k){let S=document.createElement("a");S.dataset.val=k;let E=document.createElement("span");if(E.appendChild(document.createTextNode(u(`portal_mech_weapon_${k}`))),E.style.pointerEvents="none",S.appendChild(E),r.portal?.spire?.boss){let A=ie[r.portal.spire.boss].weapon[k],y=re(r.portal.spire.boss,k),z=document.createElement("span");z.className=Ee[Math.floor(Math.min(y,1)*(Ee.length-1))],z.appendChild(document.createTextNode(` [${(y*100).toFixed(0)}%]${y<A?"\u2BC6":y>A?"\u2BC5":""}`)),z.style.pointerEvents="none",S.appendChild(z)}w.appendChild(S)}),b.parent().toggleClass("inactive",!o.vis(g)),o.vis(g)){let k=b.val();_.includes(k)?o.setWeapon(k,g):o.setWeapon(_[0],g)}});let f=o.config.prepared?5:4;$(".cMechEquip").each((g,v)=>{let b=$(v),_=V(o.mech.size,o.mech.chassis,g),w=b.next(".dropdownContent").get(0);if($(w).children("a[data-delta]").off(),w.replaceChildren(),_.forEach(function(k){let S=o.filterEquip(o.mech.size,k),E=!1,A=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(z){o.statusTable[z].equip[k]&&(A+=o.statusTable[z].equip[k],E=!0)});let y=document.createElement("a");y.dataset.val=k,y.appendChild(document.createTextNode(u(`portal_mech_equip_${S}`))),E&&A<0&&(y.dataset.delta=A,y.className=`recommended strength-${Math.min(Math.floor(Math.abs(A)*3+1),3)}`),w.appendChild(y)}),b.parent().toggleClass("inactive",!(o.eqVis(g)&&g<f)),$(w).children("a[data-delta]").on("mouseenter",{equip:!0},q).on("mouseleave",{not:!0},q),o.eqVis(g)&&g<f){let k=b.val();if(!_.includes(k))o.setEquip(_[g],g);else{let S=o.filterEquip(o.mech.size,o.mech.equip[g]);b.val(o.mech.equip[g]).text(u(`portal_mech_equip_${S}`)),v.dataset.val=o.mech.equip[g]}}}),$("#cMechInfernal").parent().toggleClass("inactive",o.config.prepared!=3),o.calc()},drawBasicTable(){if(!o.config.initialized)return;let e=$("#terrainTable"),t=$("#resistanceTable"),s=$("#equipmentTable");if(e.empty(),t.empty(),s.empty(),r.portal?.spire?.type&&e.prev().text(u(`portal_spire_type_${r.portal.spire.type}`)),e=e.get(0),(r.race.warlord?x.mech.size.warlord:[""]).forEach(function(c){o.dummy.size=c,ft(o.dummy).forEach(function(f,g){o.dummy.size=r.race.warlord?c:"small",o.dummy.chassis=f;let v=r.portal?.spire?.type?Q(o.dummy):0;o.dummy.size="large";let b=r.portal?.spire?.type?Q(o.dummy):0,_=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(S){o.statusTable[S].chassis[f]&&(_+=o.statusTable[S].chassis[f])});let w=document.createElement("a");w.dataset.val=f;let k=document.createElement("span");if(k.appendChild(document.createTextNode(u(`portal_mech_chassis_${f}`))),k.style.pointerEvents="none",r.portal?.spire?.type){let S=document.createElement("span");if(S.className=K[Math.floor(Math.min(v,1)*(K.length-1))],S.style.pointerEvents="none",S.appendChild(document.createTextNode(`[${(v*100).toFixed(0)}%] `)),r.race.warlord)w.appendChild(S);else{let E=document.createElement("span");E.className=K[Math.floor(Math.min(b,1)*(K.length-1))],E.style.pointerEvents="none",E.appendChild(document.createTextNode(`[${(b*100).toFixed(0)}%] `)),w.appendChild(document.createTextNode("S")),w.appendChild(S),w.appendChild(document.createTextNode("L")),w.appendChild(E)}}_!=0&&(w.dataset.delta=_,w.className=`${_>0?"notreally ":""}recommended strength-1`),w.appendChild(k),e.appendChild(w)})}),$(e).children("a[data-delta]").on("mouseenter",{chassis:!0},q).on("mouseleave",{not:!0},q),r.portal.spire.boss){t.prev().text(u(`portal_mech_boss_${r.portal.spire.boss}`)),t=t.get(0);let c=G("medium","tread",0);for(var[n,l]of Object.entries(ie[r.portal.spire.boss].weapon)){if(!r.race.warlord&&!c.includes(n))continue;let m=document.createElement("a");m.dataset.val=n;let f=document.createElement("span");if(f.appendChild(document.createTextNode(u(`portal_mech_weapon_${n}`))),f.style.pointerEvents="none",r.portal?.spire?.boss){let g=l,v=re(r.portal.spire.boss,n),b=document.createElement("span");b.className=Ee[Math.floor(Math.min(v,1)*(Ee.length-1))],b.appendChild(document.createTextNode(`[${(v*100).toFixed(0)}%]${v<g?"\u2BC6":v>g?"\u2BC5":""} `)),b.style.pointerEvents="none",m.appendChild(b)}m.appendChild(f),t.appendChild(m)}}s=s.get(0);let p=x.mech.equip.standard;r.race.warlord&&(p=p.concat(x.mech.equip.warlord)),p=p.filter(c=>["special","scavenger","scouter"].includes(c)==!1),p.forEach(function(c){let m=!1,f=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(v){o.statusTable[v].equip[c]&&(f+=o.statusTable[v].equip[c],m=!0)});let g=document.createElement("a");g.dataset.val=c,g.appendChild(document.createTextNode(u(`portal_mech_equip_${c}`))),m&&f<0&&(g.dataset.delta=f,g.className=`recommended strength-${Math.min(Math.floor(Math.abs(f)*3+1),3)}`),s.appendChild(g)}),$(s).children("a[data-delta]").on("mouseenter",{equip:!0},q).on("mouseleave",{not:!0},q)},calc(){o.config.initialized&&$("#mechConstructor").find(".stat").each((e,t)=>{let s=0;switch(e){case 0:s=(oe(o.mech)*100).toFixed(1)+"%";break;case 1:s=(ce(o.mech)*100).toFixed(1)+"%";break;case 2:s=(oe(o.mech)*ce(o.mech)*100).toFixed(1)+"%";break;case 3:s=ae.format((dt(o.mech,!1,!0)*1e3).toFixed(0));break}$(t).children("span").text(s)})},setSize(e){switch(o.mech.size=e,e==="collector"?o.mech.hardpoint.length=0:e==="small"||e==="medium"||e==="minion"||e==="fiend"?(o.mech.hardpoint.length===0&&o.mech.hardpoint.push("laser"),o.mech.hardpoint.length=1):(o.mech.hardpoint.length===0&&o.mech.hardpoint.push("laser"),o.mech.hardpoint.length===1&&o.mech.hardpoint.push(o.mech.hardpoint.includes("laser")?"plasma":"laser"),e==="titan"?o.mech.hardpoint.length===2&&(o.mech.hardpoint.push(o.mech.hardpoint.includes("laser")?"shotgun":"laser"),o.mech.hardpoint.push(o.mech.hardpoint.includes("laser")?"kinetic":"laser")):o.mech.hardpoint.length=2),o.config.warlord&&(o.mech.equip[0]=V(e,o.mech.chassis)[0],o.mech.equip.length=1),e){case"small":case"minion":o.config.prepared&&o.mech.equip.push(V(e,o.mech.chassis)[0]),o.mech.equip.length=o.config.prepared?1:0;break;case"medium":case"fiend":o.mech.equip.length<1&&o.mech.equip.push(V(e,o.mech.chassis)[0]),o.config.prepared&&o.mech.equip.push(V(e,o.mech.chassis)[1]),o.mech.equip.length=o.config.prepared?2:1;break;case"collector":case"large":case"cyberdemon":o.mech.equip.length<1&&o.mech.equip.push("special"),o.mech.equip.length<2&&o.mech.equip.push("shields"),o.config.prepared&&o.mech.equip.push("grapple"),o.mech.equip.length=o.config.prepared?3:2;break;case"titan":case"archfiend":o.mech.equip.length<1&&o.mech.equip.push(V(e,o.mech.chassis)[0]),o.mech.equip.length<2&&o.mech.equip.push(V(e,o.mech.chassis)[1]),o.mech.equip.length<3&&o.mech.equip.push(V(e,o.mech.chassis)[2]),o.mech.equip.length<4&&o.mech.equip.push(V(e,o.mech.chassis)[3]),o.config.prepared&&o.mech.equip.push(V(e,o.mech.chassis)[4]),o.mech.equip.length=o.config.prepared?5:4;break}if(o.config.warlord){switch(e){case"minion":o.mech.chassis="imp";break;case"fiend":o.mech.chassis="cambion";break;case"cyberdemon":o.mech.chassis="biped",o.mech.hardpoint[1]=G(e,o.mech.chassis,1)[1];break;case"archfiend":o.mech.chassis="dragon",o.mech.hardpoint[1]=G(e,o.mech.chassis,1)[0];break}o.mech.hardpoint[0]=G(e,o.mech.chassis,0)[0]}$("#cMechSize").val(e).text(u(`portal_mech_size_${e}`)),d.dispatchEvent(d.EV_CONSTRUCTOR)},setType(e){o.mech.chassis=e,o.config.warlord&&(o.mech.hardpoint[0]=G(o.mech.size,e,0)[0],e==="hydra"?(o.mech.hardpoint[1]=G(o.mech.size,e,1)[0],o.mech.hardpoint[2]=G(o.mech.size,e,2)[0],o.mech.hardpoint[3]=G(o.mech.size,e,3)[0]):e!=="hydra"&&o.mech.size.size==="archfiend"&&(o.mech.hardpoint.length=2)),$("#cMechChassis").val(e).text(u(`portal_mech_chassis_${e}`)).attr("data-val",e),d.dispatchEvent(d.EV_CONSTRUCTOR)},setWeapon(e,t){o.mech.hardpoint[t]=e,$($(".cMechWeapon").get(t)).val(e).text(u(`portal_mech_weapon_${e}`)),d.dispatchEvent(d.EV_CONSTRUCTOR)},setEquip(e,t){o.mech.equip[t]=e;let s=o.filterEquip(o.mech.size,e);$($(".cMechEquip").get(t)).val(e).text(u(`portal_mech_equip_${s}`)).attr("data-val",e),d.dispatchEvent(d.EV_CONSTRUCTOR)},vis(e){if(o.mech.size==="collector")return!1;if(e===0||["large","cyberdemon"].includes(o.mech.size)&&e<2||o.mech.size==="titan")return!0;if(o.mech.size==="archfiend")switch(o.mech.chassis){case"dragon":case"snake":case"gorgon":return e<2;case"hydra":return e<4}return!1},eqVis(e){let t=o.config.prepared?1:0;switch(o.mech.size){case"small":case"minion":return t===1&&e===0;case"medium":case"fiend":return e<=0+t;case"collector":case"large":case"cyberdemon":return e<=1+t;case"titan":case"archfiend":return!0}},filterEquip(e,t){let s=t;if(t==="special")switch(e){case"large":case"cyberdemon":s="battery";break;case"titan":s="target";break;default:s="jumpjet";break}return s},setWarlord(e){o.config.warlord=e,o.draw()},setPrepared(e){o.config.prepared=e,o.setSize(o.mech.size),o.draw()},setInfernal(e){o.mech.infernal=e===!0,$("#cMechInfernal").text(o.mech.infernal?"\u2714":"\u{1F7AD}").parent().toggleClass("faded",!o.mech.infernal),o.calc(),d.dispatchEvent(d.EV_CONSTRUCTOR)},save(){o.callbacks.saveMech&&o.callbacks.saveMech(structuredClone(o.mech))}};function ft(e){let t=x.mech.type.standard;if(o.config.warlord)switch(e.size){case"minion":t=x.mech.type.minion;break;case"fiend":t=x.mech.type.fiend;break;case"cyberdemon":t=x.mech.type.cyberdemon;break;case"archfiend":t=x.mech.type.archfiend;break}return t}function Mt(){let e={size:"",hardpoint:[],chassis:"",equip:[],infernal:!1},t={size:"",hardpoint:[],chassis:"",equip:[],infernal:!1},s={size:"",hardpoint:[],chassis:"",equip:[],infernal:!1},a={size:"",hardpoint:[],chassis:"",equip:[""],infernal:!1},n=x.mech.size.standard.concat(x.mech.size.warlord),l=[...new Set([...x.mech.type.standard,...x.mech.type.minion,...x.mech.type.fiend,...x.mech.type.cyberdemon,...x.mech.type.archfiend])],p=x.mech.equip.standard.concat(x.mech.equip.warlord),c=x.spire.hazards.slice(),m={};return c.forEach(f=>{let g={size:{},chassis:{},equip:{}};switch(f){case"gravity":n.forEach(v=>{t.size=v;let b=B(e,f)-B(t,f);b!=0&&(g.size[v]=b)});case"windy":case"hilly":case"river":case"tar":case"flooded":case"chasm":l.forEach(v=>{s.chassis=v;let b=B(e,f)-B(s,f);b!=0&&(g.chassis[v]=b)});default:p.forEach(v=>{let b=0;switch(v){case"athletic":a.equip[0]=v,a.size=e.size="medium",b=B(e,f)-B(a,f),a.size=e.size="";break;default:a.equip[0]=v,b=B(e,f)-B(a,f);break}b!=0&&(g.equip[v]=b)});break}m[f]=g}),m}var Ee=["error","error","error","error","error","warning","warning","warning","success","success"],K=["error","error","error","error","error","warning","warning","warning","warning","success"];var D=4,Ke=16,Et=["e","t"],i={initialized:!1,running:!1,avgResults:0,workers:[],workersDone:0,involvedWorkers:D,progress:0,grapher:{},medianGrapher:{},summarizer:{},pages:0,sims:[],currentSim:-1,runningSim:-1,currentInsight:-1,insightLock:!1,canvas:{e:{c:{},b:{}},t:{c:{},b:{}},emed:{c:{},b:{}},tmed:{c:{},b:{}}},bucketHighlight:{},init(){i.grapher=new Le,i.canvas.e.c=i.grapher.createCanvas(),i.canvas.t.c=i.grapher.createCanvas(),i.medianGrapher=new Le(193,24,{t:0,r:0,b:0,l:0}),i.canvas.emed.c=i.medianGrapher.createCanvas(),i.canvas.tmed.c=i.medianGrapher.createCanvas(),i.medianGrapher.baseFill="#99999940",i.canvas.e.c.setAttribute("aria-label","Efficiency graph"),i.canvas.t.c.setAttribute("aria-label","Time graph"),i.canvas.emed.c.setAttribute("title",u("mcs_calc_effi_med_graph")),i.canvas.tmed.c.setAttribute("title",u("mcs_calc_time_med_graph")),i.summarizer=new Xe([i.canvas.e.c,i.canvas.t.c],[i.canvas.emed.c,i.canvas.tmed.c]),i.bucketHighlight=$(i.summarizer.highlight),$(i.summarizer.canvasDiv).on("mousemove",function(e){if(i.insightLock)return;let t=i.canvas.e.c.offsetWidth/i.grapher.width;if(t<=0)return;let s=e.offsetX/t;if(!(!i.initialized||i.currentSim<0))if(s>i.grapher.rect.l&&s<i.grapher.rect.r){let a=s-i.grapher.rect.l,n=Math.floor(a/i.grapher.bWidth);i.bucketHighlight.show(),i.bucketHighlight.css("left",t*(n*i.grapher.bWidth+i.grapher.rect.l)),i.bucketHighlight.css("width",t*Math.max(i.grapher.bWidth-1,1)),i.insightBucket(n)}else i.bucketHighlight.hide(),i.insightBucket(-1)}),$(i.summarizer.canvasDiv).on("mouseleave",function(e){i.insightLock||(i.bucketHighlight.hide(),i.insightBucket(-1))}),$(i.summarizer.canvasDiv).on("click",function(e){let t=i.canvas.e.c.offsetWidth/i.grapher.width;if(t<=0)return;let s=e.offsetX/t;if(!(!i.initialized||i.currentSim<0)&&s>i.grapher.rect.l&&s<i.grapher.rect.r){e.stopPropagation();let a=s-i.grapher.rect.l,n=Math.floor(a/i.grapher.bWidth);n==i.currentInsight&&i.insightLock?i.unlockInsight():(i.bucketHighlight.toggleClass("locked",!0),i.bucketHighlight.show(),i.bucketHighlight.css("left",t*(n*i.grapher.bWidth+i.grapher.rect.l)),i.bucketHighlight.css("width",t*Math.max(i.grapher.bWidth-1,1)),i.insightBucket(n),i.lockInsight(n))}}),d.on(d.EV_CLOSE_DROPDOWNS,i.unlockInsight),i.initialized=!0},sim(e,t=!1){if(!i.initialized)return;if(i.running){i.running=!1;for(var s=0;s<i.workers.length;s++)i.workers[s].postMessage({a:"stop"});$("#avgDoIt").text(u("mcs_calc_btn_doit"));return}else $("#avgDoIt").text(u("mcs_calc_btn_stop")),i.running=!0;i.avgResults=0,i.workersDone=0,i.progress=0,$("#simProgress").val(0);let a=t&&r.eden?.mech_station?.mechs||0,n=parseInt($("#avgStart").val())||1,l=parseInt($("#avgLength").val())||10,p=parseInt($("#avgRepeats").val())||10,c=`${h.getCurrent().name} [${n} + ${l} --> ${n+l}] x ${p}`,m=`${e.length} mech${e.length>1&&e.length%100!=11&&e.length%10!=1?"s":""}${a>0?` (-${a} in ${u("tab_eden")})`:""}`,f=$("#avgPrecise").get(0)?.checked||d.config.preciseMedians;D=parseInt($("#avgThreads").val())||4,D=Math.max(1,Math.min(Ke,D)),i.sims.length==0||i.runningSim<0?(i.addSim(new qe(n,l,p,c,m,f)),i.runningSim=i.sims.length-1,$("#avgCalcPageContainer").append(i.summarizer.dom)):(i.runningSim=i.currentSim,i.sims[i.runningSim].init(n,l,p,c,m,f)),i.grapher.clear(i.canvas.e),i.grapher.clear(i.canvas.t),i.medianGrapher.clear(i.canvas.emed),i.medianGrapher.clear(i.canvas.tmed);for(let b in i.canvas)i.canvas[b].b=new O,i.canvas[b].b.min=0,i.canvas[b].b.max=1;i.showSim(i.runningSim),i.setupWorkers();let g=1,v=0;p>D&&(g=Math.floor(p/D),v=p%D),i.involvedWorkers=Math.min(p,D),i.sims[i.runningSim].time.gathering=performance.now();for(var s=0;s<i.involvedWorkers;s++)i.workers[s].postMessage({a:"start",wId:s,mechs:e,global:r,edenTax:a,precise:f,start:n,length:l,repeats:g+(s<v?1:0)})},setupWorkers(){if(i.workers.length<D)for(var e=i.workers.length;e<D;e++)i.workers.push(new Worker(new URL("mechaveragerun.worker.js",import.meta.url),{type:"module"})),i.workers[e].onmessage=i.handleWorkerMessage},handleWorkerMessage(e){switch(e.data.a){case"result":i.sims[i.runningSim].addData(parseInt(e.data.f),e.data.e,e.data.t,e.data.slow,e.data.raw);let s=parseInt(e.data.f)-i.sims[i.runningSim].start,a=i.sims[i.runningSim].repeats>D?i.sims[i.runningSim].repeats%D:0,n=i.sims[i.runningSim].buckets.n[s]%i.involvedWorkers==0;a>0&&(n=n||i.sims[i.runningSim].buckets.n[s]%i.involvedWorkers==a),n=n&&i.currentSim===i.runningSim,n&&(i.grapher.drawBucket(i.canvas.e,i.canvas.e.b,i.sims[i.runningSim],"e",s),i.grapher.drawBucket(i.canvas.t,i.canvas.t.b,i.sims[i.runningSim],"t",s)),i.avgResults++;break;case"progress":i.workers[e.data.w].progress=e.data.progress;let l=e.data.progress;for(var t=0;t<D&&t<i.workers.length;t++){let c=i.workers[t];c.progress&&c.progress<l&&(l=c.progress)}l>i.progress&&(i.progress=l),$("#simProgress").val(i.progress*100);break;case"done":i.workersDone++,i.workersDone==i.involvedWorkers&&(i.sims[i.runningSim].finalizeResults(),i.showSim(i.runningSim),i.running=!1,$("#avgDoIt").text(u("mcs_calc_btn_doit")));break;case"error":let p;switch(e.data.error){case"no_mechs":p=u("mcs_info_no_mechs"),i.sims[i.runningSim].descriptor=p,M("info",p,"sim_no_mechs");break;case"mechs_busy":p=u("mcs_stuck_in_eden",[u("tab_eden")]),i.sims[i.runningSim].descriptor=p,M("info",p,"sim_eden");break}i.running=!1,$("#avgDoIt").text(u("mcs_calc_btn_doit")),i.summarizer.summarize(i.sims[i.runningSim]),i.summarizer.clear();break;default:break}},showSim(e){if(i.unlockInsight(),e=="i"){$("#avgCalcInfo").show();let t=$("#avgCalcPager");t.find(".current").removeClass("current"),t.find(`[data-val="${e}"]`).addClass("current"),$(i.summarizer.dom).hide()}else if(Number.isInteger(e)){let t=$("#avgCalcPager");t.show(),$("#avgCalcInfo").hide(),$(i.summarizer.dom).show(),i.currentSim=e%i.sims.length,t.find(".current").removeClass("current"),t.find(`[data-val="${e}"]`).addClass("current"),i.summarizer.summarize(i.sims[i.currentSim]),i.grapher.draw(i.canvas.e,i.sims[i.currentSim],"e"),i.grapher.draw(i.canvas.t,i.sims[i.currentSim],"t"),i.sims[i.currentSim].done?(i.medianGrapher.drawMedians(i.canvas.emed.c,i.sims[i.currentSim].bounds.emed,"e",i.sims[i.currentSim].medians.e),i.medianGrapher.drawMedians(i.canvas.tmed.c,i.sims[i.currentSim].bounds.tmed,"t",i.sims[i.currentSim].medians.t)):(i.medianGrapher.clear(i.canvas.emed),i.medianGrapher.clear(i.canvas.tmed))}},addSim(e){let t=$($("#avgCalcPager").children("div").get(0)),s=4;if(i.pages==0&&(t.append($('<a data-val="i" class="clickable"><svg class="bi" width="1.1em" height="1.1em" fill="currentColor"><use xlink:href="./icons/icons.svg#info-square-fill"/></svg></a>').on("click",a=>{i.showSim("i")})),t.append($('<a id="addSimTab" class="clickable">&nbsp;+&nbsp;</a>').on("click",a=>{i.addSim()&&i.showSim(i.pages-1)}))),i.pages<s){let a=t.children("#addSimTab");i.pages==s-1&&a.hide(),a.before($(`<a data-val="${i.pages}" class="clickable"><svg class="bi" width="1.1em" height="1.1em" fill="currentColor"><use xlink:href="./icons/icons.svg#bar-chart-fill"/></svg></a>`).on("click",n=>{n.target?.dataset?.val>=0&&i.showSim(parseInt(n.target.dataset.val))})),i.sims.push(e===void 0?new qe(1,0,0,"",u("mcs_calc_sim_suggest_start"),!1):e),i.currentSim=i.sims.length-1,i.pages++}else return!1;return!0},insightBucket(e){e!=i.currentInsight&&(i.currentInsight=e,!(i.sims.length==0||i.currentSim<0)&&(e<0||e>=i.sims[i.currentSim].nBuckets?(i.sims[i.currentSim].done&&(i.sims[i.currentSim].bounds.tmed.min=i.sims[i.currentSim].medians.t[0],i.sims[i.currentSim].bounds.tmed.max=i.sims[i.currentSim].medians.t[i.sims[i.currentSim].medians.t.length-1],i.medianGrapher.drawMedians(i.canvas.emed.c,i.sims[i.currentSim].bounds.emed,"e",i.sims[i.currentSim].medians.e),i.medianGrapher.drawMedians(i.canvas.tmed.c,i.sims[i.currentSim].bounds.tmed,"t",i.sims[i.currentSim].medians.t)),i.summarizer.summarize(i.sims[i.currentSim])):(i.sims[i.currentSim].done&&i.sims[i.currentSim].precise&&i.sims[i.currentSim].buckets.t[e].med.length>0&&(i.sims[i.currentSim].bounds.tmed.min=i.sims[i.currentSim].buckets.t[e].med[0],i.sims[i.currentSim].bounds.tmed.max=i.sims[i.currentSim].buckets.t[e].med[i.sims[i.currentSim].buckets.t[e].med.length-1],i.medianGrapher.drawMedians(i.canvas.emed.c,i.sims[i.currentSim].bounds.emed,"e",i.sims[i.currentSim].buckets.e[e].med),i.medianGrapher.drawMedians(i.canvas.tmed.c,i.sims[i.currentSim].bounds.tmed,"t",i.sims[i.currentSim].buckets.t[e].med)),i.summarizer.summarize(i.sims[i.currentSim],e))))},lockInsight(e){i.insightLock=!0},unlockInsight(){i.insightLock=!1,i.bucketHighlight.hide(),i.bucketHighlight.removeClass("locked"),i.insightBucket(-1)},loadUpFloorum(e){if(!(i.sims.length==0||i.currentSim<0)&&e.currentTarget?.dataset?.bucket&&i.currentSim>=0&&e.currentTarget?.dataset?.key){let t=e.currentTarget.dataset.bucket;if(t>=i.sims[i.currentSim].nBuckets||i.sims[i.currentSim].totals.n==0)return;let s=e.currentTarget.dataset.key;gt(t<0?i.sims[i.currentSim].totals.slowest[s]:i.sims[i.currentSim].slowest[s][t])}}},Z={graphBase:"#555",graphBlue:"#0095DD",graphError:"#DD000090"},Le=class{constructor(t=560,s=140,a={t:10,r:10,b:10,l:10}){U(this,"bWidth",3);this.width=t,this.height=s,this.padding=a,this.rect={t:this.padding.t,r:this.width-this.padding.r,b:this.height-this.padding.b,l:this.padding.l};let n=document.createElement("canvas").getContext("2d");this.baseFill=Z.graphBase,this.errorFill=Z.graphError,this.warningGradient=n.createLinearGradient(0,0,0,this.height),this.warningGradient.addColorStop(0,Z.graphBase),this.warningGradient.addColorStop(.8,Z.graphBase),this.warningGradient.addColorStop(1,"#ED6500"),this.errorGradient=n.createLinearGradient(0,0,0,this.height),this.errorGradient.addColorStop(0,Z.graphBase),this.errorGradient.addColorStop(.8,Z.graphBase),this.errorGradient.addColorStop(1,"#ED0000"),this.longGradient=n.createLinearGradient(0,0,0,this.height),this.longGradient.addColorStop(0,"#ED000040"),this.longGradient.addColorStop(.1,Z.graphBase),this.highGradient=n.createLinearGradient(0,0,0,this.height),this.highGradient.addColorStop(0,"#95DD0080"),this.highGradient.addColorStop(.1,Z.graphBase)}createCanvas(){let t=document.createElement("canvas");return t.height=this.height,t.width=this.width,t}draw(t,s,a){let n=t.c.getContext("2d");this.clear(n);let l=1;s.nBuckets>this.width-this.padding.l-this.padding.r&&(l=Math.floor(s.nBuckets/(this.width-this.padding.l-this.padding.r)));for(var p=0;p<s.nBuckets;p=p+l)s.buckets.n[p]>0&&this.drawBucket(n,t.b,s,a,p)}drawBucket(t,s,a,n,l){let p=t instanceof CanvasRenderingContext2D?t:t.c.getContext("2d"),c=!1;switch(this.bWidth=(this.width-this.padding.l-this.padding.r)/a.nBuckets,this.width-this.padding.l-this.padding.r>=a.nBuckets&&(this.bWidth=Math.floor(this.bWidth)),n){case"t":s.min!=a.bounds[n].min&&(c=!0),s.max!=a.bounds[n].max&&(c=!0);break}if(s.min=a.bounds[n].min,s.max=a.bounds[n].max,this.rect.l=this.padding.l+Math.floor((this.width-this.padding.l-this.padding.r-this.bWidth*a.nBuckets)/2),this.rect.r=this.width-this.rect.l,c)for(var m=0;m<l;m++)this.strokeBucket(p,a.bounds[n],n,m,a.buckets[n][m]);this.strokeBucket(p,a.bounds[n],n,l,a.buckets[n][l])}clear(t){(t instanceof CanvasRenderingContext2D?t:t.c.getContext("2d")).clearRect(0,0,this.width,this.height)}strokeBucket(t,s,a,n,l){t.clearRect(this.bWidth*n+this.rect.l,0,this.bWidth,this.height);let p=l.max;a=="t"&&l.max==-1&&(p=s.max*1.2);let c=Math.max(this.bWidth-1,1);t.fillStyle=this.baseFill;let m=Math.round(R(this.rect.t,this.rect.b,1-J(s.min,s.max,p))),f=Math.round(R(this.rect.t,this.rect.b,1-J(s.min,s.max,l.min)));l.min==0?t.fillStyle=this.errorFill:l.min<.009?t.fillStyle=this.errorGradient:l.min<.05?t.fillStyle=this.warningGradient:p>s.max&&(t.fillStyle=a=="t"?this.longGradient:this.highGradient),t.fillRect(this.bWidth*n+this.rect.l,m,c,f-m),p>s.max&&t.clearRect(this.bWidth*n+this.rect.l,this.rect.t+4,c,2);let g=Array.isArray(l.med)?X(l.med):l.med,v=Math.round(R(this.rect.t,this.rect.b,1-J(s.min,s.max,l.avg))),b=Math.round(R(this.rect.t,this.rect.b,1-J(s.min,s.max,g))),_=v,w=Math.max(Math.abs(v-b),2);v>=b?_=b:w=Math.max(Math.abs(b-v),2),(a=="t"?-1:1)*(v-b)<0?t.fillStyle="#DD9500":t.fillStyle="#95DD00",t.fillRect(this.bWidth*n+this.rect.l,_-1,c,w)}drawMedians(t,s,a,n){let l=t.getContext("2d");if(this.clear(l),l.beginPath(),l.moveTo(this.rect.l,this.rect.b),n.length<this.rect.r-this.rect.l)for(var p=0;p<n.length;p++){let m=R(this.rect.l,this.rect.r,J(0,n.length-1,p)),f=Math.round(R(this.rect.t,this.rect.b,1-J(s.min,s.max,n[p])));l.lineTo(m,f)}else for(var p=0;p<=this.rect.r-this.rect.l;p++){let f=p+this.rect.l,g=Math.floor(R(0,n.length-1,J(this.rect.l,this.rect.r,f))),v=Math.round(R(this.rect.t,this.rect.b,1-J(s.min,s.max,n[g])));l.lineTo(f,v)}l.lineTo(this.rect.r,Math.round(R(this.rect.t,this.rect.b,1-J(s.min,s.max,n[n.length-1])))),l.lineTo(this.rect.r,this.rect.b),l.closePath(),l.fillStyle=this.baseFill,l.fill();let c=Math.floor(this.rect.l+(this.rect.r-this.rect.l)/2);l.beginPath(),l.moveTo(c,this.rect.b-5),l.lineTo(c-5,this.rect.b),l.lineTo(c+5,this.rect.b),l.lineTo(c,this.rect.b-5),l.closePath(),l.fillStyle=Z.graphBlue,l.fill()}},qe=class{constructor(t,s,a,n,l,p){this.start=t||1,this.length=s||1,this.repeats=a||1,this.label=n||"",this.descriptor=l||"",this.precise=p||!1,this.done=!1,this.buckets={n:[],e:[],t:[]},this.medians={e:[],t:[]},this.slowest={e:[],t:[]},this.bounds={e:{},t:{},emed:{},tmed:{}},this.nBuckets=s,Object.keys(this.buckets).forEach(function(m){this.buckets[m].length=this.nBuckets},this),Object.keys(this.slowest).forEach(function(m){this.slowest[m].length=this.nBuckets},this),Object.keys(this.bounds).forEach(function(m){this.bounds[m]=new O,this.bounds[m].min=0,this.bounds[m].max=1},this),this.buckets.n.fill(0);for(var c=0;c<this.nBuckets;c++)this.buckets.e[c]=new O,this.buckets.t[c]=new O,this.buckets.e[c].med=[],this.buckets.t[c].med=[],this.slowest.e[c]=new I(0,0,0,null),this.slowest.t[c]=new I(0,0,0,null);this.totals={n:0,e:new O,t:new O,slowest:{e:new I,t:new I}},this.time={gathering:0,finalizing:0}}init(t,s,a,n,l,p){this.start=t,this.length=s,this.repeats=a,this.label=n,this.descriptor=l,this.precise=p,this.done=!1,this.nBuckets=s,Object.keys(this.buckets).forEach(function(m){this.buckets[m].length=this.nBuckets},this),Object.keys(this.slowest).forEach(function(m){this.slowest[m].length=this.nBuckets},this),Object.keys(this.bounds).forEach(function(m){this.bounds[m].min=0,this.bounds[m].max=1},this),this.buckets.n.fill(0),this.medians.e=[],this.medians.t=[],this.slowest.e=[],this.slowest.t=[];for(var c=0;c<this.nBuckets;c++)this.buckets.e[c]=new O,this.buckets.t[c]=new O,this.buckets.e[c].med=[],this.buckets.t[c].med=[],this.slowest.e[c]=new I(0,0,0,null),this.slowest.t[c]=new I(0,0,0,null);this.totals.n=0,this.totals.e=new O,this.totals.t=new O,this.totals.slowest.e=new I,this.totals.slowest.t=new I,this.time.gathering=0,this.time.finalizing=0}addData(t,s,a,n,l=null){t-=this.start,!(t<0||t>=this.nBuckets)&&(this.buckets.e[t].min>s.min&&(this.slowest.e[t]=n.e),this.buckets.e[t].min=this.buckets.e[t].min>s.min?s.min:this.buckets.e[t].min,this.buckets.e[t].max=this.buckets.e[t].max<s.max?s.max:this.buckets.e[t].max,this.buckets.e[t].avg=(s.avg+this.buckets.n[t]*this.buckets.e[t].avg)/(this.buckets.n[t]+1),a.max==-1&&(this.buckets.t[t].max=-1,this.slowest.t[t]=n.t),this.buckets.t[t].max!==-1&&this.buckets.t[t].max<a.max&&(this.slowest.t[t]=n.t),this.buckets.t[t].min=this.buckets.t[t].min>a.min?a.min:this.buckets.t[t].min,this.buckets.t[t].max=this.buckets.t[t].max!==-1&&this.buckets.t[t].max<a.max?a.max:this.buckets.t[t].max,this.buckets.t[t].avg=(a.avg+this.buckets.n[t]*this.buckets.t[t].avg)/(this.buckets.n[t]+1),this.precise&&l?(this.buckets.e[t].med.push(...l.e),this.buckets.t[t].med.push(...l.t),this.medians.e.push(...l.e),this.medians.t.push(...l.t)):(this.buckets.e[t].med.push(...Array.isArray(s.med)?s.med:[s.med]),this.buckets.t[t].med.push(...Array.isArray(a.med)?a.med:[a.med]),this.medians.e.push(...Array.isArray(s.med)?s.med:[s.med]),this.medians.t.push(...Array.isArray(a.med)?a.med:[a.med])),this.buckets.e[t].med.sort(le),this.buckets.t[t].med.sort(le),this.buckets.n[t]++,this.bounds.t.min>this.buckets.t[t].min&&(this.bounds.t.min=this.buckets.t[t].min),this.bounds.t.max<this.buckets.t[t].max&&this.buckets.t[t].max/this.buckets.t[t].avg<5?this.bounds.t.max=this.buckets.t[t].max:this.bounds.t.max<this.buckets.t[t].avg?this.bounds.t.max=this.buckets.t[t].avg:this.bounds.t.max<X(this.buckets.t[t].med)&&(this.bounds.t.max=X(this.buckets.t[t].med)))}finalizeResults(){let t=performance.now();this.time.gathering=t-this.time.gathering;let s=!1,a=ke.bind(50);for(var n=0;n<this.nBuckets;n++)this.buckets.n[n]!=0&&(this.totals.slowest.e=this.totals.e.min>this.buckets.e[n].min?this.slowest.e[n]:this.totals.slowest.e,this.totals.e.min=this.totals.e.min>this.buckets.e[n].min?this.buckets.e[n].min:this.totals.e.min,this.totals.e.max=this.totals.e.max<this.buckets.e[n].max?this.buckets.e[n].max:this.totals.e.max,this.totals.slowest.t=this.totals.t.max<this.buckets.t[n].max?this.slowest.t[n]:this.totals.slowest.t,this.totals.t.min=this.totals.t.min>this.buckets.t[n].min&&this.buckets.t[n].min>0?this.buckets.t[n].min:this.totals.t.min,this.totals.t.max=this.totals.t.max<this.buckets.t[n].max?this.buckets.t[n].max:this.totals.t.max,this.buckets.t[n].min!==0&&(s=!0),Et.forEach(function(l){this.totals[l].avg=(this.buckets[l][n].avg+n*this.totals[l].avg)/(n+1),this.buckets[l][n].med.sort(le),this.buckets[l][n].med.length>50&&(this.buckets[l][n].med=this.buckets[l][n].med.filter(a))},this),this.totals.n+=this.buckets.n[n]);this.medians.e.sort(le),this.medians.t.sort(le),this.totals.e.med=X(this.medians.e),this.totals.t.med=X(this.medians.t),this.medians.e.length>200&&(this.medians.e=this.medians.e.filter(ke),this.medians.t=this.medians.t.filter(ke)),this.bounds.emed.min=0,this.bounds.emed.max=Math.max(1,this.medians.e[this.medians.e.length-1]),this.bounds.tmed.min=this.medians.t[0],this.bounds.tmed.max=this.medians.t[this.medians.t.length-1],this.normals={e:i.canvas.e.b,t:i.canvas.t.b,emed:i.canvas.emed.b,tmed:i.canvas.tmed.b},this.time.finalizing=performance.now()-t,this.done=!0}},Xe=class{constructor(t,s){this.noDataBucket=new O,Object.keys(this.noDataBucket).forEach(function(p){this.noDataBucket[p]=0},this),this.noDataBucket.med=[],this.dom=document.createElement("div"),this.dom.id="avgSummary-",this.dom.className="avgSummary",this.dom.style="display: none",this.labelDiv=document.createElement("div"),this.labelDiv.className="co0 title",this.label=document.createElement("h3"),this.descriptor=document.createElement("p"),this.labelDiv.appendChild(this.label),this.labelDiv.appendChild(this.descriptor),this.dom.appendChild(this.labelDiv),this.statDiv=document.createElement("div"),this.statDiv.className="co0 breakdown",this.dom.appendChild(this.statDiv),this.canvasDiv=document.createElement("div"),this.canvasDiv.className="co1 canvas",this.dom.appendChild(this.canvasDiv),this.highlight=document.createElement("div"),this.highlight.id="bucketHighlight",this.highlight.style="pointer-events: none; display: none",this.canvasDiv.appendChild(this.highlight);for(let p of t)this.canvasDiv.appendChild(p);this.grid={e:{},t:{}};let a=document.createElement("div");a.className="co0 header",a.appendChild(s[0]),a.appendChild(document.createTextNode(u("mcs_calc_summary_lbl_effi"))),this.statDiv.appendChild(a),Object.keys(new O).forEach(function(p,c){let m=document.createElement("div");m.className="co0",m.appendChild(document.createTextNode(`${u(`mcs_calc_key_${p}`)}:`));let f=document.createElement("div");f.className="co1",this.grid.e[p]=f,this.statDiv.appendChild(m),this.statDiv.appendChild(f)},this),this.bHeader=document.createElement("div"),this.bHeader.className="co0 bucket",this.bHeader.appendChild(document.createTextNode(u("mcs_calc_summary_lbl_total")));let n=document.createElement("div");n.className="co0 header",n.appendChild(s[1]),n.appendChild(document.createTextNode(u("mcs_calc_summary_lbl_time"))),this.statDiv.appendChild(this.bHeader),this.statDiv.appendChild(n),Object.keys(new O).forEach(function(p,c){let m=document.createElement("div");m.className="co0",m.appendChild(document.createTextNode(`${u(`mcs_calc_key_${p}`)}:`));let f=document.createElement("div");f.className="co1",this.grid.t[p]=f,this.statDiv.appendChild(m),this.statDiv.appendChild(f)},this),this.slowest=[],this.slowestDiv=document.createElement("div"),this.slowestDiv.className="co0 footer slowest",this.dom.appendChild(this.slowestDiv);let l=document.createElement("span");l.className="label",l.appendChild(document.createTextNode(u("mcs_calc_summary_lbl_slowest_floor"))),this.slowestDiv.appendChild(l);for(let p=0;p<2;p++){this.slowest.push(document.createElement("div")),this.slowest[p].className="blockContainer",this.slowestDiv.appendChild(this.slowest[p]),this.slowest[p].col=[];for(let c=0;c<5+d.maxStatus;c++){let m=document.createElement(c==2?"button":"span");if(m.className=`floor co${c}`,this.slowest[p].col.push(m),c==3){let f=document.createElement("div");f.className="emannuelWrap",this.slowest[p].appendChild(f)}this.slowest[p].appendChild(m)}this.slowest[p].col[2].textContent="\u{1F845}",this.slowest[p].col[2].classList.add("spanImpostor"),this.slowest[p].col[2].setAttribute("title",u("mcs_calc_load_up")),this.slowest[p].col[2].dataset.key=p==0?"e":"t",this.slowest[p].col[2].addEventListener("click",i.loadUpFloorum)}this.summary=document.createElement("div"),this.summary.className="co0 footer",this.dom.appendChild(this.summary),this.footers=[];for(let p=0;p<2;p++)this.footers.push(document.createElement("span")),this.summary.appendChild(this.footers[p]);this.footers[1].className="notImportant"}clear(){Object.keys(this.grid.e).forEach(function(t,s){this.grid.e[t].textContent="-",this.grid.t[t].textContent="-",t=="min"&&(this.grid.e[t].classList.remove("error"),this.grid.e[t].classList.remove("warning")),t=="max"&&this.grid.t[t].classList.remove("error")},this)}summarize(t,s=-1){if(this.label.textContent=t.label,this.descriptor.textContent=t.done?t.descriptor+` | ${u("mcs_calc_sim_done")} \u2714`:t.descriptor,this.footers[0].textContent="\xA0",this.footers[1].textContent="\xA0",this.slowestDiv.style="display: none",t.done){let a,n;s>=0&&s<t.nBuckets?(this.bHeader.textContent=`${u("mcs_calc_summary_lbl_floor")} [${t.start+s}]`,t.buckets.n[s]>0?(a=t.buckets.e[s],n=t.buckets.t[s]):(a=this.noDataBucket,n=this.noDataBucket)):(this.bHeader.textContent=u("mcs_calc_summary_lbl_total"),a=t.totals.e,n=t.totals.t),Object.keys(t.totals.e).forEach(function(l,p){l=="med"?(this.grid.e[l].textContent=((Array.isArray(a[l])?X(a[l]):a[l])*100).toFixed(2)+"%",this.grid.t[l].textContent=L(Array.isArray(n[l])?X(n[l]):n[l])):(this.grid.e[l].textContent=(a[l]*100).toFixed(2)+"%",this.grid.t[l].textContent=L(n[l])),l=="min"&&(a[l]==0?(this.grid.e[l].classList.remove("warning"),this.grid.e[l].classList.add("error")):a[l]<.009?(a[l]<1e-4&&(this.grid.e[l].textContent=(a[l]*100).toFixed(5)+"%"),this.grid.e[l].classList.remove("error"),this.grid.e[l].classList.add("warning")):(this.grid.e[l].classList.remove("error"),this.grid.e[l].classList.remove("warning"))),l=="max"&&(n[l]==-1?this.grid.t[l].classList.add("error"):this.grid.t[l].classList.remove("error"))},this)}else s==-1&&Object.keys(t.totals.e).forEach(function(a,n){this.grid.e[a].textContent="-",this.grid.t[a].textContent="-"},this);if(t.done){let a=t.time.gathering>1e3?L(t.time.gathering/1e3):`${Math.round(t.time.gathering)}ms`;this.footers[0].textContent=u("mcs_calc_summary_done_time_a",[L(t.totals.t.avg)]),this.footers[1].textContent=u("mcs_calc_summary_done_time_b",[a,(Math.floor(t.time.finalizing*100)/100).toFixed(2)]),this.slowestDiv.style=null,s>=0&&s<t.nBuckets&&t.buckets.n[s]>0?(this.slowest[0].style=null,I.areEqual(t.slowest.e[s],t.slowest.t[s])?(this.summarizeSlowestFloor(this.slowest[0],t,s,t.slowest.e[s]),this.slowest[1].style="visibility: hidden"):(this.slowest[1].style=null,this.summarizeSlowestFloor(this.slowest[0],t,s,t.slowest.e[s],"e"),this.summarizeSlowestFloor(this.slowest[1],t,s,t.slowest.t[s],"t"))):t.totals.n>0?(this.slowest[0].style=null,I.areEqual(t.totals.slowest.e,t.totals.slowest.t)?(this.summarizeSlowestFloor(this.slowest[0],t,s,t.totals.slowest.e),this.slowest[1].style="visibility: hidden"):(this.slowest[1].style=null,this.summarizeSlowestFloor(this.slowest[0],t,s,t.totals.slowest.e,"e"),this.summarizeSlowestFloor(this.slowest[1],t,s,t.totals.slowest.t,"t"))):(this.slowest[0].style="visibility: hidden",this.slowest[1].style="visibility: hidden")}}summarizeSlowestFloor(t,s,a,n,l=null){switch(t.col[0].textContent=`${n.count}`,l){case"e":t.col[1].textContent=`${(s.buckets.e[n.count-s.start].min*100).toFixed(2)}%`;break;case"t":t.col[1].textContent=`${L(s.buckets.t[n.count-s.start].max)}`;break;default:t.col[1].textContent=`${(s.buckets.e[n.count-s.start].min*100).toFixed(2)}% / ${L(s.buckets.t[n.count-s.start].max)}`}t.col[3].textContent=u(`portal_mech_boss_${n.boss}`),t.col[4].textContent=u(`portal_spire_type_${n.type}`),t.col[0].dataset.bucket=n.count-s.start,t.col[2].dataset.bucket=a,t.col[2].style=null;let p=Object.keys(n.status);for(var c=0;c<d.maxStatus;c++)c<p.length?(t.col[c+5].textContent=u(`portal_spire_status_${p[c]}`),t.col[c+5].style=null):(t.col[c+5].textContent="\xA0",t.col[c+5].style="visibility: hidden")}};var N;function Lt(e){e.preventDefault(),setTimeout(()=>{i.sim(h.getCurrentList(),d.config.avgEdenTax&&h.getCurrent().key=="mechbay")},0)}function bt(){if($("#saveString").val().length>0){let e=$("#saveString").val();try{N=JSON.parse(LZString.decompressFromBase64(e))}catch{N=""}if(N){d.localStorage&&localStorage.setItem(d.LS_SString,e),it(structuredClone(N)),console.log(r);let t=$("#spireTerrain").val(),s=$("#spireBoss").val(),a=0;r.portal?.mechbay||(M("error",u("mcs_error_nomechbay")),a++),r.portal?.spire?($("#spireTerrain").val(r.portal.spire.type).text(u(`portal_spire_type_${r.portal.spire.type}`)),$("#spireBoss").val(r.portal.spire.boss).text(u(`portal_mech_boss_${r.portal.spire.boss}`)),De(r.portal.spire.type),Ne(r.portal.spire.boss),C.update.terrain(),C.update.boss()):(M("error",u("mcs_error_nospire")),a++,je(),r.blood.prepared=N.blood.prepared?N.blood.prepared:0,r.blood.wrath=N.blood.wrath?N.blood.wrath:0,r.stats.achieve.gladiator.l=N.stats.achieve.gladiator?.l?N.stats.achieve.gladiator.l:0,r.stats.reset=N.stats.reset?N.stats.reset:0,$("#spireTerrain").val(t).text(t?u(`portal_spire_type_${t}`):"\u{1F7AD}"),$("#spireBoss").val(s).text(s?u(`portal_mech_boss_${s}`):"\u{1F7AD}"),De(t),Ne(s)),Qe(-1,-1),C.update.spireCount(),$("#scouts").val(r.portal.mechbay.scouts?r.portal.mechbay.scouts:0),$("#prepared").val(r.blood.prepared?r.blood.prepared:0),$("#wrathlvl").val(r.blood.wrath?r.blood.wrath:0),$("#gladiatorlvl").val(r.stats.achieve.gladiator?.l?r.stats.achieve.gladiator.l:0),$("#resets").val(r.stats.reset?r.stats.reset:0),C.update.warlord(),C.update.prepared(),C.update.hazards(),T(),o.init(),o.drawBasicTable(),setTimeout(()=>{h.showPage(h.currentPage),F()&&(h.update(!0),$("#mechbaySpaceDenominator").text(he()),o.calc())},0),a==0&&M("success",u("mcs_success_import"))}else M("error",u("mcs_error_invalid_str"));N=null}else M("error",u("mcs_error_empty_str"));C.update.calcEdenTax()}function gt(e){r.portal.spire.count=parseInt(e.count),De(e.type),Ne(e.boss),r.portal.spire.status=structuredClone(e.status),Qe(-1,-1),C.update.spireCount(),C.update.terrain(),C.update.boss(),C.update.hazards(),T(),o.draw(),o.drawBasicTable(),W()}function F(){return r&&r.portal?.spire&&r.portal.spire.type&&r.portal.spire.boss}function qt(e){setTimeout(()=>{h.addMech(e),F()&&h.update(!0)},0)}function Oe(e){setTimeout(t=>{h.update(e)},0)}function W(){if(!F()){Oe(!1);return}$("#mechbaySpaceDenominator").text(he()),o.calc(),Oe(!0)}function Pt(){Oe(!1)}function Pe(){setTimeout(e=>{h.update(d.config.sortingType!=0),C.update.sorting()},0)}function Ft(){Oe(d.config.sortingType!=0)}function kt(){$("#isVisible").parent().toggleClass("faded",d.config.pagerVisibility!=0);let e=h.isVisible;h.isVisible=d.config.pagerVisibility==0,h.isVisible?e||($("#mechLists").show(),setTimeout(()=>{h.showPage(h.currentPage),F()&&(h.update(!0),o.calc())},0)):($("#mechLists").hide(),setTimeout(h.hide,0))}function Ot(){let e=$("#spireTerrain"),t=x.spire.terrain.slice(),s=$(e.next(".dropdownContent").get(0)),a="";t.sort(Vt).forEach(function(y){a+=`<a data-val="${y}">${u(`portal_spire_type_${y}`)}</a>`}),s.append($(a).on("click",Dt));let n=x.spire.hazards.slice();n.sort(Wt),$(".statusButton").next(".dropdownContent").each((y,z)=>{let tt='<a data-val="" class="negative">\u{1F7AD}</a>';n.forEach(st=>{tt+=`<a data-val="${st}">${u(`portal_spire_status_${st}`)}</a>`}),$(z).append($(tt).on("click",{index:y},Bt))});let l=$("#bossList"),p="";Object.keys(ie).sort(jt).forEach(function(y){p+=`<a data-val="${y}">${u(`portal_mech_boss_${y}`)}</a>`}),l.append($(p).on("click",Nt));let c="",m=$("#truncateSelector"),f=$(m.next(".dropdownContent").get(0));Be.forEach(function(y,z){c+=`<a data-val="${z}">${u(y.full)}</a>`,d.config.truncateWeapons==y.val&&m.text(u(y.short))}),f.append($(c).on("click",{optionList:Be,optionSelector:"#truncateSelector",optionConfig:"truncateWeapons",action:Pt},pe)),c="";let g=$("#sortingSelector"),v=$(g.next(".dropdownContent").get(0));Y.forEach(function(y,z){c+=`<a data-val="${z}">${u(y.full)}</a>`,d.config.sortingType==y.val&&g.text(u(y.short))}),v.append($(c).on("click",{optionList:Y,optionSelector:"#sortingSelector",optionConfig:"sortingType",action:Pe},pe)),$("#sortingDirection").on("click",y=>{let z=d.config.sortingDirection>0?0:1;y.currentTarget.dataset.val=z,y.data={optionList:me,optionSelector:"#sortingDirection",optionConfig:"sortingDirection",action:Ft},pe(y)}).text(me[d.config.sortingDirection>0?1:0].short),c="";let _=$("#groupingSelector"),w=$(_.next(".dropdownContent").get(0));Ie.forEach(function(y,z){c+=`<a data-val="${z}">${u(y.full)}</a>`,d.config.groupingType==y.val&&_.text(u(y.short))}),w.append($(c).on("click",{optionList:Ie,optionSelector:"#groupingSelector",optionConfig:"groupingType",action:Pe},pe)),$("#visStyleSwitch").on("click",{optionList:ge,optionSelector:"#visStyleSwitch",optionConfig:"mathVisStyle",action:C.update.mathStyle},vt).html(ge[d.config.mathVisStyle].short),$("#isVisible").on("click",{optionList:Re,optionSelector:"#isVisible",optionConfig:"pagerVisibility",action:kt},vt).html(Re[d.config.pagerVisibility].short),$("#totalEffectHeader").attr("data-val",1).on("click",{optionList:Y,optionSelector:"#sortingSelector",optionConfig:"sortingType",action:Pe},pe),$("#finalRatingHeader").attr("data-val",2).on("click",{optionList:Y,optionSelector:"#sortingSelector",optionConfig:"sortingType",action:Pe},pe);let E=$($("#localeButton").next(".dropdownContent").get(0)),A="";Object.keys(we).forEach(function(y){A+=`<a data-val="${y}"${y==d.config.locale?' class="current"':""}>${we[y]}</a>`}),E.append($(A).on("click",It)),$("#mechbaySpaceDenominator").text(he()),$("#avgStart, #avgLength, #avgRepeats, #avgThreads").each((y,z)=>{$(z).val(d.config[z.dataset.field])}),$("#avgPrecise, #avgEdenTax, #virtualList").each((y,z)=>{$(z).prop("checked",d.config[z.dataset.field])}),C.update.sorting(),C.update.prepared(),C.update.calcVisibility(),C.update.infoTableVisibility()}function q(e){if(!e||e.data?.not){$(".statusButton").each((t,s)=>{$(s).parent().toggleClass("highlight",!1).toggleClass("dangerlight",!1)});return}$(".statusButton").each((t,s)=>{let a=$(s).val();e.data.equip&&o.statusTable[a]?.equip[e.currentTarget.dataset.val]?$(s).parent().toggleClass("highlight",!0):e.data.chassis&&o.statusTable[a]?.chassis[e.currentTarget.dataset.val]?o.statusTable[a].chassis[e.currentTarget.dataset.val]<0?$(s).parent().toggleClass("highlight",!0):$(s).parent().toggleClass("dangerlight",!0):e.data.size&&o.statusTable[a]?.size[e.currentTarget.dataset.val]?o.statusTable[a].size[e.currentTarget.dataset.val]>0&&$(s).parent().toggleClass("dangerlight",!0):$(s).parent().toggleClass("highlight",!1).toggleClass("dangerlight",!1)})}function de(e){if(!e||e.data?.not||!e.data.target){$(".hightarget").toggleClass("hightarget",!1);return}$(e.data.target).parent().toggleClass("hightarget",!0)}function De(e){r.portal.spire.type=e;let t=$($("#spireTerrain").next(".dropdownContent").get(0));t.children(".current").removeClass("current"),t.find(`[data-val="${e}"]`).addClass("current")}function Ne(e){r.portal.spire.boss=e;let t=$("#bossList");t.children(".current").removeClass("current"),t.find(`[data-val="${e}"]`).addClass("current")}function Qe(e,t){let s=[];r.portal.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(a){s.push(`[data-val="${a}"]`)}),$(".statusButton").each((a,n)=>{let l=$($(n).next(".dropdownContent").get(0));l.children(".current").removeClass("current"),s.length>0&&l.find(s.join(",")).addClass("current")})}function Dt(e){De(e.currentTarget.dataset.val),C.update.terrain(),o.draw(),o.drawBasicTable(),W()}function Nt(e){Ne(e.currentTarget.dataset.val),C.update.boss(),o.draw(),o.drawBasicTable(),W()}function Bt(e){let t=e.currentTarget.dataset.val;if(t&&r.portal.spire?.status&&r.portal.spire.status[t]==!0){M("info",u("mcs_info_hazard_present"));return}let s=$($(".statusButton").get(e.data.index));t?(s.parent().toggleClass("inactive",!1),s.text(u(`portal_spire_status_${t}`))):(s.parent().toggleClass("inactive",!0),s.text("\u{1F7AD}")),r.portal.spire?.status&&(delete r.portal.spire.status[s.val()],t&&(r.portal.spire.status[t]=!0)),Qe(-1,t),s.val(t),o.draw(),o.drawBasicTable(),W()}function It(e){!e.currentTarget.dataset.val||!we[e.currentTarget.dataset.val]||(d.config.locale=e.currentTarget.dataset.val,r.settings.locale=e.currentTarget.dataset.val,T(),window.location.reload())}function Rt(e){e.currentTarget.dataset.field&&(Ye(e),window.location.reload())}function pe(e){let t=e.data.optionList[e.currentTarget.dataset.val].val;t!=d.config[e.data.optionConfig]&&($(e.data.optionSelector).text(u(e.data.optionList[e.currentTarget.dataset.val].short)).val(t),d.config[e.data.optionConfig]=t,T(),e.data.action&&e.data.action())}function vt(e){let t=(d.config[e.data.optionConfig]+1)%e.data.optionList.length;$(e.data.optionSelector).html(e.data.optionList[t].short).val(t),d.config[e.data.optionConfig]=t,T(),e.data.action&&e.data.action()}function et(e,t){let s=u(`${this}${e}`),a=u(`${this}${t}`);return s>a?1:s<a?-1:0}var Vt=et.bind("portal_spire_type_"),jt=et.bind("portal_mech_boss_"),Wt=et.bind("portal_spire_status_");function M(e,t,s,a=[]){let n=1e3;switch(e){case"success":case"info":n=1500,n*=R(1,2,(t.length-15)/25);break;case"error":n=2e3;break;default:return}if(s&&$(`#${s}`).length>0)return;let l=$(`<div class="${e}"${s?`id="${s}"`:""}></div>`).text(t);$("#messageBox").append(l),setTimeout(()=>{l.fadeOut(500,()=>{l.remove()})},n)}function Ye(e){if(e.currentTarget?.dataset){let t=$(e.currentTarget).val();switch(e.currentTarget.dataset.field){case"avgStart":case"avgLength":case"avgRepeats":let s=parseInt(t);if(isNaN(s))return;d.config[e.currentTarget.dataset.field]=s,T();break;case"avgThreads":let a=parseInt(t);if(isNaN(a))return;d.config[e.currentTarget.dataset.field]=Math.max(1,Math.min(Ke,a)),T();break;case"avgEdenTax":case"preciseMedians":case"virtualList":d.config[e.currentTarget.dataset.field]=!!e.currentTarget.checked,T();break}}}function At(){$("[data-locale-string]").each((e,t)=>{t.dataset.localeString&&$(t).text(wt(t.dataset.localeString))}),$("[data-locale-title]").each((e,t)=>{t.dataset.localeTitle&&$(t).attr("title",wt(t.dataset.localeTitle))})}function wt(e){if(e.indexOf(",")!==-1){let t=e.split(",");switch(t[0]){case"i":return u(t[1]).toLowerCase();default:return u(t[0],t.slice(1).map(s=>u(s)))}}else switch(e){case"portal_spire_type":case"portal_spire_hazard":let t=u(e);return t=t.split(/[:]+/)[0],t=t.split("\uFF1A")[0],t;break;case"portal_mech_size_small":return d.config.locale!="en-US"?u(e)+" #":u(e)+"s";default:return u(e)}}function Ht(){$(".dropdownButton").on("click",e=>{let t=$(e.currentTarget).next(".dropdownContent").get(0);$(".dropdownContent").each((n,l)=>{l!=t&&$(l).toggleClass("show",!1)}),$(t).toggleClass("right",!1).toggleClass("show");let s=t.getBoundingClientRect(),a=s.x+s.width-document.body.getBoundingClientRect().width;$(t).toggleClass("right",a>0),d.dispatchEvent(d.EV_OPEN_DROPDOWN)}),$(".dropdownContent.popbox").on("click",e=>{e.stopPropagation()}),$(window).on("click",e=>{e.target.matches(".dropdownButton")||($(".dropdownContent").toggleClass("show",!1),d.dispatchEvent(d.EV_CLOSE_DROPDOWNS))})}function Gt(){$("#parseSaveString").on("click",e=>{bt()}),$("#saveString").on("keyup",e=>{e.which==13&&bt()}),$("#spireCount").on("input",e=>{!r||!r.portal?.spire||(r.portal.spire.count=parseInt($("#spireCount").val()),T(),o.draw(),o.drawBasicTable(),W())}),$("#scouts").on("input",e=>{!r||!r.portal?.mechbay||(r.portal.mechbay.scouts=parseInt($("#scouts").val()),T(),W())}),$("#resets").on("input",e=>{!r||!r.portal?.mechbay||(r.stats.reset=parseInt($("#resets").val()),T(),o.draw(),o.drawBasicTable(),W())}),$("#wrathlvl").on("input",e=>{!r||!r.blood||(r.blood.wrath=parseInt($("#wrathlvl").val()),T(),W())}),$("#gladiatorlvl").on("input",e=>{!r||!r.stats.achieve.gladiator||(r.stats.achieve.gladiator.l=parseInt($("#gladiatorlvl").val()),T(),W())}),$("#prepared").on("input",e=>{!r||!r.blood||(r.blood.prepared=parseInt($("#prepared").val()),C.update.prepared(),o.setPrepared(r.blood.prepared),T(),W())}),$("#warlord").on("click",e=>{!r||!r.race||(r.race.warlord=!r.race.warlord,o.setWarlord(r.race.warlord),C.update.warlord(),T(),o.drawBasicTable(),W())}),$("#openCalculator").on("click",e=>{let t=$("#openCalculator").hasClass("action");d.config.calculatorVisibility=!t,C.update.calcVisibility(),T()}),$("#showInfoTable").on("click",e=>{d.config.showInfoTable=!d.config.showInfoTable,C.update.infoTableVisibility(),T()}),$("#avgStart, #avgLength, #avgRepeats, #avgThreads").on("input",Ye),$("#avgPrecise, #avgEdenTax").on("change",Ye),$("#virtualList").on("change",Rt),$("#avgSimForm").on("submit",Lt),o.callbacks.saveMech=qt,Fe=$("#goToTop").on("click",e=>{window.scroll({top:0,behavior:"instant"})}).get(0),$(window).on("scroll",be(e=>{window.scrollY<Jt?Fe.style=null:Fe.style.length==0&&(Fe.style="display: block")},100))}var C={update:{spireCount(){$("#spireCount").val(r.portal.spire.count)},terrain(){$("#spireTerrain").val(r.portal.spire.type).text(u(`portal_spire_type_${r.portal.spire.type}`))},boss(){$("#spireBoss").val(r.portal.spire.boss).text(u(`portal_mech_boss_${r.portal.spire.boss}`))},hazards(){let e=[];Object.keys(r.portal.spire.status).forEach(function(t){e.push(t)}),$(".statusButton").text(t=>t<e.length?u(`portal_spire_status_${e[t]}`):"\u{1F7AD}"),$(".statusButton").each((t,s)=>{t<e.length?($(s).val(e[t]),$(s).parent().toggleClass("inactive",!1)):($(s).val(0),$(s).parent().toggleClass("inactive",!0))})},warlord(){$("#warlord").text(r.race.warlord?"\u2714":"\u{1F7AD}").parent().toggleClass("faded",!r.race.warlord),$("#terrainTable").toggleClass("warlord",r.race.warlord==!0)},prepared(){$("#mechLists").toggleClass("prepared-3",r.blood.prepared==3)},sorting(){$("#sortingDirection").parent().toggleClass("faded",d.config.sortingType==0||d.config.sortingType==4),$("#groupingSelector").parent().toggleClass("faded",d.config.sortingType==0||d.config.sortingType==4||d.config.groupingType==0),$("#mechLists, #mechListHeader, #mechConstructor").toggleClass("sortedByFactor",d.config.sortingType==1).toggleClass("sortedByRating",d.config.sortingType==2).toggleClass("isSorted",d.config.sortingType!=0&&d.config.sortingType!=4)},mathStyle(){$("body").children("section").attr("class",ge[d.config.mathVisStyle].val)},calcVisibility(){$("#avgCalculator").toggleClass("show",d.config.calculatorVisibility),$("#openCalculator").toggleClass("action",d.config.calculatorVisibility),$("#mechListHeader").toggleClass("shadowed",d.config.calculatorVisibility)},infoTableVisibility(){$("#showInfoTable").html(rt[d.config.showInfoTable?0:1].short).parent().toggleClass("faded",!d.config.showInfoTable),$("#infoTable").toggleClass("show",d.config.showInfoTable)},calcEdenTax(){$("#avgEdenTaxLabel").toggle(r.eden?.mech_station?.mechs>0)}}},Fe,Jt=160;(()=>{let e;d.localStorage&&(e=localStorage.getItem(d.LS_SString)),e&&e.length>0&&$("#saveString").val(e),$("#saveString").on("focus",t=>{t.target.select()}),console.log(r),$("html").attr("lang",d.config.locale),$("#prepared").val(r.blood.prepared),$("#wrathlvl").val(r.blood.wrath),$("#gladiatorlvl").val(r.stats.achieve.gladiator.l),$("#scouts").val(r.portal.mechbay.scouts),$("#resets").val(r.stats.reset),C.update.spireCount(),C.update.warlord(),C.update.mathStyle(),o.setSize(d.config.defaultMSize),o.setType(d.config.defaultMType),o.setWarlord(r.race.warlord),kt(),setTimeout(Ot,0),setTimeout(o.init,0),setTimeout(()=>{h.init(),C.update.calcEdenTax()},0),setTimeout(i.init,0),Ht(),At(),Gt(),d.localStorage||M("error",u("mcs_error_lstorage"))})();export{q as highlightHazards,de as highlightTarget,gt as importFloorum,bt as importSaveString,M as inform,F as isSpireSetup};
