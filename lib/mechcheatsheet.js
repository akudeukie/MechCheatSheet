var ft=Object.defineProperty;var gt=(e,t,s)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var K=(e,t,s)=>gt(e,typeof t!="symbol"?t+"":t,s);var Ze=(()=>{try{return typeof window<"u"?window.localStorage:{getItem(){return""},setItem(){}}}catch{return{getItem(){return""},setItem(){}}}})(),r={seed:1,warseed:1,resource:{},evolution:{},tech:{},city:{},space:{},interstellar:{},portal:{},eden:{},tauceti:{},civic:{},race:{},genes:{},blood:{},stats:{start:Date.now(),days:0,tdays:0},event:{t:200,l:!1},m_event:{t:499,l:!1}};Math.rand=function(e,t){return Math.floor(Math.random()*(t-e))+e};r.seed=2;r.warseed=2;function V(e,t,s,a){t=t||1,e=e||0;let o=((a||r[s?"warseed":"seed"])*9301+49297)%233280,p=o/233280;return a||(r[s?"warseed":"seed"]=o),e+p*(t-e)}function Xe(e){r=e}r.version||(r.version="0.2.0");r.version="1.4.8";delete r.revision;delete r.beta;r.settings||(r.settings={showEvolve:!0,showAchieve:!1,animated:!0,disableReset:!1,font:"standard",q_merge:"merge_nearby",cLabels:!0,theme:"gruvboxDark",locale:"en-US",icon:"star"});r.eden||(r.eden={});r.settings.locale||(r.settings.locale="en-US");function bt(){["reset","plasmid","antiplasmid","universes","phage","starved","tstarved","died","tdied","sac","tsac","know","tknow","portals","dkills","attacks","cfood","tfood","cstone","tstone","clumber","tlumber","mad","bioseed","cataclysm","blackhole","ascend","descend","apotheosis","terraform","aiappoc","matrix","retire","eden","geck","dark","harmony","blood","cores","artifact","supercoiled","cattle","tcattle","murders","tmurders","psykill","tpsykill","pdebt","uDead"].forEach(function(e){r.stats.hasOwnProperty(e)||(r.stats[e]=0)}),r.stats.achieve||(r.stats.achieve={}),r.stats.feat||(r.stats.feat={}),r.stats.hasOwnProperty("womling")||(r.stats.womling={god:{l:0},lord:{l:0},friend:{l:0}}),r.stats.spire||(r.stats.spire={}),r.stats.synth||(r.stats.synth={}),r.stats.hasOwnProperty("banana")||(r.stats.banana={b1:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b2:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b3:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b4:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b5:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1}}),r.stats.hasOwnProperty("endless_hunger")||(r.stats.endless_hunger={b1:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b2:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b3:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b4:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b5:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1}}),r.stats.hasOwnProperty("death_tour")||(r.stats.death_tour={ct:{l:0,h:0,a:0,e:0,m:0,mg:0},bh:{l:0,h:0,a:0,e:0,m:0,mg:0},di:{l:0,h:0,a:0,e:0,m:0,mg:0},ai:{l:0,h:0,a:0,e:0,m:0,mg:0},vc:{l:0,h:0,a:0,e:0,m:0,mg:0},md:{l:0,h:0,a:0,e:0,m:0,mg:0}}),r.stats.death_tour&&!r.stats.death_tour.hasOwnProperty("md")&&(r.stats.death_tour.md={l:0,h:0,a:0,e:0,m:0,mg:0}),r.stats.warlord||(r.stats.warlord={k:!1,p:!1,a:!1,r:!1,g:!1})}bt();r.race.universe||(r.race.universe="standard");r.settings.affix||(r.settings.affix="si");var Me=[{short:"Short",full:"Truncate weapon descriptions",val:!0},{short:"Full",full:"Show full descriptions",val:!1}],Q=[{short:"Disabled",full:"Disabled",val:0},{short:"Factor \u03A3",full:"Auto sort by factor",val:1},{short:"Rating #",full:"Auto sort by rating",val:2},{short:"Size",full:"Auto sort by size",val:3},{short:"Original",full:"Original order",val:4}],ne=[{short:"\u2191",full:"Descending",val:-1},{short:"\u2193",full:"Ascending",val:1}],Ee=[{short:"Disabled",full:"Disabled",val:0},{short:"Size",full:"Group by size",val:1},{short:"Chassis",full:"Group by chassis",val:2}],ue=[{short:"A",full:"Style A",val:"visStyleA"},{short:"B",full:"Style B",val:"visStyleB"},{short:"C",full:"Style C",val:"visStyleC"}],Ke=[{short:'<svg class="bi" width="1em" height="1em" fill="currentColor"><use xlink:href="/icons/icons.svg#info-square-fill"/></svg>',full:"Display effectiveness summary table",val:!0},{short:'<svg class="bi" width="1em" height="1em" fill="currentColor"><use xlink:href="/icons/icons.svg#info-square-fill"/></svg>',full:"Hide effectiveness summary table",val:!1}],Le=[{short:'<svg class="bi" width="1.1em" height="1.1em" fill="currentColor"><use xlink:href="/icons/icons.svg#eye"/></svg>',full:"Display mech lists",val:!0},{short:'<svg class="bi" width="1.1em" height="1.1em" fill="currentColor"><use xlink:href="/icons/icons.svg#eye-slash"/></svg>',full:"Hide mech lists",val:!1}];var Qe=[{size:"small",hardpoint:["flame"],chassis:"wheel",equip:["special"],infernal:!0},{size:"small",hardpoint:["kinetic"],chassis:"spider",equip:["stabilizer"],infernal:!1},{size:"medium",hardpoint:[],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"medium",hardpoint:["flame"],chassis:"tread",equip:["stabilizer","shields"],infernal:!1},{size:"medium",hardpoint:["missile"],chassis:"tread",equip:["stabilizer","shields"],infernal:!1},{size:"titan",hardpoint:["tesla","tesla","tesla","tesla"],chassis:"spider",equip:["special","radiator","shields","sonar","stabilizer"],infernal:!0},{size:"large",hardpoint:["laser","laser"],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"hover",equip:["special","coolant","shields"],infernal:!0},{size:"titan",hardpoint:["tesla","tesla","tesla","tesla"],chassis:"hover",equip:["special","coolant","shields","sonar","stabilizer"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"medium",hardpoint:["sonic"],chassis:"quad",equip:["shields","flare"],infernal:!1},{size:"titan",hardpoint:["laser","kinetic","sonic","shotgun"],chassis:"quad",equip:["shields","sonar","flare","grapple","stabilizer"],infernal:!1},{size:"large",hardpoint:["laser","kinetic"],chassis:"wheel",equip:["shields","flare","grapple"],infernal:!1},{size:"titan",hardpoint:["flame","flame","flame","flame"],chassis:"hover",equip:["ablative","radiator","grapple","sonar","stabilizer"],infernal:!1}],Ye=[{size:"small",hardpoint:["flame"],chassis:"wheel",equip:["special"],infernal:!0},{size:"minion",hardpoint:["shock"],chassis:"hound",equip:["scouter"],infernal:!1},{size:"collector",hardpoint:[],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"medium",hardpoint:["flame"],chassis:"tread",equip:["stabilizer","shields"],infernal:!1},{size:"medium",hardpoint:["missile"],chassis:"tread",equip:["stabilizer","shields"],infernal:!1},{size:"archfiend",hardpoint:["venom","shock"],chassis:"snake",equip:["darkvision","echo","thermal","manashield","cold"],infernal:!0},{size:"large",hardpoint:["laser","laser"],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"hover",equip:["special","coolant","shields"],infernal:!0},{size:"titan",hardpoint:["tesla","tesla","tesla","tesla"],chassis:"hover",equip:["special","coolant","shields","sonar","stabilizer"],infernal:!1},{size:"large",hardpoint:["tesla","tesla"],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"fiend",hardpoint:["cold"],chassis:"nightmare",equip:["darkvision","echo"],infernal:!1},{size:"titan",hardpoint:["laser","kinetic","sonic","shotgun"],chassis:"quad",equip:["shields","sonar","flare","grapple","stabilizer"],infernal:!1},{size:"cyberdemon",hardpoint:["laser","kinetic"],chassis:"wheel",equip:["shields","flare","grapple"],infernal:!1},{size:"titan",hardpoint:["flame","flame","flame","flame"],chassis:"hover",equip:["ablative","radiator","grapple","sonar","stabilizer"],infernal:!1}],et=[{size:"collector",hardpoint:[],chassis:"wheel",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"tread",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"biped",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"quad",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"spider",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"hover",equip:["special","coolant","shields"],infernal:!1},{size:"collector",hardpoint:[],chassis:"wheel",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"tread",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"biped",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"quad",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"spider",equip:["stabilizer","radiator","grapple"],infernal:!1},{size:"collector",hardpoint:[],chassis:"hover",equip:["stabilizer","radiator","grapple"],infernal:!1}];var le=new Intl.NumberFormat(void 0),h={version:"1.0.0",LS_SString:"storedSaveString",LS_Config:"storedConfig",LS_MechList:"favMechs",LS_MechBucket:"mechBucket_",LS_PageLabels:"storedLabels",LS_Heap:"storedRandomStuff",info:["Mech Cheat Sheet","by Akudeu Kie","https://github.com/akudeukie/MechCheatSheet/","for %0 v%1 %2","https://pmotschmann.github.io/Evolve/","Evolve Incremental","1.4.8","by Demagorddon"],maxMechBuckets:4,maxStatus:4,maxMechPages:15,localStorage:!1,config:{warlord:!1,prepared:0,wrath:0,gladiator:0,scouts:0,resets:0,showInfoTable:!0,defaultMSize:"medium",defaultMType:"tread",truncateWeapons:!0,sortingType:Q[0].val,sortingDirection:ne[0].val,groupingType:0,mathVisStyle:0,calculatorVisibility:!1,avgStart:1,avgLength:20,avgRepeats:10,avgThreads:4,preciseMedians:!1,avgEdenTax:!0,pagerVisibility:0,defaultPage:0,locale:"en-US"},labels:{},heap:{},events:{},EV_CONSTRUCTOR:"eon_constructor",EV_CLOSE_DROPDOWNS:"eon_closedropdowns",on:function(e,t){let s=h.events[e]||[];s.push(t),h.events[e]=s},off:function(e,t){let s=h.events[e]||[];if(t){let a=s.indexOf(t);a!=-1&&s.splice(a,1),h.events[e]=s}else h.events[e]=[]},dispatchEvent:function(e,t){let s=h.events[e];!s||s.length<1||s.forEach(function(a){a(t)})}};function Pe(){r.portal.mechbay={count:0,on:0,bay:0,max:0,active:0,scouts:0,mechs:[]},r.portal.spire={count:1,progress:0,boss:"",type:"",status:{}},r.stats.achieve.gladiator={l:0},r.blood.prepared=0,r.blood.wrath=0,r.stats.reset=0}function vt(){if(!h.localStorage)return;let e=localStorage.getItem(h.LS_Config);e=e?JSON.parse(LZString.decompressFromBase64(e)):null,e&&(Object.keys(h.config).forEach(function(a){e[a]??(e[a]=h.config[a])}),h.config=e,r.stats.achieve.gladiator.l=h.config.gladiator||0,r.race.warlord=h.config.warlord||!1,r.blood.wrath=h.config.wrath||0,r.blood.prepared=h.config.prepared||0,r.portal.mechbay.scouts=h.config.scouts||0,r.stats.reset=h.config.resets||0);let t=localStorage.getItem(h.LS_PageLabels);t=t?JSON.parse(LZString.decompressFromBase64(t)):null,t&&(h.labels=t);let s=localStorage.getItem(h.LS_Heap);s=s?JSON.parse(LZString.decompressFromBase64(s)):null,s&&(h.heap=s),r.settings.locale=h.config.locale}function _(){h.config.warlord=r.race.warlord,h.config.prepared=r.blood.prepared,h.config.wrath=r.blood.wrath,h.config.gladiator=r.stats.achieve.gladiator.l,h.config.scouts=r.portal.mechbay.scouts,h.config.resets=r.stats.reset,h.localStorage&&localStorage.setItem(h.LS_Config,LZString.compressToBase64(JSON.stringify(h.config)))}function tt(){h.localStorage&&localStorage.setItem(h.LS_PageLabels,LZString.compressToBase64(JSON.stringify(h.labels)))}function st(){h.localStorage&&localStorage.setItem(h.LS_Heap,LZString.compressToBase64(JSON.stringify(h.heap)))}var q={};function wt(){for(var e=0;e<h.maxMechBuckets;e++){let t;h.localStorage&&(t=localStorage.getItem(`${h.LS_MechBucket}${e}`),t=t?JSON.parse(LZString.decompressFromBase64(t)):null),t&&Array.isArray(t)?q[e]=t:q[e]=[]}}function Fe(e){if(e>=h.maxMechPages||e<0)return[];let t=at(e);if(q.hasOwnProperty(t.b)){for(;t.i>=q[t.b].length;)q[t.b].push([]);return q[t.b][t.i].length==0&&(e==5&&(q[t.b][t.i]=et),e==6&&(q[t.b][t.i]=Qe),e==7&&(q[t.b][t.i]=Ye)),q[t.b][t.i]}else return[]}function De(e,t){let s=at(e);if(!q.hasOwnProperty(s.b)||e>=h.maxMechPages||e<0||s.b>h.maxMechBuckets)return[!1,"Could not save list - invalid page number"];for(;s.i>=q[s.b].length;)q[s.b].push([]);return q[s.b][s.i]=t,h.localStorage?(localStorage.setItem(`${h.LS_MechBucket}${s.b}`,LZString.compressToBase64(JSON.stringify(q[s.b]))),[!0,`Saved page ${e+1} successfully`]):[!1,"Failed to access local storage"]}function at(e){let t=e%h.maxMechBuckets,s=Math.floor(e/h.maxMechBuckets);return{b:t,i:s}}var qe;try{qe=window.localStorage;let e="_test_";qe.setItem(e,e),qe.removeItem(e),h.localStorage=!0}catch{h.localStorage=!1}Pe();vt();wt();var ee={fire_elm:{weapon:{laser:1.05,flame:0,plasma:.25,kinetic:.5,missile:.5,sonic:1,shotgun:.75,tesla:.65,claws:.5,venom:.62,cold:1.25,shock:.68,fire:0,acid:.25,stone:.5,iron:.5,flesh:.3,ice:1.12,magma:0,axe:.5,hammer:.5},nozone:{freeze:!0,flooded:!0},amp:{hot:1.75,humid:.8,steam:.9}},water_elm:{weapon:{laser:.65,flame:.5,plasma:1,kinetic:.2,missile:.5,sonic:.5,shotgun:.25,tesla:.75,claws:.4,venom:.8,cold:1.1,shock:.68,fire:.8,acid:.25,stone:.4,iron:.3,flesh:.5,ice:1.1,magma:.75,axe:.45,hammer:.45},nozone:{hot:!0,freeze:!0},amp:{steam:1.5,river:1.1,flooded:2,rain:1.75,humid:1.25}},rock_golem:{weapon:{laser:1,flame:.5,plasma:1,kinetic:.65,missile:.95,sonic:.75,shotgun:.35,tesla:0,claws:.7,venom:.25,cold:.35,shock:0,fire:.9,acid:1,stone:.5,iron:.65,flesh:.3,ice:.3,magma:.9,axe:.2,hammer:1},nozone:{},amp:{}},bone_golem:{weapon:{laser:.45,flame:.35,plasma:.55,kinetic:1,missile:1,sonic:.75,shotgun:.75,tesla:.15,claws:.75,venom:0,cold:.2,shock:.15,fire:.4,acid:.85,stone:.9,iron:1,flesh:.15,ice:.3,magma:.9,axe:.65,hammer:1.2},nozone:{},amp:{}},mech_dino:{weapon:{laser:.85,flame:.05,plasma:.55,kinetic:.45,missile:.5,sonic:.35,shotgun:.5,tesla:1,claws:.38,venom:.1,cold:.5,shock:1.1,fire:.5,acid:.75,stone:.5,iron:.5,flesh:.15,ice:.3,magma:.9,axe:.6,hammer:.4},nozone:{},amp:{}},plant:{weapon:{laser:.42,flame:1,plasma:.65,kinetic:.2,missile:.25,sonic:.75,shotgun:.35,tesla:.38,claws:.25,venom:.25,cold:.65,shock:.28,fire:1,acid:.45,stone:.6,iron:.5,flesh:.5,ice:.55,magma:1,axe:.25,hammer:.15},nozone:{},amp:{}},crazed:{weapon:{laser:.5,flame:.85,plasma:.65,kinetic:1,missile:.35,sonic:.15,shotgun:.95,tesla:.6,claws:1,venom:.5,cold:.5,shock:.75,fire:.5,acid:.5,stone:.7,iron:.8,flesh:.9,ice:.4,magma:.5,axe:1,hammer:.75},nozone:{},amp:{}},minotaur:{weapon:{laser:.32,flame:.5,plasma:.82,kinetic:.44,missile:1,sonic:.15,shotgun:.2,tesla:.35,claws:.6,venom:1.1,cold:.5,shock:.3,fire:.5,acid:1,stone:.6,iron:.9,flesh:.3,ice:.4,magma:.55,axe:.75,hammer:.6},nozone:{},amp:{}},ooze:{weapon:{laser:.2,flame:.65,plasma:1,kinetic:0,missile:0,sonic:.85,shotgun:0,tesla:.15,claws:0,venom:.15,cold:1.5,shock:.2,fire:.6,acid:.5,stone:0,iron:0,flesh:0,ice:1.25,magma:.7,axe:0,hammer:0},nozone:{},amp:{}},zombie:{weapon:{laser:.35,flame:1,plasma:.45,kinetic:.08,missile:.8,sonic:.18,shotgun:.95,tesla:.05,claws:.85,venom:0,cold:.2,shock:.35,fire:.95,acid:.5,stone:.5,iron:.5,flesh:.35,ice:.25,magma:.9,axe:1,hammer:.5},nozone:{},amp:{}},raptor:{weapon:{laser:.68,flame:.55,plasma:.85,kinetic:1,missile:.44,sonic:.22,shotgun:.33,tesla:.66,claws:.85,venom:.5,cold:.5,shock:.88,fire:.6,acid:.6,stone:1,iron:.85,flesh:.45,ice:.5,magma:.65,axe:.9,hammer:.6},nozone:{},amp:{}},frost_giant:{weapon:{laser:.9,flame:.82,plasma:1,kinetic:.25,missile:.08,sonic:.45,shotgun:.28,tesla:.5,claws:.35,venom:.15,cold:0,shock:.6,fire:1.2,acid:.5,stone:.35,iron:1,flesh:.3,ice:0,magma:1.1,axe:.5,hammer:1},nozone:{hot:!0},amp:{freeze:2.5,hail:1.65}},swarm:{weapon:{laser:.02,flame:1,plasma:.04,kinetic:.01,missile:.08,sonic:.66,shotgun:.38,tesla:.45,claws:.05,venom:.01,cold:.8,shock:.75,fire:.8,acid:.75,stone:.03,iron:.03,flesh:.03,ice:.3,magma:.5,axe:.01,hammer:.05},nozone:{},amp:{}},dragon:{weapon:{laser:.18,flame:0,plasma:.12,kinetic:.35,missile:1,sonic:.22,shotgun:.65,tesla:.15,claws:.38,venom:.88,cold:.8,shock:.35,fire:0,acid:.85,stone:.03,iron:.03,flesh:.03,ice:.3,magma:0,axe:.4,hammer:.55},nozone:{},amp:{}},mech_dragon:{weapon:{laser:.84,flame:.1,plasma:.68,kinetic:.18,missile:.75,sonic:.22,shotgun:.28,tesla:1,claws:.28,venom:0,cold:.35,shock:1,fire:.15,acid:.72,stone:.5,iron:.5,flesh:.5,ice:.2,magma:.15,axe:.25,hammer:.8},nozone:{},amp:{}},construct:{weapon:{laser:.5,flame:.2,plasma:.6,kinetic:.34,missile:.9,sonic:.08,shotgun:.28,tesla:1,claws:.28,venom:0,cold:.45,shock:1.1,fire:.22,acid:.68,stone:.55,iron:.55,flesh:.4,ice:.4,magma:.18,axe:.42,hammer:.95},nozone:{},amp:{}},beholder:{weapon:{laser:.75,flame:.15,plasma:1,kinetic:.45,missile:.05,sonic:.01,shotgun:.12,tesla:.3,claws:.48,venom:.9,cold:.88,shock:.24,fire:.18,acid:.9,stone:.72,iron:.45,flesh:.85,ice:.92,magma:.16,axe:.44,hammer:.08},nozone:{},amp:{}},worm:{weapon:{laser:.55,flame:.38,plasma:.45,kinetic:.2,missile:.05,sonic:1,shotgun:.02,tesla:.01,claws:.18,venom:.65,cold:1,shock:.02,fire:.38,acid:.48,stone:.22,iron:.24,flesh:.35,ice:1,magma:.4,axe:.15,hammer:.05},nozone:{},amp:{}},hydra:{weapon:{laser:.85,flame:.75,plasma:.85,kinetic:.25,missile:.45,sonic:.5,shotgun:.6,tesla:.65,claws:.3,venom:.65,cold:.55,shock:.65,fire:.75,acid:.85,stone:.25,iron:.15,flesh:.2,ice:.55,magma:.75,axe:.45,hammer:.65},nozone:{},amp:{}},colossus:{weapon:{laser:1,flame:.05,plasma:.75,kinetic:.45,missile:1,sonic:.35,shotgun:.35,tesla:.5,claws:.48,venom:.22,cold:.25,shock:.65,fire:.15,acid:.95,stone:.55,iron:.95,flesh:.25,ice:.35,magma:.2,axe:.55,hammer:.35},nozone:{},amp:{}},lich:{weapon:{laser:.1,flame:.1,plasma:.1,kinetic:.45,missile:.75,sonic:.35,shotgun:.75,tesla:.5,claws:.4,venom:.01,cold:.1,shock:.5,fire:.1,acid:.1,stone:.35,iron:.25,flesh:.95,ice:.1,magma:.1,axe:.4,hammer:1},nozone:{},amp:{}},ape:{weapon:{laser:1,flame:.95,plasma:.85,kinetic:.5,missile:.5,sonic:.05,shotgun:.35,tesla:.68,claws:.65,venom:.95,cold:.5,shock:.5,fire:.75,acid:.65,stone:.5,iron:.5,flesh:.5,ice:.5,magma:.75,axe:.65,hammer:.5},nozone:{},amp:{}},bandit:{weapon:{laser:.65,flame:.5,plasma:.85,kinetic:1,missile:.5,sonic:.25,shotgun:.75,tesla:.25,claws:1,venom:.15,cold:.5,shock:.25,fire:.5,acid:.5,stone:.5,iron:.8,flesh:.5,ice:.5,magma:.5,axe:1,hammer:.5},nozone:{},amp:{}},croc:{weapon:{laser:.65,flame:.05,plasma:.6,kinetic:.5,missile:.5,sonic:1,shotgun:.2,tesla:.75,claws:1,venom:.5,cold:1,shock:.75,fire:.05,acid:.08,stone:.6,iron:.5,flesh:.25,ice:.95,magma:.05,axe:.75,hammer:.5},nozone:{},amp:{}},djinni:{weapon:{laser:0,flame:.35,plasma:1,kinetic:.15,missile:0,sonic:.65,shotgun:.22,tesla:.4,claws:.18,venom:.12,cold:.9,shock:.45,fire:.3,acid:.1,stone:.2,iron:.95,flesh:.2,ice:.9,magma:.3,axe:.12,hammer:0},nozone:{},amp:{}},snake:{weapon:{laser:.5,flame:.5,plasma:.5,kinetic:.5,missile:.5,sonic:.5,shotgun:.5,tesla:.5,claws:.5,venom:.02,cold:.75,shock:.5,fire:.5,acid:.5,stone:.5,iron:.5,flesh:.5,ice:.75,magma:.5,axe:.5,hammer:.5},nozone:{},amp:{}},centipede:{weapon:{laser:.5,flame:.85,plasma:.95,kinetic:.65,missile:.6,sonic:0,shotgun:.5,tesla:.01,claws:.65,venom:.01,cold:0,shock:.01,fire:.88,acid:.95,stone:.6,iron:.45,flesh:.55,ice:0,magma:.88,axe:.7,hammer:.4},nozone:{},amp:{}},spider:{weapon:{laser:.65,flame:1,plasma:.22,kinetic:.75,missile:.15,sonic:.38,shotgun:.9,tesla:.18,claws:.12,venom:.05,cold:.5,shock:.32,fire:1,acid:.65,stone:.8,iron:.5,flesh:.5,ice:.5,magma:1,axe:.18,hammer:.75},nozone:{},amp:{}},manticore:{weapon:{laser:.05,flame:.25,plasma:.95,kinetic:.5,missile:.15,sonic:.48,shotgun:.4,tesla:.6,claws:.5,venom:.5,cold:.8,shock:.75,fire:.15,acid:.95,stone:.25,iron:.5,flesh:.8,ice:.8,magma:.15,axe:.5,hammer:.25},nozone:{},amp:{}},fiend:{weapon:{laser:.75,flame:.25,plasma:.5,kinetic:.25,missile:.75,sonic:.25,shotgun:.5,tesla:.5,claws:.65,venom:.1,cold:.65,shock:.5,fire:.2,acid:.5,stone:.25,iron:.75,flesh:1,ice:.65,magma:.2,axe:.75,hammer:.25},nozone:{},amp:{}},bat:{weapon:{laser:.16,flame:.18,plasma:.12,kinetic:.25,missile:.02,sonic:1,shotgun:.9,tesla:.58,claws:.1,venom:.1,cold:.8,shock:.65,fire:.15,acid:.5,stone:.1,iron:.1,flesh:.5,ice:.8,magma:.2,axe:.1,hammer:.1},nozone:{},amp:{}},medusa:{weapon:{laser:.35,flame:.1,plasma:.3,kinetic:.95,missile:1,sonic:.15,shotgun:.88,tesla:.26,claws:.42,venom:.3,cold:.48,shock:.28,fire:.1,acid:.85,stone:1,iron:.25,flesh:.75,ice:.52,magma:.12,axe:.34,hammer:1},nozone:{},amp:{}},ettin:{weapon:{laser:.5,flame:.35,plasma:.8,kinetic:.5,missile:.25,sonic:.3,shotgun:.6,tesla:.09,claws:.5,venom:.95,cold:.3,shock:.8,fire:.38,acid:.9,stone:.6,iron:.75,flesh:.4,ice:.28,magma:.32,axe:.45,hammer:.25},nozone:{},amp:{}},faceless:{weapon:{laser:.6,flame:.28,plasma:.6,kinetic:0,missile:.05,sonic:.8,shotgun:.15,tesla:1,claws:.02,venom:.01,cold:0,shock:1,fire:.25,acid:.55,stone:.15,iron:.15,flesh:.95,ice:0,magma:.25,axe:.01,hammer:.05},nozone:{},amp:{}},enchanted:{weapon:{laser:1,flame:.02,plasma:.95,kinetic:.2,missile:.7,sonic:.05,shotgun:.65,tesla:.01,claws:.1,venom:0,cold:.5,shock:.01,fire:.02,acid:1,stone:.25,iron:.75,flesh:.1,ice:.5,magma:.03,axe:.1,hammer:.5},nozone:{},amp:{}},gargoyle:{weapon:{laser:.15,flame:.4,plasma:.3,kinetic:.5,missile:.5,sonic:.85,shotgun:1,tesla:.2,claws:.45,venom:.05,cold:.15,shock:.08,fire:.38,acid:.85,stone:1,iron:.85,flesh:.25,ice:.15,magma:.35,axe:.42,hammer:1},nozone:{},amp:{}},chimera:{weapon:{laser:.38,flame:.6,plasma:.42,kinetic:.85,missile:.35,sonic:.5,shotgun:.65,tesla:.8,claws:.92,venom:.5,cold:.45,shock:.8,fire:.56,acid:.4,stone:.5,iron:.5,flesh:.5,ice:.48,magma:.54,axe:.88,hammer:.42},nozone:{},amp:{}},gorgon:{weapon:{laser:.65,flame:.65,plasma:.64,kinetic:.65,missile:.66,sonic:.65,shotgun:.65,tesla:.65,claws:.65,venom:.65,cold:.65,shock:.65,fire:.65,acid:.65,stone:.65,iron:.65,flesh:.65,ice:.65,magma:.65,axe:.65,hammer:.65},nozone:{},amp:{}},kraken:{weapon:{laser:.75,flame:.35,plasma:.75,kinetic:.35,missile:.5,sonic:.18,shotgun:.05,tesla:.85,claws:.32,venom:.8,cold:.66,shock:.82,fire:.33,acid:.75,stone:.45,iron:.35,flesh:.4,ice:.66,magma:.33,axe:.36,hammer:.5},nozone:{},amp:{}},homunculus:{weapon:{laser:.05,flame:1,plasma:.1,kinetic:.85,missile:.65,sonic:.5,shotgun:.75,tesla:.2,claws:.85,venom:.4,cold:.12,shock:.22,fire:1,acid:.13,stone:.65,iron:.68,flesh:.95,ice:.18,magma:.9,axe:.85,hammer:.65},nozone:{},amp:{}},giant_chicken:{weapon:{laser:.95,flame:.95,plasma:.95,kinetic:.95,missile:.95,sonic:.95,shotgun:.95,tesla:.95,claws:.95,venom:.96,cold:.95,shock:.95,fire:.95,acid:.95,stone:.95,iron:.95,flesh:.94,ice:.95,magma:.95,axe:.95,hammer:.95},nozone:{},amp:{}},skeleton_pack:{weapon:{laser:.5,flame:.1,plasma:.5,kinetic:1,missile:1.2,sonic:.5,shotgun:1.05,tesla:.2,claws:.65,venom:0,cold:.11,shock:.22,fire:.1,acid:.5,stone:1,iron:.65,flesh:.25,ice:.1,magma:.12,axe:.15,hammer:1.08},nozone:{},amp:{}}};function te(e,t){let s=ee[e].weapon[t],a=r.stats.reset+(r.portal?.spire?.count||1),l=Math.floor(V(0,25e3,!1,a+(r.portal?.spire?.count||1)*2)),o=Math.floor(V(0,25e3,!1,a+r.stats.reset*2)),p=r.race.warlord?["laser","kinetic","shotgun","missile","flame","plasma","sonic","tesla","claws","venom","cold","shock","fire","acid","stone","iron","flesh","ice","magma","axe","hammer"]:["laser","kinetic","shotgun","missile","flame","plasma","sonic","tesla"],d=p[Math.floor(V(0,p.length,!1,l))],m=p[Math.floor(V(0,p.length,!1,o))];if(t===d){let u=Math.floor(V(0,25e3,!1,l+(r.portal?.spire?.count||1)*3));s-=Math.floor(V(0,26,!1,u))/100,s<0&&(s=0)}else if(t===m){let u=Math.floor(V(0,25e3,!1,o+r.stats.reset*3));s+=Math.floor(V(0,26,!1,u))/100}return s}function A(e,t,s){let a=["laser","kinetic","shotgun","missile","flame","plasma","sonic","tesla"];if(r.race.warlord)switch(e){case"minion":t==="harpy"?a=["claws","venom"]:t==="hound"?a=["cold","shock","fire","acid"]:t==="barghest"&&(a=["claws","venom"]);break;case"fiend":t==="minotaur"?a=["axe","hammer"]:t==="nightmare"?a=["cold","shock","fire","acid"]:t==="golem"&&(a=["stone","iron","flesh","ice","magma"]);break;case"archfiend":if(s===void 0||s===!1)switch(a=["claws","venom","cold","shock","fire","acid"],t){case"dragon":a=["claws","cold","shock","fire","acid"];break;case"snake":a=["venom","cold","shock","fire","acid"];break;case"gorgon":a=["axe","hammer","cold","shock","fire","acid"];break;case"hydra":a=["cold","shock","fire","acid"];break}else switch(t){case"dragon":a=s===0?["claws"]:["cold","shock","fire","acid"];break;case"snake":a=s===0?["venom"]:["cold","shock","fire","acid"];break;case"gorgon":a=s===0?["axe","hammer"]:["cold","shock","fire","acid"];break;case"hydra":a=[["cold","shock","fire","acid"][s]];break}break}return a}function I(e,t,s){let a=["special","shields","sonar","grapple","infrared","flare","radiator","coolant","ablative","stabilizer","seals"];if(r.race.warlord)switch(e){case"minion":a=["scavenger","scouter","darkvision","echo","thermal","manashield","cold","heat","athletic","lucky","stoneskin"];break;case"fiend":case"archfiend":a=["darkvision","echo","thermal","manashield","cold","heat","athletic","lucky","stoneskin"];break}return a}function J(e){switch(e){case"minion":return 1;case"small":return 2;case"fiend":return r.blood.prepared&&r.blood.prepared>=2?3:4;case"medium":return r.blood.prepared&&r.blood.prepared>=2?4:5;case"cyberdemon":return r.blood.prepared&&r.blood.prepared>=2?6:8;case"large":return r.blood.prepared&&r.blood.prepared>=2?8:10;case"archfiend":return r.blood.prepared&&r.blood.prepared>=2?15:20;case"titan":return r.blood.prepared&&r.blood.prepared>=2?20:25;case"collector":return 1;case"default":return 25}}function Oe(e,t,s){return e.equip.includes("special")&&(e.size==="small"||e.size==="medium"||e.size==="collector")&&t<1&&(t+=(1-t)*(s.includes("gravity")?.1:.2)),e.size!=="small"&&t<1&&(t+=(s.includes("fog")||s.includes("dark")?.005:.01)*r.portal.mechbay.scouts,t>1&&(t=1)),t}function fe(e,t){return t<1&&t!==0&&e.equip.includes("special")&&e.size==="titan"&&(t+=(1-t)*.25),e.equip.includes("special")&&(e.size==="large"||e.size==="cyberdemon")&&(t*=1.02),t}function D(e,t){let s=1;switch(t){case"freeze":!e.equip.includes("radiator")&&!e.equip.includes("cold")&&(s=.25);break;case"hot":!e.equip.includes("coolant")&&!e.equip.includes("heat")&&(s=.25);break;case"corrosive":e.equip.includes("ablative")||(e.equip.includes("stoneskin")?s=.9:e.equip.includes("shields")?s=.75:s=e.equip.includes("manashield")?.5:.25);break;case"humid":e.equip.includes("seals")||(s=e.equip.includes("heat")?.85:.75);break;case"windy":["hover","flying_imp","harpy","dragon"].includes(e.chassis)&&(s=.5);break;case"hilly":["spider","flying_imp","harpy","dragon"].includes(e.chassis)||(s=.75);break;case"mountain":e.chassis!=="spider"&&!e.equip.includes("grapple")&&(s=e.equip.includes("flare")||e.equip.includes("echo")?.75:.5);break;case"radioactive":!e.equip.includes("shields")&&e.equip.includes("manashield")&&(s=.5);break;case"quake":e.equip.includes("stabilizer")||(s=e.equip.includes("athletic")?.75:.25);break;case"dust":!e.equip.includes("seals")&&!e.equip.includes("thermal")&&(s=.5);break;case"river":["hover","flying_imp","harpy","dragon"].includes(e.chassis)||(s=.65);break;case"tar":e.chassis!=="quad"&&(s=e.chassis==="tread"||e.chassis==="wheel"?.5:.75);break;case"steam":!e.equip.includes("shields")&&!e.equip.includes("heat")&&(s=.75);break;case"flooded":e.chassis!=="hover"&&(s=["snake"].includes(e.chassis)?.85:.35);break;case"fog":!e.equip.includes("sonar")&&!e.equip.includes("echo")&&(s=.2);break;case"rain":e.equip.includes("seals")||(s=e.equip.includes("cold")?.9:.75);break;case"hail":!e.equip.includes("ablative")&&!e.equip.includes("shields")&&!e.equip.includes("manashield")&&!e.equip.includes("stoneskin")&&(s=.75);break;case"chasm":!e.equip.includes("grapple")&&!["flying_imp","harpy","dragon"].includes(e.chassis)&&(s=e.equip.includes("athletic")?.35:.1);break;case"dark":!e.equip.includes("infrared")&&!e.equip.includes("darkvision")&&(s=e.equip.includes("flare")?.25:.1);break;case"gravity":{switch(e.size){case"fiend":case"medium":s=.8;break;case"cyberdemon":s=.5;case"large":s=.45;break;case"archfiend":s=.35;case"titan":s=.25;break}["flying_imp","harpy","dragon"].includes(e.chassis)&&(s-=.15),e.equip.includes("athletic")&&s<1&&(s+=.1)}break}return e.equip.includes("lucky")&&(s+=.01*Math.floor(V(1,10,!1,r.stats.resets+(r.portal?.spire?.count||1)*42)),s>1&&(s=1)),s}function Y(e,t){let s=t||r.portal.spire.type,a=1;switch(e.chassis){case"wheel":case"nightmare":case"hound":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?.9:.85;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.35:.18;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.92:.85;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.65:.5;break;case"gravel":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.85:.58;break;case"grass":a=["small","medium","minion","fiend"].includes(e.size)?1.3:1.2;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?.9:.8;break;case"concrete":a=["small","medium","minion","fiend"].includes(e.size)?1.1:1;break}break;case"tread":case"rakshasa":case"harpy":case"dragon":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?1.15:1.1;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.55:.4;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.65:.5;break;case"gravel":a=["small","medium","minion","fiend"].includes(e.size)?1.3:1.2;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.88:.72;break}break;case"cambion":case"biped":case"imp":case"gorgon":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?.78:.65;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.68:.5;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.82:.7;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.48:.4;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.85:.7;break;case"grass":a=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?.92:.85;break}break;case"quad":case"golem":case"barghest":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?.86:.75;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.58:.42;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break;case"gravel":a=["small","medium","minion","fiend"].includes(e.size)?.9:.8;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.68:.5;break;case"grass":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break}break;case"spider":case"minotaur":case"hydra":switch(s){case"sand":a=["small","medium","minion","fiend"].includes(e.size)?.75:.65;break;case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?.9:.78;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?.82:.75;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.77:.65;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"gravel":a=["small","medium","minion","fiend"].includes(e.size)?.86:.75;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?.92:.82;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?1:.95;break}break;case"hover":case"flying_imp":case"snake":switch(s){case"swamp":a=["small","medium","minion","fiend"].includes(e.size)?1.35:1.2;break;case"forest":a=["small","medium","minion","fiend"].includes(e.size)?.65:.48;break;case"jungle":a=["small","medium","minion","fiend"].includes(e.size)?.55:.35;break;case"rocky":a=["small","medium","minion","fiend"].includes(e.size)?.82:.68;break;case"muddy":a=["small","medium","minion","fiend"].includes(e.size)?1.15:1.08;break;case"brush":a=["small","medium","minion","fiend"].includes(e.size)?.78:.7;break}break}return a}function kt(e){switch(e){case"minion":return .0015;case"small":return .0025;case"fiend":return .006;case"medium":return .0075;case"cyberdemon":return .009;case"large":return .01;case"archfiend":return .011;case"titan":return .012;default:return 0}}function oe(e,t){let s=kt(e.size);if(s===0)return 0;if(e.hasOwnProperty("infernal")&&e.infernal&&r.blood.prepared&&r.blood.prepared>=3&&(s*=1.25),r.blood.wrath&&(s*=1+r.blood.wrath/20),e.size==="archfiend"&&e.chassis!="hydra"&&(s*=2),t){r.stats.achieve.gladiator&&r.stats.achieve.gladiator.l>0&&(s*=1+r.stats.achieve.gladiator.l*.1),(e.size==="titan"||e.size==="archfiend")&&(s*=1.1);let a=universeAffix();r.stats.spire.hasOwnProperty(a)&&r.stats.spire[a].hasOwnProperty("dlstr")?s/=100+r.stats.spire[a].dlstr*25:s/=100;let l=0;for(let o=0;o<e.hardpoint.length;o++)l+=s*fe(e,1);return l}else{if(r.stats.achieve.gladiator&&r.stats.achieve.gladiator.l>0&&(s*=1+r.stats.achieve.gladiator.l*.2),r.portal.spire.type==="concrete")switch(e.size){case"minion":case"small":s*=.92;break;case"fiend":case"medium":s*=.95;break;case"archfiend":case"titan":s*=1.25;break}let a=Y(e),l=[];Object.keys(r.portal.spire.status).forEach(function(p){l.push(p),s*=D(e,p)}),s*=Oe(e,a,l),s/=r.portal.spire.count;let o=0;for(let p=0;p<e.hardpoint.length;p++){let d=te(r.portal.spire.boss,e.hardpoint[p]);o+=s*fe(e,d)}return o}}var Be;yt(r.settings.locale);function b(e,t){let s=Be[e];if(!s)return r.settings.expose&&(console.error(`string ${e} not found`),console.log(Be)),e;if(t)if(t instanceof Array){for(let o=0;o<t.length;o++){let p=new RegExp(`%${o}(?!\\d)`,"g");if(!p.exec(s)){r.settings.expose&&console.error(`"%${o}" was not found in the string "${e}" to be replace by "${t[o]}"`);continue}s=s.replace(p,t[o])}let a=new RegExp("%\\d+(?!\\d)","g"),l=s.match(a);l&&r.settings.expose&&console.error(`${l} was found in the string, but there is no variables to make the replacement`)}else r.settings.expose&&console.error('"variables" need be a instance of "Array"');return s}function yt(e){$.ajaxSetup({async:!1});let t;if($.getJSON("strings/strings.json",a=>{t=a}),e!="en-US"){let a;try{$.getJSON(`strings/strings.${e}.json`,o=>{a=o})}catch(o){console.error(o,o.stack)}let l=t.length;a&&Object.assign(t,a),t.length!=l&&r.settings.expose&&console.error(`string.${e}.json has extra keys.`)}let s=Ze.getItem("string_pack")||!1;if(s&&r.settings.sPackOn){let a;try{a=JSON.parse(LZString.decompressFromUTF16(s))}catch(o){console.error(o,o.stack)}let l=t.length;a&&Object.assign(t,a),t.length!=l&&r.settings.expose&&console.error("string pack has extra keys.")}$.ajaxSetup({async:!0}),Be=t}var ge={"en-US":"English (US)","es-ES":"Spanish (ESP)","pt-BR":"Portugu\xEAs (BR)","de-DE":"Deutsch","it-IT":"Italiano","ru-RU":"\u0420\u0443\u0441\u0441\u043A\u0438\u0439","cs-CZ":"\u010Ce\u0161tina","pl-PL":"Polski","zh-CN":"\u7B80\u4F53\u4E2D\u6587","zh-TW":"\u7E41\u9AD4\u4E2D\u6587","ko-KR":"\uD55C\uAD6D\uC5B4","im-PL":"Igpay-Atinlay"};function O(e){let t;if(e<0)t=b("time_never");else{e=+e.toFixed(0);let s=60;if(e<s)t=`${e}s`;else{let l=s*60,o=e%s,p=Math.floor(e/s)%60;if(e<l)o>0?t=`${p}m ${o}s`:t=`${p}m`;else{let m=l*24,u=Math.floor(e/l)%24;if(e<m)p>0?t=`${u}h ${p}m`:o>0?t=`${u}h ${o}s`:t=`${u}h`;else{let f=Math.floor(e/m);u>0?t=`${f}d ${u}h`:p>0?t=`${f}d ${p}m`:o>0?t=`${f}d ${o}s`:t=`${f}d`}}}}return t}function P(){this.min=Number.MAX_VALUE,this.max=Number.MIN_VALUE,this.med=0,this.avg=0}function B(e,t,s,a){this.count=e,this.boss=t,this.type=s,this.status=structuredClone(a)}B.areEqual=function(e,t){if(e.count!=t.count||e.boss!=t.boss||e.type!=t.type)return!1;let s=Object.keys(e.status),a=Object.keys(t.status);if(s.length!=a.length)return!1;for(let l of s)if(!a.includes(l))return!1;return!0};function Z(e){return e.length==0?0:e.length%2==0?(e[e.length/2-1]+e[e.length/2])/2:e[(e.length+1)/2-1]}function N(e,t,s){return e+s*(t-e)}function G(e,t,s){return t==e?0:(s-e)/(t-e)}function se(e,t){return e-t}function be(e,t,s){let a=this&&Number.isInteger(this)?this-1:199;if(s.length<=a)return!0;let l=(s.length+1)%2,o=(s.length-l+1)/2+l-1,p=t-o>>31;return(t-o-p*l)%Math.floor(s.length/a)==0||t%(s.length-1)==0}var x={spire:{terrain:["sand","swamp","forest","jungle","rocky","gravel","muddy","grass","brush","concrete"],hazards:["freeze","hot","corrosive","humid","windy","hilly","mountain","radioactive","quake","dust","river","tar","steam","flooded","fog","rain","hail","chasm","dark","gravity"]},mech:{size:{standard:["small","medium","large","titan","collector"],warlord:["minion","fiend","cyberdemon","archfiend"]},type:{standard:["wheel","tread","biped","quad","spider","hover"],minion:["imp","flying_imp","hound","harpy","barghest"],fiend:["cambion","minotaur","nightmare","rakshasa","golem"],cyberdemon:["wheel","tread","biped","quad","spider","hover"],archfiend:["dragon","snake","gorgon","hydra"]},equip:{standard:["special","shields","sonar","grapple","infrared","flare","radiator","coolant","ablative","stabilizer","seals"],warlord:["scavenger","scouter","darkvision","echo","thermal","manashield","cold","heat","athletic","lucky","stoneskin"]}}};function ce(e){if(!r||!r.portal?.spire||r.portal?.spire.boss=="")return 0;let t=1,s=Y(e),a=[];return Object.keys(r.portal.spire.status).forEach(function(l){a.push(l),t*=D(e,l)}),t*=Oe(e,s,a),t}function he(e){if(!r||!r.portal?.spire||r.portal?.spire.boss==""||e.hardpoint.length==0)return 0;let t=0;for(let s=0;s<e.hardpoint.length;s++){let a=te(r.portal.spire.boss,e.hardpoint[s]);t+=fe(e,a)}return t/e.hardpoint.length}function it(e,t,s){if(!r||!r.portal?.spire||r.portal?.spire.boss=="")return 0;let a=1;return s&&(a=Math.floor(ae()/J(e.size))),oe(e,t)*r.portal.spire.count*a}function rt(e,t){return t*r.portal.spire.count*Math.floor(ae()/J(e.size))}function ae(e=!1){return e?r.blood.prepared&&r.blood.prepared>=2?120:200:r.blood.prepared&&r.blood.prepared>=2?r.race.warlord?30:40:r.race.warlord?40:50}var c={currentPage:0,initialized:!1,inTransition:!1,isVisible:!0,armed:!1,copied:!1,copyPage:0,pages:[],specialPages:[],userLabel:null,init(){if(c.initialized)return;h.heap.pageFilters||(h.heap.pageFilters={});let e=$("#pageSelector"),t=$(e.next(".dropdownContent").get(0)).empty(),s=$("#mechLists");c.userLabel=$('<input type="text" id="pageUserLabel" class="fullSpan spanImpostor" maxlength="32"></input>'),c.userLabel.on("click",d=>{d.stopPropagation()}),c.userLabel.on("input",c.updateLabel),c.userLabel.on("keyup",d=>{d.which==13}),t.append(c.userLabel),c.pages.length=h.maxMechPages;for(var a=0;a<c.pages.length;a++){let d=h.labels[a]?`P${a+1} | ${h.labels[a]}`:`Page ${a+1}`;c.pages[a]=new pe(a,d,Fe(a),a,!0),t.append($(`<a data-val="${a}">${a+1}</a>`).on("click",{i:a},m=>{setTimeout(()=>{c.showPage(m.data.i),c.update(!0)},0)})),s.append(c.pages[a].dom)}let l=new Ie("hvt","Heavy vs. Titan",[],!1);c.specialPages.push(l),t.append($(`<a class="fullSpan">${l.name}</a>`).on("click",{i:-c.specialPages.length},d=>{setTimeout(()=>{c.showPage(d.data.i),c.update(!0)},0)})),s.append(l.dom);let o=new pe("mechbay",b("portal_mechbay_title"),r.portal.mechbay.mechs??[],-1,!0);c.specialPages.push(o),t.append($(`<a class="fullSpan">${o.name}</a>`).on("click",{i:-c.specialPages.length},d=>{setTimeout(()=>{c.showPage(d.data.i),c.update(!0)},0)})),s.append(o.dom),h.on(h.EV_CLOSE_DROPDOWNS,c.disarmClearList),lt.push();let p=$($("#clearList").next(".dropdownContent").get(0));p.on("click",d=>{d.stopPropagation()}),$("#clearList").on("click",c.disarmClearList),$("#clearListArm").on("click",d=>{c.armed=!c.armed,c.armed?$("#clearListAbsolutely").toggleClass("inactive",!1).on("click",m=>{p.toggleClass("show",!1),c.clearList(),c.disarmClearList()}):$("#clearListAbsolutely").toggleClass("inactive",!0).off("click")}),$("#copyList").on("click",d=>{c.copied=!0,c.copyPage=c.currentPage,c.setPasteControls(c.copyPage!=c.currentPage),E("info","Mech list copied")}),$("#pasteListConfirm").on("click",d=>{c.copyPage!=c.currentPage&&(c.copied=!1,c.copyFromTo(c.copyPage,c.currentPage),c.setPasteControls(!1))}),$("#pasteListClear").on("click",d=>{c.copyPage!=c.currentPage&&(c.copied=!1,c.setPasteControls(!1))}),c.currentPage=h.config.defaultPage,c.initialized=!0,c.showPage(c.currentPage)},showPage(e){if(c.initialized!=!1){for(var t=0;t<c.pages.length;t++)t!=e&&c.pages[t].hide();for(var t=0;t<c.specialPages.length;t++)t!=-(e+1)&&c.specialPages[t].hide();if(e<0){if(Math.abs(e)>c.specialPages.length)return;switch(c.currentPage=e,c.specialPages[-(e+1)].key){case"mechbay":c.specialPages[-(e+1)].hide(),c.specialPages[-(e+1)].mechList=r.portal.mechbay.mechs??[];break}c.isVisible&&c.specialPages[-(e+1)].show(),c.userLabel.attr("style","display: none");let s=$($("#pageSelector").text(`${c.specialPages[-(e+1)].name}`).next(".dropdownContent").get(0));$(s.children("a").toggleClass("current",!1).get(c.pages.length+Math.abs(e)-1)).toggleClass("current",!0),c.setCopyControls(c.specialPages[-(e+1)].mechList.length>0)}else{if(e>=c.pages.length)return;c.currentPage=e,c.isVisible&&c.pages[e].show(),c.userLabel.attr("style",""),c.userLabel.attr("placeholder",`Page ${e+1}`),c.userLabel.val(h.labels[e]?h.labels[e]:"");let s=$($("#pageSelector").text(h.labels[e]?`P${e+1} | ${h.labels[e]}`:`Page ${e+1}`).next(".dropdownContent").get(0));$(s.children("a").toggleClass("current",!1).get(e)).toggleClass("current",!0),c.setCopyControls(c.pages[e].mechList.length>0)}c.setPasteControls(c.copied&&c.copyPage!=c.currentPage),h.config.defaultPage=c.currentPage,_()}},update(e){if(c.initialized!=!1&&c.isVisible&&!(e&&!R()))if(c.currentPage<0){if(Math.abs(c.currentPage)>c.specialPages.length)return;let t=-(c.currentPage+1);c.specialPages[t].update(e)}else{if(c.currentPage>=c.pages.length)return;c.pages[c.currentPage].update(e)}},hide(){if(c.initialized!=!1){for(var e=0;e<c.pages.length;e++)c.pages[e].hide();for(var e=0;e<c.specialPages.length;e++)c.specialPages[e].hide()}},addMech(e){if(c.currentPage<0){if(Math.abs(c.currentPage)>c.specialPages.length)return;c.specialPages[-(c.currentPage+1)].addMech(e)}else{if(c.currentPage>=c.pages.length)return;c.pages[c.currentPage].addMech(e)}},getCurrent(){if(c.currentPage<0){if(Math.abs(c.currentPage)>c.specialPages.length)return null;let e=-(c.currentPage+1);return c.specialPages[e]}else return c.currentPage>=c.pages.length?null:c.pages[c.currentPage]},getCurrentList(){if(c.currentPage<0){if(Math.abs(c.currentPage)>c.specialPages.length)return[];let e=-(c.currentPage+1);return c.specialPages[e].mechList}else return c.currentPage>=c.pages.length?[]:c.pages[c.currentPage].mechList},disarmClearList(){c.armed=!1,$("#clearListAbsolutely").toggleClass("inactive",!0).off("click")},clearList(e){if(!c.armed)return;Number.isInteger(e)||(e=c.currentPage);let t;if(c.currentPage<0){if(Math.abs(c.currentPage)>c.specialPages.length)return[];let s=-(c.currentPage+1);t=c.specialPages[s]}else{if(c.currentPage>=c.pages.length)return[];t=c.pages[c.currentPage]}t.clearable&&(t.mechList=[],c.currentPage>=0&&De(c.currentPage,[]),c.setCopyControls(!1),E("~",`Cleared list ${c.currentPage} ${e}`),setTimeout(()=>{t.hide(),t.show(),t.update(R())},0))},saveMechList(e,t){e<0||(E("log",De(e,t)),e==c.copyPage&&(!t||t.length==0)&&(c.copied=!1,c.setPasteControls(!1)),e==c.currentPage&&c.setCopyControls(t&&t.length>0))},updateLabel(e){if(c.currentPage<0)return;let t=e.target.value?e.target.value:"";h.labels[c.currentPage]=t.trim().substring(0,32),c.pages[c.currentPage].name=h.labels[c.currentPage]?`P${c.currentPage+1} | ${h.labels[c.currentPage]}`:`Page ${c.currentPage+1}`,tt(),$("#pageSelector").text(c.pages[c.currentPage].name)},setPasteControls(e){e&&c.currentPage>=0?$("#pasteList").attr("style",""):$("#pasteList").attr("style","visibility: hidden")},setCopyControls(e){e?$("#copyList").attr("style",""):$("#copyList").attr("style","visibility: hidden")},copyFromTo(e,t){if(e==t||t<0)return;let s=e<0?c.specialPages[-(e+1)]:c.pages[e];if(s.mechList.length==0)return;c.saveMechList(t,s.mechList);let a=c.pages[t];E("info",`Copied mech list from ${s.name} to ${a.name}`),a.mechList=Fe(t),setTimeout(()=>{a.hide(),a.show(),a.update(R())},0)}},we=class{constructor(){K(this,"shown",!1)}show(){this.shown||(this.shown=!0)}hide(){this.shown&&(this.shown=!1)}update(){this.shown}},pe=class extends we{constructor(s,a,l,o,p=!0){super();K(this,"filter",s=>{if(this.shown&&s&&s.target&&s.target.dataset.hasOwnProperty("pageFilter")){switch(s.target.dataset.pageFilter){case"minion":case"small":this.pageFilters.minion=!this.pageFilters.minion,this.pageFilters.small=!this.pageFilters.small;break;case"fiend":case"medium":this.pageFilters.fiend=!this.pageFilters.fiend,this.pageFilters.medium=!this.pageFilters.medium;break;case"cyberdemon":case"large":this.pageFilters.cyberdemon=!this.pageFilters.cyberdemon,this.pageFilters.large=!this.pageFilters.large;break;case"archfiend":case"titan":this.pageFilters.archfiend=!this.pageFilters.archfiend,this.pageFilters.titan=!this.pageFilters.titan;break;default:this.pageFilters[s.target.dataset.pageFilter]=!this.pageFilters[s.target.dataset.pageFilter]}h.heap.pageFilters[this.key]=this.pageFilters,st(),setTimeout(()=>{this.pageMeta.update(this.pageFilters),this.update(!1)},0)}});K(this,"removeMech",s=>{let a=this.mechList.indexOf(s.mech),l=this.lines.indexOf(s);a<0||l<0||(s.dom.remove(),this.pageMeta.totals[this.mechList[a].size]--,this.mechList.splice(a,1),this.lines.splice(l,1),c.saveMechList(this.id,this.mechList),this.lines.length==0&&(this.pageMeta.dom.detach(),this.dom.empty(),this.dom.append(this.pageMeta.dom),this.dom.append(this.dudString)),this.key=="mechbay"&&r.eden?.mech_station?.mechs&&(r.eden.mech_station.mechs=0),setTimeout(()=>{this.pageMeta.update(this.pageFilters),this.update(R())},0))});this.key=s,this.name=a,this.id=o,this.mechList=l,this.lines=[],this.dom=$(`<div id="mpage-${o}"></div>`),this.modifiable=p,this.clearable=!0,this.originalOrder=!0,this.pageFilters=Object.create(Ct),h.heap.pageFilters[this.key]&&Object.assign(this.pageFilters,h.heap.pageFilters[this.key]),this.pageMeta=new Re,this.pageMeta.summaryDom.addEventListener("click",this.filter),this.pageMeta.totals=Object.create(nt),this.dudString=s=="mechbay"?xt:$t,this.delimiters=0,s=="mechbay"&&(this.pageFilters.collector=!1)}show(){if(this.shown)return;this.pageMeta.dom.detach(),this.dom.empty(),this.shown=!0;let s=0;if(this.pageMeta.totals=Object.create(nt),this.mechList.forEach(function(a,l){let o=new ke(a,l,h.config.truncateWeapons,this.modifiable,this.removeMech);this.lines.push(o),this.pageFilters[a.size]&&this.dom.append(o.dom),s+=J(a.size),this.pageMeta.totals[a.size]++},this),this.lines.length==0)this.dom.append(this.dudString),this.pageMeta.update(this.pageFilters);else{let a=document.createElement("span");a.appendChild(document.createTextNode(`${s}`));let l;this.key=="mechbay"?(l=` / ${r.portal.mechbay.max}`,s>r.portal.mechbay.max&&(a.className="error")):l="/ \u221E",this.pageMeta.spaceDom.replaceChildren(a,l),this.pageMeta.update(this.pageFilters)}this.dom.prepend(this.pageMeta.dom)}hide(){this.shown&&(this.shown=!1,this.lines.length=0,this.pageMeta.dom.detach(),this.dom.empty(),this.delimiters=0)}update(s){if(!this.shown)return;let a=0,l=0,o=this.key=="mechbay"&&r.eden?.mech_station?.mechs||0,p=s?Object.keys(this.pageMeta.factors):{};if(s){this.pageMeta.factors.reset();for(var d=0;d<this.mechList.length;d++)l+=J(this.mechList[d].size),o>0&&this.mechList[d].size!=="collector"?o--:(l<=r.portal.mechbay.max||this.key!="mechbay")&&(this.pageMeta.factors.rr.val+=oe(this.mechList[d],!1))}if(l=0,s)this.delimiters>0&&(this.dom.children(".delimiter").remove(),this.delimiters=0),this.lines.forEach(function(m){l+=J(m.mech.size),m.calc(),m.mech.size!=="collector"&&(p.forEach(function(u,f){switch(u){case"rr":break;default:this.pageMeta.factors[u].val=(m.factors[u].val+a*this.pageMeta.factors[u].val)/(a+1)}},this),a++)},this);else{let m,u=-1,f=0,v=-1,g=0,S=h.config.sortingType!=0&&h.config.sortingType!=4&&h.config.groupingType==2&&R();this.delimiters>0&&(this.dom.children(".delimiter").remove(),this.delimiters=0),this.lines.forEach(function(w,k){l+=J(w.mech.size);let z=!1;if(this.pageFilters[w.mech.size]&&w.dom.parent().length==0?(m?.dom.parent().length>0?m.dom.after(w.dom):this.pageMeta.dom.after(w.dom),m=w,z=!0):this.pageFilters[w.mech.size]==!1?w.dom.detach():(m=w,z=!0),S&&z){if(v=Ne[w.mech.chassis],u>=0&&u!=v){let M=b(`portal_mech_chassis_${this.lines[f].mech.chassis}`);this.lines[f].dom.before(ve("portal_mech_chassis_",this.lines[f].mech.chassis,g)),this.delimiters++,g=1,f=k}else g++;u==-1&&(f=k),u=v}w.truncate(h.config.truncateWeapons)},this),S&&f>=0&&f<this.lines.length&&(this.lines[f].dom.before(ve("portal_mech_chassis_",this.lines[f].mech.chassis,g)),this.delimiters++)}if(s){this.pageMeta.factors.applyValues(),this.pageMeta.factors.ar.dom.title=`Total raw unadjusted rating: ${le.format(Math.round(this.pageMeta.factors.rr.val*1e3*r.portal.spire.count))}`;let m="ET ["+(this.pageMeta.factors.rr?.val?O(100/this.pageMeta.factors.rr.val):O(-1))+"]";if(this.key=="mechbay"){let u=document.createElement("span");l>r.portal.mechbay.max&&(u.className="error"),u.appendChild(document.createTextNode(`${l}`)),this.pageMeta.spaceDom.replaceChildren(u,` / ${r.portal.mechbay.max}`),m+=`    - ${(100-r.portal.spire.progress).toFixed(2)}% left [`+(this.pageMeta.factors.rr?.val?O((100-r.portal.spire.progress)/this.pageMeta.factors.rr.val):O(-1))+"]",r.eden?.mech_station?.mechs>0&&(m+=` - ${r.eden.mech_station.mechs} mechs busy in ${b("tab_eden")}`)}this.pageMeta.etaDom.textContent=m}if(this.key!="mechbay"){let m=document.createElement("span");m.appendChild(document.createTextNode(`${l}`)),this.pageMeta.spaceDom.replaceChildren(m,"/ \u221E")}if(s&&this.sort(!0)){let m=-1,u=-1,f=-1,v=0,g=h.config.sortingType!=0&&h.config.sortingType!=4&&h.config.groupingType==2;for(var d=this.lines.length-1;d>=0;d--)if(this.pageFilters[this.lines[d].mech.size]){if(g){if(f=Ne[this.lines[d].mech.chassis],m>=0&&m!=f){let w=b(`portal_mech_chassis_${this.lines[u].mech.chassis}`);this.pageMeta.dom.after(ve("portal_mech_chassis_",this.lines[u].mech.chassis,v)),this.delimiters++,v=1}else v++;m=f,u=d}this.pageMeta.dom.after(this.lines[d].dom)}else this.lines[d].dom.detach();g&&u>=0&&u<this.lines.length&&(this.pageMeta.dom.after(ve("portal_mech_chassis_",this.lines[u].mech.chassis,v)),this.delimiters++)}}sort(s){let a=!1,l,o,p=h.config.sortingType==4?0:h.config.groupingType;switch(p){case 1:case 2:o=(d,m)=>d.v2<m.v2?1:d.v2>m.v2?-1:d.v1<m.v1?-h.config.sortingDirection:d.v1>m.v1?h.config.sortingDirection:0;break;default:o=(d,m)=>d.v1<m.v1?-h.config.sortingDirection:d.v1>m.v1?h.config.sortingDirection:0;break}switch(h.config.sortingType){case 1:case 2:case 3:l=this.lines.map((d,m)=>({i:m,v1:(()=>{switch(h.config.sortingType){case 1:return d.factors.ff.val;case 2:return d.factors.ar.val;case 3:return de[d.mech.size]}})(),v2:(()=>{switch(p){case 1:return de[d.mech.size];case 2:return Ne[d.mech.chassis];default:return null}})()})),a=!0,this.originalOrder=!1;break;case 4:if(this.originalOrder)return!1;l=this.lines.map((d,m)=>({i:m,v1:this.mechList.indexOf(d.mech),v2:null}),this),o=(d,m)=>m.v1<d.v1?1:m.v1>d.v1?-1:0,a=!0,this.originalOrder=!0;break;default:return!1}return l.sort(o),this.lines=l.map(d=>this.lines[d.i]),a}addMech(s){if(!this.modifiable){E("error","This list can't be modified");return}this.lines.length==0&&(this.pageMeta.dom.detach(),this.dom.empty(),this.dom.append(this.pageMeta.dom)),this.key=="mechbay"&&r.eden?.mech_station?.mechs&&(r.eden.mech_station.mechs=0);let a=new ke(s,this.mechList.length,h.config.truncateWeapons,this.modifiable,this.removeMech);this.mechList.push(s),this.lines.push(a),this.dom.append(a.dom),this.pageMeta.totals[s.size]++,this.pageMeta.update(this.pageFilters),c.saveMechList(this.id,this.mechList),E("log","Mech added","added_mech")}},Ie=class extends pe{constructor(s,a,l,o,p=!1){super(s,a,[{size:"large",hardpoint:["tesla","tesla"],chassis:"hover",equip:["special","coolant","shields"],infernal:!1},{size:"titan",hardpoint:["tesla","tesla","tesla","tesla"],chassis:"hover",equip:["special","coolant","shields","sonar","stabilizer"],infernal:!1}],o,!1);K(this,"removeMech",s=>{});this.clearable=!1,this.explainLine=$(St)}syncWithConstructor(){if(["small","medium","large","titan","collector"].includes(n.mech.size))for(let s of this.mechList){s.chassis=n.mech.chassis,s.infernal=n.mech.infernal;for(let a=0;a<s.hardpoint.length;a++)a<n.mech.hardpoint.length&&(s.hardpoint[a]=n.mech.hardpoint[a]);for(let a=0;a<s.equip.length;a++)a<n.mech.equip.length&&(s.equip[a]=n.mech.equip[a])}}show(){this.syncWithConstructor(),super.show(),this.dom.append(this.explainLine),h.on(h.EV_CONSTRUCTOR,s=>{this.hide(),this.show(),this.update(R())})}hide(){h.off(h.EV_CONSTRUCTOR),this.explainLine.detach(),super.hide()}update(s){this.syncWithConstructor(),this.explainLine.detach(),super.update(s),this.dom.append(this.explainLine)}addMech(s){E("error","This list can't be modified")}},$t='<div class="line smaller" ><div class="text"><span><i>&lt; Mech list is empty &gt;</i></span></div></div>',xt='<div class="line smaller" ><div class="text"><span><i>&lt; Import mech bay from a save game &gt;</i></span></div></div>',St=`<div class="line smaller"><div class="text" id="hvtExplain"><p><span class="titan">Titans</span> have higher raw firepower, but <span class="large">Heavy</span> mechs are more space efficient. 
							On rare occasion, when weapon effectiveness against boss is way below 100%, <span class="titan">Titan</span> mechs can get ahead with the help of <i>${b("portal_mech_equip_target")}</i> equipment.
							This page is meant to illustrate that.</p><p>Loadouts are synced with the constructor.</p></div></div>`,je=x.mech.size.standard.concat(x.mech.size.warlord),de={collector:0,minion:1,small:2,fiend:3,medium:4,cyberdemon:5,large:6,archfiend:7,titan:8};je.forEach(e=>{de[e]??(de[e]=0)});var Ne=Object.fromEntries([...new Set([...x.mech.type.standard,...x.mech.type.minion,...x.mech.type.fiend,...x.mech.type.cyberdemon,...x.mech.type.archfiend])].sort().map((e,t)=>[e,t])),Ct=Object.fromEntries(je.map(e=>[e,!0])),nt=Object.fromEntries(je.map(e=>[e,0]));function ve(e,t,s){let a=document.createElement("div");a.className=`mcLn line delimiter smaller ${t}`;let l=document.createElement("div");l.className="title";let o=document.createElement("span");return o.textContent=`${s}x ${b(`${e}${t}`)}`,l.appendChild(o),a.appendChild(l),a}function me(){this.tf={val:0,dom:null},this.wf={val:0,dom:null},this.ff={val:0,dom:null},this.ar={val:0,dom:null},this.rr={val:0,dom:null}}var ye=Object.keys(new me);me.prototype.applyValues=function(){ye.forEach(function(e){switch(e){case"rr":break;case"ar":this[e].val!=0?this[e].dom.textContent=le.format((this[e].val*1e3).toFixed(0)):this[e].dom.textContent="-";break;default:this[e].dom.textContent=(this[e].val*100).toFixed(1)+"%"}},this)};me.prototype.reset=function(){ye.forEach(function(e){this[e].val=0},this)};var Re=class{constructor(){this.factors=new me;let t=[];ye.forEach(function(o,p){if(o=="rr")return;let d=document.createElement("div");d.className=`stat sco${p}`,t.push(d),this.factors[o].dom=d},this);let s=document.createElement("div");s.className="mcLn line smaller meta";let a=document.createElement("div");a.className="title",this.spaceDom=document.createElement("span"),this.summaryDom=document.createElement("span"),this.summaryDom.className="summary",this.summaryDom.setAttribute("title","Filter mech display"),a.appendChild(this.spaceDom),a.appendChild(this.summaryDom);let l=document.createElement("div");l.className="form",this.etaDom=document.createElement("span"),l.appendChild(this.etaDom),s.appendChild(a);for(let o of t)s.appendChild(o);s.appendChild(l),this.dom=$(s)}update(t){let s=[];s.push(["titan",this.totals.titan+this.totals.archfiend,t.titan]),s.push(["large",this.totals.large+this.totals.cyberdemon,t.large]),s.push(["medium",this.totals.medium+this.totals.fiend,t.medium]),s.push(["small",this.totals.small+this.totals.minion,t.small]),s.push(["collector",this.totals.collector,t.collector]);let a=[];s.forEach(function(l){if(l[1]>0){let o=document.createElement("a");o.className=`${l[0]} clickable`,o.appendChild(document.createTextNode(`${l[2]?"\u25FC":"\u25FB"} ${l[1]}`)),o.dataset.pageFilter=`${l[0]}`,a.push(o)}}),this.summaryDom.replaceChildren(...a)}},ke=class{constructor(t,s,a,l=!0,o){this.idx=s,this.mech=t,this.factors=new me;let p=[];this.mech.hardpoint.forEach(function(k,z){if(a&&z>0){p.push("..");return}p.push(b(`portal_mech_weapon_${k}`))});let d=[];this.mech.equip.forEach(function(k){d.push(b(`portal_mech_equip_${n.filterEquip(this.mech.size,k)}`))},this);let m=document.createElement("div");m.className=`mcLn line smaller ${this.mech.size} ${this.mech.chassis} ${this.mech.infernal&&r.blood.prepared==3?"infernal":""}`;let u=document.createElement("div");u.className="title";let f=document.createElement("span");if(f.className="mcCls",f.appendChild(document.createTextNode(b(`portal_mech_size_${this.mech.size}`))),this.mech.infernal){let k=document.createElement("sup");k.appendChild(document.createTextNode("Inf")),f.appendChild(k)}let v=document.createElement("span");v.appendChild(document.createTextNode(b(`portal_mech_chassis_${this.mech.chassis}`))),u.appendChild(f),u.appendChild(v);let g=[];ye.forEach(function(k,z){if(k=="rr")return;let M=document.createElement("div");M.className=`stat sco${z}`,g.push(M),this.factors[k].dom=M},this);let S=document.createElement("div");S.className="text",this.wepDom=document.createElement("span"),this.wepDom.appendChild(document.createTextNode(p.join(" | ")));let w=document.createElement("span");if(w.className="mcCls",w.appendChild(document.createTextNode(d.join(" | "))),l){let k=document.createElement("span");k.className="delete",k.appendChild(document.createTextNode("x")),S.appendChild(k),k.addEventListener("click",o.bind(null,this),{once:!0})}S.appendChild(this.wepDom),S.appendChild(w),m.appendChild(u);for(let k of g)m.appendChild(k);m.appendChild(S),this.dom=$(m)}truncate(t){let s=[];this.mech.hardpoint.forEach(function(a,l){if(t&&l>0){s.push("..");return}s.push(b(`portal_mech_weapon_${a}`))}),this.wepDom.textContent=s.join(" | ")}calc(){this.factors.tf.val=ce(this.mech),this.factors.wf.val=this.mech.size!="collector"?he(this.mech):0,this.factors.ff.val=this.mech.size!="collector"?this.factors.tf.val*this.factors.wf.val:this.factors.tf.val,this.factors.rr.val=oe(this.mech,!1),this.factors.ar.val=rt(this.mech,this.factors.rr.val),this.factors.applyValues()}};var n={mech:{size:"small",hardpoint:["laser"],chassis:"tread",equip:[],infernal:!1},dummy:{size:"small",hardpoint:["laser"],chassis:"tread",equip:[],infernal:!1},config:{initialized:!1,warlord:!1,wrath:0,prepared:0},callbacks:{saveMech:null},statusTable:{},init(){n.config.warlord=r.race.warlord||!1,n.config.prepared=r.blood.prepared||!1,n.config.wrath=r.blood.wrath||0,n.config.initialized||($("#cMechInfernal").on("click",e=>{n.setInfernal(!n.mech.infernal)}),$("#cMechAdd").on("click",e=>{n.save()}),n.statusTable=zt(),$("#cMechChassis").on("mouseenter",{chassis:!0},L).on("mouseleave",{not:!0},L),$($("#cMechChassis").next(".dropdownContent").get(0)).on("mouseenter",{target:"#spireTerrain"},ie).on("mouseleave",{not:!0},ie),$(".cMechWeapon").each((e,t)=>{$($(t).next(".dropdownContent").get(0)).on("mouseenter",{target:"#spireBoss"},ie).on("mouseleave",{not:!0},ie).on("click",s=>{s.target?.dataset?.val&&(n.setWeapon(s.target.dataset.val,e),n.calc())})}),$(".cMechEquip").each((e,t)=>{$($(t).next(".dropdownContent").get(0)).on("click",s=>{s.target?.dataset?.val&&(n.setEquip(s.target.dataset.val,e),s.target?.dataset?.delta?t.dataset.delta=s.target.dataset.delta:delete t.dataset.delta,n.calc())})}).on("mouseenter",{equip:!0},L).on("mouseleave",{not:!0},L)),n.config.initialized=!0,n.draw()},draw(){if(!n.config.initialized)return;$("#cMechInfernal").text(n.mech.infernal?"\u2714":"\u{1F7AD}").parent().toggleClass("faded",!n.mech.infernal);let e="",t=$("#cMechSize"),s=$(t.next(".dropdownContent").get(0)).empty(),a=n.config.warlord?x.mech.size.warlord:x.mech.size.standard;a.forEach(function(f,v){let g=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(w){n.statusTable[w].size[f]&&(g+=n.statusTable[w].size[f])});let S=g>0?`<span style="pointer-events: none;" class="${X[Math.floor((1-Math.min(g,1))*(X.length-1))]}"> -${Math.round(g*100)}%</span>`:"";e+=`<a data-val="${f}"${g>0?` data-delta="${g}"`:""}>${b(`portal_mech_size_${f}`)}${S}</a>`}),s.append($(e).on("click",f=>{n.setSize(f.currentTarget.dataset.val),n.draw(),h.config.defaultMSize=n.mech.size,_()})),s.children("a[data-delta]").on("mouseenter",{size:!0},L).on("mouseleave",{not:!0},L),a.includes(n.mech.size)||n.setSize(a[0]);let l=n.mech.size;a.includes(t.val())&&(l=t.val(),n.mech.size=l),t.val(l).text(b(`portal_mech_size_${l}`));let o=$("#cMechChassis"),p=$(o.next(".dropdownContent").get(0)).empty(),d=ot(n.mech);e="",n.dummy.size=n.mech.size,d.forEach(function(f,v){n.dummy.chassis=f;let g=r.portal?.spire?.type?Y(n.dummy):0,S=r.portal?.spire?.type?`<span class="${X[Math.floor(Math.min(g,1)*(X.length-1))]}">[${(g*100).toFixed(0)}%]</span>`:"",w=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(k){n.statusTable[k].chassis[f]&&(w+=n.statusTable[k].chassis[f])}),e+=`<a data-val="${f}" ${w!=0?`data-delta="${w}" class="${w>0?"notreally ":""}recommended strength-1"`:""}"><span>${b(`portal_mech_chassis_${f}`)}</span> ${S}</a>`}),p.append($(e).on("click",f=>{n.setType(f.currentTarget.dataset.val),n.draw(),h.config.defaultMType=n.mech.chassis,_(),L(),ie()})),p.children("a[data-delta]").on("mouseenter",{chassis:!0},L).on("mouseleave",{not:!0},L),d.includes(n.mech.chassis)?n.setType(n.mech.chassis):n.setType(d[0]);let m=n.mech.chassis;d.includes(o.val())&&(m=o.val(),n.mech.chassis=m),o.val(m).text(b(`portal_mech_chassis_${m}`)),$(".cMechWeapon").each((f,v)=>{let g=$(v),S=A(n.mech.size,n.mech.chassis,f),w=g.next(".dropdownContent").get(0);if(w.replaceChildren(),S.forEach(function(k){let z=document.createElement("a");z.dataset.val=k;let M=document.createElement("span");if(M.appendChild(document.createTextNode(b(`portal_mech_weapon_${k}`))),M.style.pointerEvents="none",z.appendChild(M),r.portal?.spire?.boss){let W=ee[r.portal.spire.boss].weapon[k],y=te(r.portal.spire.boss,k),T=document.createElement("span");T.className=$e[Math.floor(Math.min(y,1)*($e.length-1))],T.appendChild(document.createTextNode(` [${(y*100).toFixed(0)}%]${y<W?"\u2BC6":y>W?"\u2BC5":""}`)),T.style.pointerEvents="none",z.appendChild(T)}w.appendChild(z)}),g.parent().toggleClass("inactive",!n.vis(f)),n.vis(f)){let k=g.val();S.includes(k)?n.setWeapon(k,f):n.setWeapon(S[0],f)}});let u=n.config.prepared?5:4;$(".cMechEquip").each((f,v)=>{let g=$(v),S=I(n.mech.size,n.mech.chassis,f),w=g.next(".dropdownContent").get(0);if($(w).children("a[data-delta]").off(),w.replaceChildren(),S.forEach(function(k){let z=n.filterEquip(n.mech.size,k),M=!1,W=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(T){n.statusTable[T].equip[k]&&(W+=n.statusTable[T].equip[k],M=!0)});let y=document.createElement("a");y.dataset.val=k,y.appendChild(document.createTextNode(b(`portal_mech_equip_${z}`))),M&&W<0&&(y.dataset.delta=W,y.className=`recommended strength-${Math.min(Math.floor(Math.abs(W)*3+1),3)}`),w.appendChild(y)}),g.parent().toggleClass("inactive",!(n.eqVis(f)&&f<u)),$(w).children("a[data-delta]").on("mouseenter",{equip:!0},L).on("mouseleave",{not:!0},L),n.eqVis(f)&&f<u){let k=g.val();if(!S.includes(k))n.setEquip(S[f],f);else{let z=n.filterEquip(n.mech.size,n.mech.equip[f]);g.val(n.mech.equip[f]).text(b(`portal_mech_equip_${z}`)),v.dataset.val=n.mech.equip[f]}}}),$("#cMechInfernal").parent().toggleClass("inactive",n.config.prepared!=3),n.calc()},drawBasicTable(){if(!n.config.initialized)return;let e=$("#terrainTable"),t=$("#resistanceTable"),s=$("#equipmentTable");if(e.empty(),t.empty(),s.empty(),r.portal?.spire?.type&&e.prev().text(b(`portal_spire_type_${r.portal.spire.type}`)),e=e.get(0),(r.race.warlord?x.mech.size.warlord:[""]).forEach(function(d){n.dummy.size=d,ot(n.dummy).forEach(function(u,f){n.dummy.size=r.race.warlord?d:"small",n.dummy.chassis=u;let v=r.portal?.spire?.type?Y(n.dummy):0;n.dummy.size="large";let g=r.portal?.spire?.type?Y(n.dummy):0,S=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(z){n.statusTable[z].chassis[u]&&(S+=n.statusTable[z].chassis[u])});let w=document.createElement("a");w.dataset.val=u;let k=document.createElement("span");if(k.appendChild(document.createTextNode(b(`portal_mech_chassis_${u}`))),k.style.pointerEvents="none",r.portal?.spire?.type){let z=document.createElement("span");if(z.className=X[Math.floor(Math.min(v,1)*(X.length-1))],z.style.pointerEvents="none",z.appendChild(document.createTextNode(`[${(v*100).toFixed(0)}%] `)),r.race.warlord)w.appendChild(z);else{let M=document.createElement("span");M.className=X[Math.floor(Math.min(g,1)*(X.length-1))],M.style.pointerEvents="none",M.appendChild(document.createTextNode(`[${(g*100).toFixed(0)}%] `)),w.appendChild(document.createTextNode("S")),w.appendChild(z),w.appendChild(document.createTextNode("L")),w.appendChild(M)}}S!=0&&(w.dataset.delta=S,w.className=`${S>0?"notreally ":""}recommended strength-1`),w.appendChild(k),e.appendChild(w)})}),$(e).children("a[data-delta]").on("mouseenter",{chassis:!0},L).on("mouseleave",{not:!0},L),r.portal.spire.boss){t.prev().text(b(`portal_mech_boss_${r.portal.spire.boss}`)),t=t.get(0);let d=A("medium","tread",0);for(var[l,o]of Object.entries(ee[r.portal.spire.boss].weapon)){if(!r.race.warlord&&!d.includes(l))continue;let m=document.createElement("a");m.dataset.val=l;let u=document.createElement("span");if(u.appendChild(document.createTextNode(b(`portal_mech_weapon_${l}`))),u.style.pointerEvents="none",r.portal?.spire?.boss){let f=o,v=te(r.portal.spire.boss,l),g=document.createElement("span");g.className=$e[Math.floor(Math.min(v,1)*($e.length-1))],g.appendChild(document.createTextNode(`[${(v*100).toFixed(0)}%]${v<f?"\u2BC6":v>f?"\u2BC5":""} `)),g.style.pointerEvents="none",m.appendChild(g)}m.appendChild(u),t.appendChild(m)}}s=s.get(0);let p=x.mech.equip.standard;r.race.warlord&&(p=p.concat(x.mech.equip.warlord)),p=p.filter(d=>["special","scavenger","scouter"].includes(d)==!1),p.forEach(function(d){let m=!1,u=0;r.portal?.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(v){n.statusTable[v].equip[d]&&(u+=n.statusTable[v].equip[d],m=!0)});let f=document.createElement("a");f.dataset.val=d,f.appendChild(document.createTextNode(b(`portal_mech_equip_${d}`))),m&&u<0&&(f.dataset.delta=u,f.className=`recommended strength-${Math.min(Math.floor(Math.abs(u)*3+1),3)}`),s.appendChild(f)}),$(s).children("a[data-delta]").on("mouseenter",{equip:!0},L).on("mouseleave",{not:!0},L)},calc(){n.config.initialized&&$("#mechConstructor").find(".stat").each((e,t)=>{let s=0;switch(e){case 0:s=(ce(n.mech)*100).toFixed(1)+"%";break;case 1:s=(he(n.mech)*100).toFixed(1)+"%";break;case 2:s=(ce(n.mech)*he(n.mech)*100).toFixed(1)+"%";break;case 3:s=le.format((it(n.mech,!1,!0)*1e3).toFixed(0));break}$(t).children("span").text(s)})},setSize(e){switch(n.mech.size=e,e==="collector"?n.mech.hardpoint.length=0:e==="small"||e==="medium"||e==="minion"||e==="fiend"?(n.mech.hardpoint.length===0&&n.mech.hardpoint.push("laser"),n.mech.hardpoint.length=1):(n.mech.hardpoint.length===0&&n.mech.hardpoint.push("laser"),n.mech.hardpoint.length===1&&n.mech.hardpoint.push(n.mech.hardpoint.includes("laser")?"plasma":"laser"),e==="titan"?n.mech.hardpoint.length===2&&(n.mech.hardpoint.push(n.mech.hardpoint.includes("laser")?"shotgun":"laser"),n.mech.hardpoint.push(n.mech.hardpoint.includes("laser")?"kinetic":"laser")):n.mech.hardpoint.length=2),n.config.warlord&&(n.mech.equip[0]=I(e,n.mech.chassis)[0],n.mech.equip.length=1),e){case"small":case"minion":n.config.prepared&&n.mech.equip.push(I(e,n.mech.chassis)[0]),n.mech.equip.length=n.config.prepared?1:0;break;case"medium":case"fiend":n.mech.equip.length<1&&n.mech.equip.push(I(e,n.mech.chassis)[0]),n.config.prepared&&n.mech.equip.push(I(e,n.mech.chassis)[1]),n.mech.equip.length=n.config.prepared?2:1;break;case"collector":case"large":case"cyberdemon":n.mech.equip.length<1&&n.mech.equip.push("special"),n.mech.equip.length<2&&n.mech.equip.push("shields"),n.config.prepared&&n.mech.equip.push("grapple"),n.mech.equip.length=n.config.prepared?3:2;break;case"titan":case"archfiend":n.mech.equip.length<1&&n.mech.equip.push(I(e,n.mech.chassis)[0]),n.mech.equip.length<2&&n.mech.equip.push(I(e,n.mech.chassis)[1]),n.mech.equip.length<3&&n.mech.equip.push(I(e,n.mech.chassis)[2]),n.mech.equip.length<4&&n.mech.equip.push(I(e,n.mech.chassis)[3]),n.config.prepared&&n.mech.equip.push(I(e,n.mech.chassis)[4]),n.mech.equip.length=n.config.prepared?5:4;break}if(n.config.warlord){switch(e){case"minion":n.mech.chassis="imp";break;case"fiend":n.mech.chassis="cambion";break;case"cyberdemon":n.mech.chassis="biped",n.mech.hardpoint[1]=A(e,n.mech.chassis,1)[1];break;case"archfiend":n.mech.chassis="dragon",n.mech.hardpoint[1]=A(e,n.mech.chassis,1)[0];break}n.mech.hardpoint[0]=A(e,n.mech.chassis,0)[0]}$("#cMechSize").val(e).text(b(`portal_mech_size_${e}`)),h.dispatchEvent(h.EV_CONSTRUCTOR)},setType(e){n.mech.chassis=e,n.config.warlord&&(n.mech.hardpoint[0]=A(n.mech.size,e,0)[0],e==="hydra"?(n.mech.hardpoint[1]=A(n.mech.size,e,1)[0],n.mech.hardpoint[2]=A(n.mech.size,e,2)[0],n.mech.hardpoint[3]=A(n.mech.size,e,3)[0]):e!=="hydra"&&n.mech.size.size==="archfiend"&&(n.mech.hardpoint.length=2)),$("#cMechChassis").val(e).text(b(`portal_mech_chassis_${e}`)).attr("data-val",e),h.dispatchEvent(h.EV_CONSTRUCTOR)},setWeapon(e,t){n.mech.hardpoint[t]=e,$($(".cMechWeapon").get(t)).val(e).text(b(`portal_mech_weapon_${e}`)),h.dispatchEvent(h.EV_CONSTRUCTOR)},setEquip(e,t){n.mech.equip[t]=e;let s=n.filterEquip(n.mech.size,e);$($(".cMechEquip").get(t)).val(e).text(b(`portal_mech_equip_${s}`)).attr("data-val",e),h.dispatchEvent(h.EV_CONSTRUCTOR)},vis(e){if(n.mech.size==="collector")return!1;if(e===0||["large","cyberdemon"].includes(n.mech.size)&&e<2||n.mech.size==="titan")return!0;if(n.mech.size==="archfiend")switch(n.mech.chassis){case"dragon":case"snake":case"gorgon":return e<2;case"hydra":return e<4}return!1},eqVis(e){let t=n.config.prepared?1:0;switch(n.mech.size){case"small":case"minion":return t===1&&e===0;case"medium":case"fiend":return e<=0+t;case"collector":case"large":case"cyberdemon":return e<=1+t;case"titan":case"archfiend":return!0}},filterEquip(e,t){let s=t;if(t==="special")switch(e){case"large":case"cyberdemon":s="battery";break;case"titan":s="target";break;default:s="jumpjet";break}return s},setWarlord(e){n.config.warlord=e,n.draw()},setPrepared(e){n.config.prepared=e,n.setSize(n.mech.size),n.draw()},setInfernal(e){n.mech.infernal=e===!0,$("#cMechInfernal").text(n.mech.infernal?"\u2714":"\u{1F7AD}").parent().toggleClass("faded",!n.mech.infernal),n.calc(),h.dispatchEvent(h.EV_CONSTRUCTOR)},save(){n.callbacks.saveMech&&n.callbacks.saveMech(structuredClone(n.mech))}};function ot(e){let t=x.mech.type.standard;if(n.config.warlord)switch(e.size){case"minion":t=x.mech.type.minion;break;case"fiend":t=x.mech.type.fiend;break;case"cyberdemon":t=x.mech.type.cyberdemon;break;case"archfiend":t=x.mech.type.archfiend;break}return t}function zt(){let e={size:"",hardpoint:[],chassis:"",equip:[],infernal:!1},t={size:"",hardpoint:[],chassis:"",equip:[],infernal:!1},s={size:"",hardpoint:[],chassis:"",equip:[],infernal:!1},a={size:"",hardpoint:[],chassis:"",equip:[""],infernal:!1},l=x.mech.size.standard.concat(x.mech.size.warlord),o=[...new Set([...x.mech.type.standard,...x.mech.type.minion,...x.mech.type.fiend,...x.mech.type.cyberdemon,...x.mech.type.archfiend])],p=x.mech.equip.standard.concat(x.mech.equip.warlord),d=x.spire.hazards.slice(),m={};return d.forEach(u=>{let f={size:{},chassis:{},equip:{}};switch(u){case"gravity":l.forEach(v=>{t.size=v;let g=D(e,u)-D(t,u);g!=0&&(f.size[v]=g)});case"windy":case"hilly":case"river":case"tar":case"flooded":case"chasm":o.forEach(v=>{s.chassis=v;let g=D(e,u)-D(s,u);g!=0&&(f.chassis[v]=g)});default:p.forEach(v=>{let g=0;switch(v){case"athletic":a.equip[0]=v,a.size=e.size="medium",g=D(e,u)-D(a,u),a.size=e.size="";break;default:a.equip[0]=v,g=D(e,u)-D(a,u);break}g!=0&&(f.equip[v]=g)});break}m[u]=f}),m}var $e=["error","error","error","error","error","warning","warning","warning","success","success"],X=["error","error","error","error","error","warning","warning","warning","warning","success"];var H=4,Ve=16,Tt=["e","t"],i={initialized:!1,running:!1,avgResults:0,workers:[],workersDone:0,involvedWorkers:H,progress:0,grapher:{},medianGrapher:{},summarizer:{},pages:0,sims:[],currentSim:-1,runningSim:-1,currentInsight:-1,insightLock:!1,canvas:{e:{c:{},b:{}},t:{c:{},b:{}},emed:{c:{},b:{}},tmed:{c:{},b:{}}},bucketHighlight:{},init(){i.grapher=new xe,i.canvas.e.c=i.grapher.createCanvas(),i.canvas.t.c=i.grapher.createCanvas(),i.medianGrapher=new xe(193,24,{t:0,r:0,b:0,l:0}),i.canvas.emed.c=i.medianGrapher.createCanvas(),i.canvas.tmed.c=i.medianGrapher.createCanvas(),i.medianGrapher.baseFill="#99999940",i.canvas.e.c.setAttribute("aria-label","Efficiency graph"),i.canvas.t.c.setAttribute("aria-label","Time graph"),i.canvas.emed.c.setAttribute("title","Approximate efficiency distribution"),i.canvas.tmed.c.setAttribute("title","Approximate completion time distribution"),i.summarizer=new We([i.canvas.e.c,i.canvas.t.c],[i.canvas.emed.c,i.canvas.tmed.c]),i.bucketHighlight=$(i.summarizer.highlight),$(i.summarizer.canvasDiv).on("mousemove",function(e){if(i.insightLock)return;let t=i.canvas.e.c.offsetWidth/i.grapher.width;if(t<=0)return;let s=e.offsetX/t;if(!(!i.initialized||i.currentSim<0))if(s>i.grapher.rect.l&&s<i.grapher.rect.r){let a=s-i.grapher.rect.l,l=Math.floor(a/i.grapher.bWidth);i.bucketHighlight.show(),i.bucketHighlight.css("left",t*(l*i.grapher.bWidth+i.grapher.rect.l)),i.bucketHighlight.css("width",t*Math.max(i.grapher.bWidth-1,1)),i.insightBucket(l)}else i.bucketHighlight.hide(),i.insightBucket(-1)}),$(i.summarizer.canvasDiv).on("mouseleave",function(e){i.insightLock||(i.bucketHighlight.hide(),i.insightBucket(-1))}),$(i.summarizer.canvasDiv).on("click",function(e){let t=i.canvas.e.c.offsetWidth/i.grapher.width;if(t<=0)return;let s=e.offsetX/t;if(!(!i.initialized||i.currentSim<0)&&s>i.grapher.rect.l&&s<i.grapher.rect.r){e.stopPropagation();let a=s-i.grapher.rect.l,l=Math.floor(a/i.grapher.bWidth);l==i.currentInsight&&i.insightLock?i.unlockInsight():(i.bucketHighlight.toggleClass("locked",!0),i.bucketHighlight.show(),i.bucketHighlight.css("left",t*(l*i.grapher.bWidth+i.grapher.rect.l)),i.bucketHighlight.css("width",t*Math.max(i.grapher.bWidth-1,1)),i.insightBucket(l),i.lockInsight(l))}}),h.on(h.EV_CLOSE_DROPDOWNS,i.unlockInsight),i.initialized=!0},sim(e,t=!1){if(!i.initialized)return;if(i.running){i.running=!1;for(var s=0;s<i.workers.length;s++)i.workers[s].postMessage({a:"stop"});$("#avgDoIt").text("Do it!");return}else $("#avgDoIt").text("Stop"),i.running=!0;i.avgResults=0,i.workersDone=0,i.progress=0,$("#simProgress").val(0);let a=t&&r.eden?.mech_station?.mechs||0,l=parseInt($("#avgStart").val())||1,o=parseInt($("#avgLength").val())||10,p=parseInt($("#avgRepeats").val())||10,d=`${c.getCurrent().name} [${l} + ${o} --> ${l+o}] x ${p}`,m=`${e.length} mech${e.length>1&&e.length%100!=11&&e.length%10!=1?"s":""}${a>0?` (-${a} in ${b("tab_eden")})`:""}`,u=$("#avgPrecise").get(0)?.checked||h.config.preciseMedians;H=parseInt($("#avgThreads").val())||4,H=Math.max(1,Math.min(Ve,H)),i.sims.length==0||i.runningSim<0?(i.addSim(new Se(l,o,p,d,m,u)),i.runningSim=i.sims.length-1,$("#avgCalcPageContainer").append(i.summarizer.dom)):(i.runningSim=i.currentSim,i.sims[i.runningSim].init(l,o,p,d,m,u)),i.grapher.clear(i.canvas.e),i.grapher.clear(i.canvas.t),i.medianGrapher.clear(i.canvas.emed),i.medianGrapher.clear(i.canvas.tmed);for(let g in i.canvas)i.canvas[g].b=new P,i.canvas[g].b.min=0,i.canvas[g].b.max=1;i.showSim(i.runningSim),i.setupWorkers();let f=1,v=0;p>i.workers.length&&(f=Math.floor(p/i.workers.length),v=p%i.workers.length),i.involvedWorkers=Math.min(p,i.workers.length),i.sims[i.runningSim].time.gathering=performance.now();for(var s=0;s<i.involvedWorkers;s++)i.workers[s].postMessage({a:"start",wId:s,mechs:e,global:r,edenTax:a,precise:u,start:l,length:o,repeats:f+(s<v?1:0)})},setupWorkers(){if(i.workers.length<H)for(var e=i.workers.length;e<H;e++)i.workers.push(new Worker(new URL("mechaveragerun.worker.js",import.meta.url),{type:"module"})),i.workers[e].onmessage=i.handleWorkerMessage;else if(i.workers.length>H){for(var e=H;e<i.workers.length;e++)i.workers[e].terminate();i.workers.splice(H)}},handleWorkerMessage(e){switch(e.data.a){case"result":i.sims[i.runningSim].addData(parseInt(e.data.f),e.data.e,e.data.t,e.data.slow,e.data.raw);let t=parseInt(e.data.f)-i.sims[i.runningSim].start,s=i.sims[i.runningSim].repeats>i.workers.length?i.sims[i.runningSim].repeats%i.workers.length:0,a=i.sims[i.runningSim].buckets.n[t]%i.involvedWorkers==0;s>0&&(a=a||i.sims[i.runningSim].buckets.n[t]%i.involvedWorkers==s),a=a&&i.currentSim===i.runningSim,a&&(i.grapher.drawBucket(i.canvas.e,i.canvas.e.b,i.sims[i.runningSim],"e",t),i.grapher.drawBucket(i.canvas.t,i.canvas.t.b,i.sims[i.runningSim],"t",t)),i.avgResults++;break;case"progress":i.workers[e.data.w].progress=e.data.progress;let l=e.data.progress;for(let o of i.workers)o.progress&&o.progress<l&&(l=o.progress);l>i.progress&&(i.progress=l),$("#simProgress").val(i.progress*100);break;case"done":i.workersDone++,i.workersDone==i.involvedWorkers&&(i.sims[i.runningSim].finalizeResults(),i.showSim(i.runningSim),i.running=!1,$("#avgDoIt").text("Do it!"));break;case"error":switch(e.data.error){case"no_mechs":i.sims[i.runningSim].descriptor="Where are the mechs?",E("info","Where are the mechs?","sim_no_mechs");break;case"mechs_busy":i.sims[i.runningSim].descriptor=`All mechs are busy in ${b("tab_eden")}`,E("info",`All mechs are busy in ${b("tab_eden")}`,"sim_eden");break}i.running=!1,$("#avgDoIt").text("Do it!"),i.summarizer.summarize(i.sims[i.runningSim]),i.summarizer.clear();break;default:break}},showSim(e){if(i.unlockInsight(),e=="i"){$("#avgCalcInfo").show();let t=$("#avgCalcPager");t.find(".current").removeClass("current"),t.find(`[data-val="${e}"]`).addClass("current"),$(i.summarizer.dom).hide()}else if(Number.isInteger(e)){let t=$("#avgCalcPager");t.show(),$("#avgCalcInfo").hide(),$(i.summarizer.dom).show(),i.currentSim=e%i.sims.length,t.find(".current").removeClass("current"),t.find(`[data-val="${e}"]`).addClass("current"),i.summarizer.summarize(i.sims[i.currentSim]),i.grapher.draw(i.canvas.e,i.sims[i.currentSim],"e"),i.grapher.draw(i.canvas.t,i.sims[i.currentSim],"t"),i.sims[i.currentSim].done?(i.medianGrapher.drawMedians(i.canvas.emed.c,i.sims[i.currentSim].bounds.emed,"e",i.sims[i.currentSim].medians.e),i.medianGrapher.drawMedians(i.canvas.tmed.c,i.sims[i.currentSim].bounds.tmed,"t",i.sims[i.currentSim].medians.t)):(i.medianGrapher.clear(i.canvas.emed),i.medianGrapher.clear(i.canvas.tmed))}},addSim(e){let t=$($("#avgCalcPager").children("div").get(0)),s=4;if(i.pages==0&&(t.append($('<a data-val="i" class="clickable"><svg class="bi" width="1.1em" height="1.1em" fill="currentColor"><use xlink:href="/icons/icons.svg#info-square-fill"/></svg></a>').on("click",a=>{i.showSim("i")})),t.append($('<a id="addSimTab" class="clickable">&nbsp;+&nbsp;</a>').on("click",a=>{i.addSim()&&i.showSim(i.pages-1)}))),i.pages<s){let a=t.children("#addSimTab");i.pages==s-1&&a.hide(),a.before($(`<a data-val="${i.pages}" class="clickable"><svg class="bi" width="1.1em" height="1.1em" fill="currentColor"><use xlink:href="/icons/icons.svg#bar-chart-fill"/></svg></a>`).on("click",l=>{l.target?.dataset?.val>=0&&i.showSim(parseInt(l.target.dataset.val))})),i.sims.push(e===void 0?new Se(1,0,0,"","Start a new calculation",!1):e),i.currentSim=i.sims.length-1,i.pages++}else return!1;return!0},insightBucket(e){e!=i.currentInsight&&(i.currentInsight=e,!(i.sims.length==0||i.currentSim<0)&&(e<0||e>=i.sims[i.currentSim].nBuckets?(i.sims[i.currentSim].done&&(i.sims[i.currentSim].bounds.tmed.min=i.sims[i.currentSim].medians.t[0],i.sims[i.currentSim].bounds.tmed.max=i.sims[i.currentSim].medians.t[i.sims[i.currentSim].medians.t.length-1],i.medianGrapher.drawMedians(i.canvas.emed.c,i.sims[i.currentSim].bounds.emed,"e",i.sims[i.currentSim].medians.e),i.medianGrapher.drawMedians(i.canvas.tmed.c,i.sims[i.currentSim].bounds.tmed,"t",i.sims[i.currentSim].medians.t)),i.summarizer.summarize(i.sims[i.currentSim])):(i.sims[i.currentSim].done&&i.sims[i.currentSim].precise&&i.sims[i.currentSim].buckets.t[e].med.length>0&&(i.sims[i.currentSim].bounds.tmed.min=i.sims[i.currentSim].buckets.t[e].med[0],i.sims[i.currentSim].bounds.tmed.max=i.sims[i.currentSim].buckets.t[e].med[i.sims[i.currentSim].buckets.t[e].med.length-1],i.medianGrapher.drawMedians(i.canvas.emed.c,i.sims[i.currentSim].bounds.emed,"e",i.sims[i.currentSim].buckets.e[e].med),i.medianGrapher.drawMedians(i.canvas.tmed.c,i.sims[i.currentSim].bounds.tmed,"t",i.sims[i.currentSim].buckets.t[e].med)),i.summarizer.summarize(i.sims[i.currentSim],e))))},lockInsight(e){i.insightLock=!0},unlockInsight(){i.insightLock=!1,i.bucketHighlight.hide(),i.bucketHighlight.removeClass("locked"),i.insightBucket(-1)},loadUpFloorum(e){if(!(i.sims.length==0||i.currentSim<0)&&e.currentTarget?.dataset?.bucket&&i.currentSim>=0&&e.currentTarget?.dataset?.key){let t=e.currentTarget.dataset.bucket;if(t>=i.sims[i.currentSim].nBuckets)return;let s=e.currentTarget.dataset.key;ct(t<0?i.sims[i.currentSim].totals.slowest[s]:i.sims[i.currentSim].slowest[s][t])}}},U={graphBase:"#555",graphBlue:"#0095DD",graphError:"#DD000090"},xe=class{constructor(t=560,s=140,a={t:10,r:10,b:10,l:10}){K(this,"bWidth",3);this.width=t,this.height=s,this.padding=a,this.rect={t:this.padding.t,r:this.width-this.padding.r,b:this.height-this.padding.b,l:this.padding.l};let l=document.createElement("canvas").getContext("2d");this.baseFill=U.graphBase,this.errorFill=U.graphError,this.warningGradient=l.createLinearGradient(0,0,0,this.height),this.warningGradient.addColorStop(0,U.graphBase),this.warningGradient.addColorStop(.8,U.graphBase),this.warningGradient.addColorStop(1,"#ED6500"),this.errorGradient=l.createLinearGradient(0,0,0,this.height),this.errorGradient.addColorStop(0,U.graphBase),this.errorGradient.addColorStop(.8,U.graphBase),this.errorGradient.addColorStop(1,"#ED0000"),this.longGradient=l.createLinearGradient(0,0,0,this.height),this.longGradient.addColorStop(0,"#ED000040"),this.longGradient.addColorStop(.1,U.graphBase),this.highGradient=l.createLinearGradient(0,0,0,this.height),this.highGradient.addColorStop(0,"#95DD0080"),this.highGradient.addColorStop(.1,U.graphBase)}createCanvas(){let t=document.createElement("canvas");return t.height=this.height,t.width=this.width,t}draw(t,s,a){let l=t.c.getContext("2d");this.clear(l);let o=1;s.nBuckets>this.width-this.padding.l-this.padding.r&&(o=Math.floor(s.nBuckets/(this.width-this.padding.l-this.padding.r)));for(var p=0;p<s.nBuckets;p=p+o)s.buckets.n[p]>0&&this.drawBucket(l,t.b,s,a,p)}drawBucket(t,s,a,l,o){let p=t instanceof CanvasRenderingContext2D?t:t.c.getContext("2d"),d=!1;switch(this.bWidth=(this.width-this.padding.l-this.padding.r)/a.nBuckets,this.width-this.padding.l-this.padding.r>=a.nBuckets&&(this.bWidth=Math.floor(this.bWidth)),l){case"t":s.min!=a.bounds[l].min&&(d=!0),s.max!=a.bounds[l].max&&(d=!0);break}if(s.min=a.bounds[l].min,s.max=a.bounds[l].max,this.rect.l=this.padding.l+Math.floor((this.width-this.padding.l-this.padding.r-this.bWidth*a.nBuckets)/2),this.rect.r=this.width-this.rect.l,d)for(var m=0;m<o;m++)this.strokeBucket(p,a.bounds[l],l,m,a.buckets[l][m]);this.strokeBucket(p,a.bounds[l],l,o,a.buckets[l][o])}clear(t){(t instanceof CanvasRenderingContext2D?t:t.c.getContext("2d")).clearRect(0,0,this.width,this.height)}strokeBucket(t,s,a,l,o){t.clearRect(this.bWidth*l+this.rect.l,0,this.bWidth,this.height);let p=o.max;a=="t"&&o.max==-1&&(p=s.max*1.2);let d=Math.max(this.bWidth-1,1);t.fillStyle=this.baseFill;let m=Math.round(N(this.rect.t,this.rect.b,1-G(s.min,s.max,p))),u=Math.round(N(this.rect.t,this.rect.b,1-G(s.min,s.max,o.min)));o.min==0?t.fillStyle=this.errorFill:o.min<.009?t.fillStyle=this.errorGradient:o.min<.05?t.fillStyle=this.warningGradient:p>s.max&&(t.fillStyle=a=="t"?this.longGradient:this.highGradient),t.fillRect(this.bWidth*l+this.rect.l,m,d,u-m),p>s.max&&t.clearRect(this.bWidth*l+this.rect.l,this.rect.t+4,d,2);let f=Array.isArray(o.med)?Z(o.med):o.med,v=Math.round(N(this.rect.t,this.rect.b,1-G(s.min,s.max,o.avg))),g=Math.round(N(this.rect.t,this.rect.b,1-G(s.min,s.max,f))),S=v,w=Math.max(Math.abs(v-g),2);v>=g?S=g:w=Math.max(Math.abs(g-v),2),(a=="t"?-1:1)*(v-g)<0?t.fillStyle="#DD9500":t.fillStyle="#95DD00",t.fillRect(this.bWidth*l+this.rect.l,S-1,d,w)}drawMedians(t,s,a,l){let o=t.getContext("2d");if(this.clear(o),o.beginPath(),o.moveTo(this.rect.l,this.rect.b),l.length<this.rect.r-this.rect.l)for(var p=0;p<l.length;p++){let m=N(this.rect.l,this.rect.r,G(0,l.length-1,p)),u=Math.round(N(this.rect.t,this.rect.b,1-G(s.min,s.max,l[p])));o.lineTo(m,u)}else for(var p=0;p<=this.rect.r-this.rect.l;p++){let u=p+this.rect.l,f=Math.floor(N(0,l.length-1,G(this.rect.l,this.rect.r,u))),v=Math.round(N(this.rect.t,this.rect.b,1-G(s.min,s.max,l[f])));o.lineTo(u,v)}o.lineTo(this.rect.r,Math.round(N(this.rect.t,this.rect.b,1-G(s.min,s.max,l[l.length-1])))),o.lineTo(this.rect.r,this.rect.b),o.closePath(),o.fillStyle=this.baseFill,o.fill();let d=Math.floor(this.rect.l+(this.rect.r-this.rect.l)/2);o.beginPath(),o.moveTo(d,this.rect.b-5),o.lineTo(d-5,this.rect.b),o.lineTo(d+5,this.rect.b),o.lineTo(d,this.rect.b-5),o.closePath(),o.fillStyle=U.graphBlue,o.fill()}},Se=class{constructor(t,s,a,l,o,p){this.start=t||1,this.length=s||1,this.repeats=a||1,this.label=l||"",this.descriptor=o||"",this.precise=p||!1,this.done=!1,this.buckets={n:[],e:[],t:[]},this.medians={e:[],t:[]},this.slowest={e:[],t:[]},this.bounds={e:{},t:{},emed:{},tmed:{}},this.nBuckets=s,Object.keys(this.buckets).forEach(function(m){this.buckets[m].length=this.nBuckets},this),Object.keys(this.slowest).forEach(function(m){this.slowest[m].length=this.nBuckets},this),Object.keys(this.bounds).forEach(function(m){this.bounds[m]=new P,this.bounds[m].min=0,this.bounds[m].max=1},this),this.buckets.n.fill(0);for(var d=0;d<this.nBuckets;d++)this.buckets.e[d]=new P,this.buckets.t[d]=new P,this.buckets.e[d].med=[],this.buckets.t[d].med=[],this.slowest.e[d]=new B(0,0,0,null),this.slowest.t[d]=new B(0,0,0,null);this.totals={n:0,e:new P,t:new P,slowest:{e:new B,t:new B}},this.time={gathering:0,finalizing:0}}init(t,s,a,l,o,p){this.start=t,this.length=s,this.repeats=a,this.label=l,this.descriptor=o,this.precise=p,this.done=!1,this.nBuckets=s,Object.keys(this.buckets).forEach(function(m){this.buckets[m].length=this.nBuckets},this),Object.keys(this.slowest).forEach(function(m){this.slowest[m].length=this.nBuckets},this),Object.keys(this.bounds).forEach(function(m){this.bounds[m].min=0,this.bounds[m].max=1},this),this.buckets.n.fill(0),this.medians.e=[],this.medians.t=[],this.slowest.e=[],this.slowest.t=[];for(var d=0;d<this.nBuckets;d++)this.buckets.e[d]=new P,this.buckets.t[d]=new P,this.buckets.e[d].med=[],this.buckets.t[d].med=[],this.slowest.e[d]=new B(0,0,0,null),this.slowest.t[d]=new B(0,0,0,null);this.totals.n=0,this.totals.e=new P,this.totals.t=new P,this.totals.slowest.e=new B,this.totals.slowest.t=new B,this.time.gathering=0,this.time.finalizing=0}addData(t,s,a,l,o=null){t-=this.start,!(t<0||t>=this.nBuckets)&&(this.buckets.e[t].min>s.min&&(this.slowest.e[t]=l.e),this.buckets.e[t].min=this.buckets.e[t].min>s.min?s.min:this.buckets.e[t].min,this.buckets.e[t].max=this.buckets.e[t].max<s.max?s.max:this.buckets.e[t].max,this.buckets.e[t].avg=(s.avg+this.buckets.n[t]*this.buckets.e[t].avg)/(this.buckets.n[t]+1),a.max==-1&&(this.buckets.t[t].max=-1,this.slowest.t[t]=l.t),this.buckets.t[t].max!==-1&&this.buckets.t[t].max<a.max&&(this.slowest.t[t]=l.t),this.buckets.t[t].min=this.buckets.t[t].min>a.min?a.min:this.buckets.t[t].min,this.buckets.t[t].max=this.buckets.t[t].max!==-1&&this.buckets.t[t].max<a.max?a.max:this.buckets.t[t].max,this.buckets.t[t].avg=(a.avg+this.buckets.n[t]*this.buckets.t[t].avg)/(this.buckets.n[t]+1),this.precise&&o?(this.buckets.e[t].med.push(...o.e),this.buckets.t[t].med.push(...o.t),this.medians.e.push(...o.e),this.medians.t.push(...o.t)):(this.buckets.e[t].med.push(...Array.isArray(s.med)?s.med:[s.med]),this.buckets.t[t].med.push(...Array.isArray(a.med)?a.med:[a.med]),this.medians.e.push(...Array.isArray(s.med)?s.med:[s.med]),this.medians.t.push(...Array.isArray(a.med)?a.med:[a.med])),this.buckets.e[t].med.sort(se),this.buckets.t[t].med.sort(se),this.buckets.n[t]++,this.bounds.t.min>this.buckets.t[t].min&&(this.bounds.t.min=this.buckets.t[t].min),this.bounds.t.max<this.buckets.t[t].max&&this.buckets.t[t].max/this.buckets.t[t].avg<5?this.bounds.t.max=this.buckets.t[t].max:this.bounds.t.max<this.buckets.t[t].avg?this.bounds.t.max=this.buckets.t[t].avg:this.bounds.t.max<Z(this.buckets.t[t].med)&&(this.bounds.t.max=Z(this.buckets.t[t].med)))}finalizeResults(){let t=performance.now();this.time.gathering=t-this.time.gathering;let s=!1,a=be.bind(50);for(var l=0;l<this.nBuckets;l++)this.buckets.n[l]!=0&&(this.totals.slowest.e=this.totals.e.min>this.buckets.e[l].min?this.slowest.e[l]:this.totals.slowest.e,this.totals.e.min=this.totals.e.min>this.buckets.e[l].min?this.buckets.e[l].min:this.totals.e.min,this.totals.e.max=this.totals.e.max<this.buckets.e[l].max?this.buckets.e[l].max:this.totals.e.max,this.totals.slowest.t=this.totals.t.max<this.buckets.t[l].max?this.slowest.t[l]:this.totals.slowest.t,this.totals.t.min=this.totals.t.min>this.buckets.t[l].min&&this.buckets.t[l].min>0?this.buckets.t[l].min:this.totals.t.min,this.totals.t.max=this.totals.t.max<this.buckets.t[l].max?this.buckets.t[l].max:this.totals.t.max,this.buckets.t[l].min!==0&&(s=!0),Tt.forEach(function(o){this.totals[o].avg=(this.buckets[o][l].avg+l*this.totals[o].avg)/(l+1),this.buckets[o][l].med.sort(se),this.buckets[o][l].med.length>50&&(this.buckets[o][l].med=this.buckets[o][l].med.filter(a))},this),this.totals.n+=this.buckets.n[l]);this.medians.e.sort(se),this.medians.t.sort(se),this.totals.e.med=Z(this.medians.e),this.totals.t.med=Z(this.medians.t),this.medians.e.length>200&&(this.medians.e=this.medians.e.filter(be),this.medians.t=this.medians.t.filter(be)),this.bounds.emed.min=0,this.bounds.emed.max=Math.max(1,this.medians.e[this.medians.e.length-1]),this.bounds.tmed.min=this.medians.t[0],this.bounds.tmed.max=this.medians.t[this.medians.t.length-1],this.normals={e:i.canvas.e.b,t:i.canvas.t.b,emed:i.canvas.emed.b,tmed:i.canvas.tmed.b},this.time.finalizing=performance.now()-t,this.done=!0}},We=class{constructor(t,s){this.noDataBucket=new P,Object.keys(this.noDataBucket).forEach(function(p){this.noDataBucket[p]=0},this),this.noDataBucket.med=[],this.dom=document.createElement("div"),this.dom.id="avgSummary-",this.dom.className="avgSummary",this.dom.style="display: none",this.labelDiv=document.createElement("div"),this.labelDiv.className="co0 title",this.label=document.createElement("h3"),this.descriptor=document.createElement("p"),this.labelDiv.appendChild(this.label),this.labelDiv.appendChild(this.descriptor),this.dom.appendChild(this.labelDiv),this.statDiv=document.createElement("div"),this.statDiv.className="co0 breakdown",this.dom.appendChild(this.statDiv),this.canvasDiv=document.createElement("div"),this.canvasDiv.className="co1 canvas",this.dom.appendChild(this.canvasDiv),this.highlight=document.createElement("div"),this.highlight.id="bucketHighlight",this.highlight.style="pointer-events: none; display: none",this.canvasDiv.appendChild(this.highlight);for(let p of t)this.canvasDiv.appendChild(p);this.grid={e:{},t:{}};let a=document.createElement("div");a.className="co0 header",a.appendChild(s[0]),a.appendChild(document.createTextNode("Efficiency")),this.statDiv.appendChild(a),Object.keys(new P).forEach(function(p,d){let m=document.createElement("div");m.className="co0",m.appendChild(document.createTextNode(`${p}:`));let u=document.createElement("div");u.className="co1",this.grid.e[p]=u,this.statDiv.appendChild(m),this.statDiv.appendChild(u)},this),this.bHeader=document.createElement("div"),this.bHeader.className="co0 bucket",this.bHeader.appendChild(document.createTextNode("Total"));let l=document.createElement("div");l.className="co0 header",l.appendChild(s[1]),l.appendChild(document.createTextNode("Time")),this.statDiv.appendChild(this.bHeader),this.statDiv.appendChild(l),Object.keys(new P).forEach(function(p,d){let m=document.createElement("div");m.className="co0",m.appendChild(document.createTextNode(`${p}:`));let u=document.createElement("div");u.className="co1",this.grid.t[p]=u,this.statDiv.appendChild(m),this.statDiv.appendChild(u)},this),this.slowest=[],this.slowestDiv=document.createElement("div"),this.slowestDiv.className="co0 footer slowest",this.dom.appendChild(this.slowestDiv);let o=document.createElement("span");o.className="label",o.appendChild(document.createTextNode("Slowest floor:")),this.slowestDiv.appendChild(o);for(let p=0;p<2;p++){this.slowest.push(document.createElement("div")),this.slowest[p].className="blockContainer",this.slowestDiv.appendChild(this.slowest[p]),this.slowest[p].col=[];for(let d=0;d<5+h.maxStatus;d++){let m=document.createElement(d==2?"button":"span");if(m.className=`floor co${d}`,this.slowest[p].col.push(m),d==3){let u=document.createElement("div");u.className="emannuelWrap",this.slowest[p].appendChild(u)}this.slowest[p].appendChild(m)}this.slowest[p].col[2].textContent="\u{1F845}",this.slowest[p].col[2].classList.add("spanImpostor"),this.slowest[p].col[2].title="Load up floor config into cheat sheet",this.slowest[p].col[2].dataset.key=p==0?"e":"t",this.slowest[p].col[2].addEventListener("click",i.loadUpFloorum)}this.summary=document.createElement("div"),this.summary.className="co0 footer",this.dom.appendChild(this.summary),this.footers=[];for(let p=0;p<2;p++)this.footers.push(document.createElement("span")),this.summary.appendChild(this.footers[p]);this.footers[1].className="notImportant"}clear(){Object.keys(this.grid.e).forEach(function(t,s){this.grid.e[t].textContent="-",this.grid.t[t].textContent="-",t=="min"&&(this.grid.e[t].classList.remove("error"),this.grid.e[t].classList.remove("warning")),t=="max"&&this.grid.t[t].classList.remove("error")},this)}summarize(t,s=-1){if(this.label.textContent=t.label,this.descriptor.textContent=t.done?t.descriptor+" | Done \u2714":t.descriptor,this.footers[0].textContent="\xA0",this.footers[1].textContent="\xA0",this.slowestDiv.style="display: none",t.done){let a,l;s>=0&&s<t.nBuckets?(this.bHeader.textContent=`Floor [${t.start+s}]`,t.buckets.n[s]>0?(a=t.buckets.e[s],l=t.buckets.t[s]):(a=this.noDataBucket,l=this.noDataBucket)):(this.bHeader.textContent="Total",a=t.totals.e,l=t.totals.t),Object.keys(t.totals.e).forEach(function(o,p){o=="med"?(this.grid.e[o].textContent=((Array.isArray(a[o])?Z(a[o]):a[o])*100).toFixed(2)+"%",this.grid.t[o].textContent=O(Array.isArray(l[o])?Z(l[o]):l[o])):(this.grid.e[o].textContent=(a[o]*100).toFixed(2)+"%",this.grid.t[o].textContent=O(l[o])),o=="min"&&(a[o]==0?(this.grid.e[o].classList.remove("warning"),this.grid.e[o].classList.add("error")):a[o]<.009?(a[o]<1e-4&&(this.grid.e[o].textContent=(a[o]*100).toFixed(5)+"%"),this.grid.e[o].classList.remove("error"),this.grid.e[o].classList.add("warning")):(this.grid.e[o].classList.remove("error"),this.grid.e[o].classList.remove("warning"))),o=="max"&&(l[o]==-1?this.grid.t[o].classList.add("error"):this.grid.t[o].classList.remove("error"))},this)}else s==-1&&Object.keys(t.totals.e).forEach(function(a,l){this.grid.e[a].textContent="-",this.grid.t[a].textContent="-"},this);if(t.done){let a=t.time.gathering>1e3?O(t.time.gathering/1e3):`${Math.round(t.time.gathering)}ms`;this.footers[0].textContent=`Done! Average time per floor ${O(t.totals.t.avg)}`,this.footers[1].textContent=` | Gathering: ${a} | Finalizing: ${(Math.floor(t.time.finalizing*100)/100).toFixed(2)}ms`,this.slowestDiv.style=null,s>=0&&s<t.nBuckets&&t.buckets.n[s]>0?B.areEqual(t.slowest.e[s],t.slowest.t[s])?(this.summarizeSlowestFloor(this.slowest[0],t,s,t.slowest.e[s]),this.slowest[1].style="visibility: hidden"):(this.slowest[1].style=null,this.summarizeSlowestFloor(this.slowest[0],t,s,t.slowest.e[s],"e"),this.summarizeSlowestFloor(this.slowest[1],t,s,t.slowest.t[s],"t")):B.areEqual(t.totals.slowest.e,t.totals.slowest.t)?(this.summarizeSlowestFloor(this.slowest[0],t,s,t.totals.slowest.e),this.slowest[1].style="visibility: hidden"):(this.slowest[1].style=null,this.summarizeSlowestFloor(this.slowest[0],t,s,t.totals.slowest.e,"e"),this.summarizeSlowestFloor(this.slowest[1],t,s,t.totals.slowest.t,"t"))}}summarizeSlowestFloor(t,s,a,l,o=null){switch(t.col[0].textContent=`${l.count}`,o){case"e":t.col[1].textContent=`${(s.buckets.e[l.count-s.start].min*100).toFixed(2)}%`;break;case"t":t.col[1].textContent=`${O(s.buckets.t[l.count-s.start].max)}`;break;default:t.col[1].textContent=`${(s.buckets.e[l.count-s.start].min*100).toFixed(2)}% / ${O(s.buckets.t[l.count-s.start].max)}`}t.col[3].textContent=b(`portal_mech_boss_${l.boss}`),t.col[4].textContent=b(`portal_spire_type_${l.type}`),t.col[0].dataset.bucket=l.count-s.start,t.col[2].dataset.bucket=a,t.col[2].style=null;let p=Object.keys(l.status);for(var d=0;d<h.maxStatus;d++)d<p.length?(t.col[d+5].textContent=b(`portal_spire_status_${p[d]}`),t.col[d+5].style=null):(t.col[d+5].textContent="\xA0",t.col[d+5].style="visibility: hidden")}};var F;function _t(e){e.preventDefault(),setTimeout(()=>{i.sim(c.getCurrentList(),h.config.avgEdenTax&&c.getCurrent().key=="mechbay")},0)}function ht(){if($("#saveString").val().length>0){let e=$("#saveString").val();try{F=JSON.parse(LZString.decompressFromBase64(e))}catch{F=""}if(F){h.localStorage&&localStorage.setItem(h.LS_SString,e),Xe(structuredClone(F)),console.log(r);let t=$("#spireTerrain").val(),s=$("#spireBoss").val(),a=0;r.portal?.mechbay||(E("error","Mechbay was not found"),a++),r.portal?.spire?($("#spireTerrain").val(r.portal.spire.type).text(b(`portal_spire_type_${r.portal.spire.type}`)),$("#spireBoss").val(r.portal.spire.boss).text(b(`portal_mech_boss_${r.portal.spire.boss}`)),Te(r.portal.spire.type),_e(r.portal.spire.boss),C.update.terrain(),C.update.boss()):(E("error","Spire was not found"),a++,Pe(),r.blood.prepared=F.blood.prepared?F.blood.prepared:0,r.blood.wrath=F.blood.wrath?F.blood.wrath:0,r.stats.achieve.gladiator.l=F.stats.achieve.gladiator?.l?F.stats.achieve.gladiator.l:0,r.stats.reset=F.stats.reset?F.stats.reset:0,$("#spireTerrain").val(t).text(t?b(`portal_spire_type_${t}`):"\u{1F7AD}"),$("#spireBoss").val(s).text(s?b(`portal_mech_boss_${s}`):"\u{1F7AD}"),Te(t),_e(s)),Ge(-1,-1),C.update.spireCount(),$("#scouts").val(r.portal.mechbay.scouts?r.portal.mechbay.scouts:0),$("#prepared").val(r.blood.prepared?r.blood.prepared:0),$("#wrathlvl").val(r.blood.wrath?r.blood.wrath:0),$("#gladiatorlvl").val(r.stats.achieve.gladiator?.l?r.stats.achieve.gladiator.l:0),$("#resets").val(r.stats.reset?r.stats.reset:0),C.update.warlord(),C.update.prepared(),C.update.hazards(),_(),n.init(),n.drawBasicTable(),setTimeout(()=>{c.showPage(c.currentPage),R()&&(c.update(!0),$("#mechbaySpaceDenominator").text(ae()),n.calc())},0),a==0&&E("success","Import was successful")}else E("error","Invalid input string");F=null}else E("error","Input string is empty");C.update.calcEdenTax()}function ct(e){r.portal.spire.count=parseInt(e.count),Te(e.type),_e(e.boss),r.portal.spire.status=structuredClone(e.status),Ge(-1,-1),C.update.spireCount(),C.update.terrain(),C.update.boss(),C.update.hazards(),_(),n.draw(),n.drawBasicTable(),j()}function R(){return r&&r.portal?.spire&&r.portal.spire.type&&r.portal.spire.boss}function Mt(e){setTimeout(()=>{c.addMech(e),R()&&c.update(!0)},0)}function ze(e){setTimeout(t=>{c.update(e)},0)}function j(){if(!R()){ze(!1);return}$("#mechbaySpaceDenominator").text(ae()),n.calc(),ze(!0)}function Et(){ze(!1)}function Ce(){setTimeout(e=>{c.update(h.config.sortingType!=0),C.update.sorting()},0)}function Lt(){ze(h.config.sortingType!=0)}function ut(){$("#isVisible").parent().toggleClass("faded",h.config.pagerVisibility!=0);let e=c.isVisible;c.isVisible=h.config.pagerVisibility==0,c.isVisible?e||($("#mechLists").show(),setTimeout(()=>{c.showPage(c.currentPage),R()&&(c.update(!0),n.calc())},0)):($("#mechLists").hide(),setTimeout(c.hide,0))}function qt(){let e=$("#spireTerrain"),t=x.spire.terrain.slice(),s=$(e.next(".dropdownContent").get(0)),a="";t.sort(Bt).forEach(function(y){a+=`<a data-val="${y}">${b(`portal_spire_type_${y}`)}</a>`}),s.append($(a).on("click",Pt));let l=x.spire.hazards.slice();l.sort(It),$(".statusButton").next(".dropdownContent").each((y,T)=>{let Ue='<a data-val="" class="negative">\u{1F7AD}</a>';l.forEach(Je=>{Ue+=`<a data-val="${Je}">${b(`portal_spire_status_${Je}`)}</a>`}),$(T).append($(Ue).on("click",{index:y},Dt))});let o=$("#bossList"),p="";Object.keys(ee).sort(Nt).forEach(function(y){p+=`<a data-val="${y}">${b(`portal_mech_boss_${y}`)}</a>`}),o.append($(p).on("click",Ft));let d="",m=$("#truncateSelector"),u=$(m.next(".dropdownContent").get(0));Me.forEach(function(y,T){d+=`<a data-val="${T}">${y.full}</a>`,h.config.truncateWeapons==y.val&&m.text(y.short)}),u.append($(d).on("click",{optionList:Me,optionSelector:"#truncateSelector",optionConfig:"truncateWeapons",action:Et},re)),d="";let f=$("#sortingSelector"),v=$(f.next(".dropdownContent").get(0));Q.forEach(function(y,T){d+=`<a data-val="${T}">${y.full}</a>`,h.config.sortingType==y.val&&f.text(y.short)}),v.append($(d).on("click",{optionList:Q,optionSelector:"#sortingSelector",optionConfig:"sortingType",action:Ce},re)),$("#sortingDirection").on("click",y=>{let T=h.config.sortingDirection>0?0:1;y.currentTarget.dataset.val=T,y.data={optionList:ne,optionSelector:"#sortingDirection",optionConfig:"sortingDirection",action:Lt},re(y)}).text(ne[h.config.sortingDirection>0?1:0].short),d="";let S=$("#groupingSelector"),w=$(S.next(".dropdownContent").get(0));Ee.forEach(function(y,T){d+=`<a data-val="${T}">${y.full}</a>`,h.config.groupingType==y.val&&S.text(y.short)}),w.append($(d).on("click",{optionList:Ee,optionSelector:"#groupingSelector",optionConfig:"groupingType",action:Ce},re)),$("#visStyleSwitch").on("click",{optionList:ue,optionSelector:"#visStyleSwitch",optionConfig:"mathVisStyle",action:C.update.mathStyle},dt).html(ue[h.config.mathVisStyle].short),$("#isVisible").on("click",{optionList:Le,optionSelector:"#isVisible",optionConfig:"pagerVisibility",action:ut},dt).html(Le[h.config.pagerVisibility].short),$("#totalEffectHeader").attr("data-val",1).on("click",{optionList:Q,optionSelector:"#sortingSelector",optionConfig:"sortingType",action:Ce},re),$("#finalRatingHeader").attr("data-val",2).on("click",{optionList:Q,optionSelector:"#sortingSelector",optionConfig:"sortingType",action:Ce},re);let M=$($("#localeButton").next(".dropdownContent").get(0)),W="";Object.keys(ge).forEach(function(y){W+=`<a data-val="${y}"${y==h.config.locale?' class="current"':""}>${ge[y]}</a>`}),M.append($(W).on("click",Ot)),$("#mechbaySpaceDenominator").text(ae()),$("#avgStart, #avgLength, #avgRepeats, #avgThreads").each((y,T)=>{$(T).val(h.config[T.dataset.field])}),$("#avgPrecise, #avgEdenTax").each((y,T)=>{$(T).prop("checked",h.config[T.dataset.field])}),C.update.sorting(),C.update.prepared(),C.update.calcVisibility(),C.update.infoTableVisibility()}function L(e){if(!e||e.data?.not){$(".statusButton").each((t,s)=>{$(s).parent().toggleClass("highlight",!1).toggleClass("dangerlight",!1)});return}$(".statusButton").each((t,s)=>{let a=$(s).val();e.data.equip&&n.statusTable[a]?.equip[e.currentTarget.dataset.val]?$(s).parent().toggleClass("highlight",!0):e.data.chassis&&n.statusTable[a]?.chassis[e.currentTarget.dataset.val]?n.statusTable[a].chassis[e.currentTarget.dataset.val]<0?$(s).parent().toggleClass("highlight",!0):$(s).parent().toggleClass("dangerlight",!0):e.data.size&&n.statusTable[a]?.size[e.currentTarget.dataset.val]?n.statusTable[a].size[e.currentTarget.dataset.val]>0&&$(s).parent().toggleClass("dangerlight",!0):$(s).parent().toggleClass("highlight",!1).toggleClass("dangerlight",!1)})}function ie(e){if(!e||e.data?.not||!e.data.target){$(".hightarget").toggleClass("hightarget",!1);return}$(e.data.target).parent().toggleClass("hightarget",!0)}function Te(e){r.portal.spire.type=e;let t=$($("#spireTerrain").next(".dropdownContent").get(0));t.children(".current").removeClass("current"),t.find(`[data-val="${e}"]`).addClass("current")}function _e(e){r.portal.spire.boss=e;let t=$("#bossList");t.children(".current").removeClass("current"),t.find(`[data-val="${e}"]`).addClass("current")}function Ge(e,t){let s=[];r.portal.spire?.status&&Object.keys(r.portal.spire.status).forEach(function(a){s.push(`[data-val="${a}"]`)}),$(".statusButton").each((a,l)=>{let o=$($(l).next(".dropdownContent").get(0));o.children(".current").removeClass("current"),s.length>0&&o.find(s.join(",")).addClass("current")})}function Pt(e){Te(e.currentTarget.dataset.val),C.update.terrain(),n.draw(),n.drawBasicTable(),j()}function Ft(e){_e(e.currentTarget.dataset.val),C.update.boss(),n.draw(),n.drawBasicTable(),j()}function Dt(e){let t=e.currentTarget.dataset.val;if(t&&r.portal.spire?.status&&r.portal.spire.status[t]==!0){E("info","Hazard is already present");return}let s=$($(".statusButton").get(e.data.index));t?(s.parent().toggleClass("inactive",!1),s.text(b(`portal_spire_status_${t}`))):(s.parent().toggleClass("inactive",!0),s.text("\u{1F7AD}")),r.portal.spire?.status&&(delete r.portal.spire.status[s.val()],t&&(r.portal.spire.status[t]=!0)),Ge(-1,t),s.val(t),n.draw(),n.drawBasicTable(),j()}function Ot(e){!e.currentTarget.dataset.val||!ge[e.currentTarget.dataset.val]||(h.config.locale=e.currentTarget.dataset.val,r.settings.locale=e.currentTarget.dataset.val,_(),window.location.reload())}function re(e){let t=e.data.optionList[e.currentTarget.dataset.val].val;t!=h.config[e.data.optionConfig]&&($(e.data.optionSelector).text(e.data.optionList[e.currentTarget.dataset.val].short).val(t),h.config[e.data.optionConfig]=t,_(),e.data.action&&e.data.action())}function dt(e){let t=(h.config[e.data.optionConfig]+1)%e.data.optionList.length;$(e.data.optionSelector).html(e.data.optionList[t].short).val(t),h.config[e.data.optionConfig]=t,_(),e.data.action&&e.data.action()}function He(e,t){let s=b(`${this}${e}`),a=b(`${this}${t}`);return s>a?1:s<a?-1:0}var Bt=He.bind("portal_spire_type_"),Nt=He.bind("portal_mech_boss_"),It=He.bind("portal_spire_status_");function E(e,t,s,a=[]){let l=1e3;switch(e){case"success":case"info":l=1500,l*=N(1,2,(t.length-15)/25);break;case"error":l=2e3;break;default:return}if(s&&$(`#${s}`).length>0)return;let o=$(`<div class="${e}"${s?`id="${s}"`:""}>${t}</div>`);$("#messageBox").append(o),setTimeout(()=>{o.fadeOut(500,()=>{o.remove()})},l)}function pt(e){if(e.currentTarget?.dataset){let t=$(e.currentTarget).val();switch(e.currentTarget.dataset.field){case"avgStart":case"avgLength":case"avgRepeats":let s=parseInt(t);if(isNaN(s))return;h.config[e.currentTarget.dataset.field]=s,_();break;case"avgThreads":let a=parseInt(t);if(isNaN(a))return;h.config[e.currentTarget.dataset.field]=Math.max(1,Math.min(Ve,a)),_();break;case"avgEdenTax":case"preciseMedians":h.config[e.currentTarget.dataset.field]=!!e.currentTarget.checked,_();break}}}function Rt(){$("[data-locale-string]").each((e,t)=>{if(t.dataset.localeString)switch(t.dataset.localeString){case"portal_spire_type":case"portal_spire_hazard":let s=b(t.dataset.localeString);s=s.split(/[:：]+/)[0],s=s.split("\uFF1A")[0],$(t).text(s);break;case"portal_mech_size_small":h.config.locale!="en-US"?$(t).text(b(t.dataset.localeString)+" #"):$(t).text(b(t.dataset.localeString)+"s");break;default:$(t).text(b(t.dataset.localeString))}})}var lt=[];function jt(){$(".dropdownButton").on("click",e=>{let t=$(e.currentTarget).next(".dropdownContent").get(0);$(".dropdownContent").each((l,o)=>{o!=t&&$(o).toggleClass("show",!1)}),$(t).toggleClass("right",!1).toggleClass("show");let s=t.getBoundingClientRect(),a=s.x+s.width-document.body.getBoundingClientRect().width;$(t).toggleClass("right",a>0)}),$(".dropdownContent.popbox").on("click",e=>{e.stopPropagation()}),$(window).on("click",e=>{e.target.matches(".dropdownButton")||($(".dropdownContent").toggleClass("show",!1),h.dispatchEvent(h.EV_CLOSE_DROPDOWNS))})}function Wt(){$("#parseSaveString").on("click",e=>{ht()}),$("#saveString").on("keyup",e=>{e.which==13&&ht()}),$("#spireCount").on("input",e=>{!r||!r.portal?.spire||(r.portal.spire.count=parseInt($("#spireCount").val()),_(),n.draw(),n.drawBasicTable(),j())}),$("#scouts").on("input",e=>{!r||!r.portal?.mechbay||(r.portal.mechbay.scouts=parseInt($("#scouts").val()),_(),j())}),$("#resets").on("input",e=>{!r||!r.portal?.mechbay||(r.stats.reset=parseInt($("#resets").val()),_(),n.draw(),n.drawBasicTable(),j())}),$("#wrathlvl").on("input",e=>{!r||!r.blood||(r.blood.wrath=parseInt($("#wrathlvl").val()),_(),j())}),$("#gladiatorlvl").on("input",e=>{!r||!r.stats.achieve.gladiator||(r.stats.achieve.gladiator.l=parseInt($("#gladiatorlvl").val()),_(),j())}),$("#prepared").on("input",e=>{!r||!r.blood||(r.blood.prepared=parseInt($("#prepared").val()),C.update.prepared(),n.setPrepared(r.blood.prepared),_(),j())}),$("#warlord").on("click",e=>{!r||!r.race||(r.race.warlord=!r.race.warlord,n.setWarlord(r.race.warlord),C.update.warlord(),_(),n.drawBasicTable(),j())}),$("#openCalculator").on("click",e=>{let t=$("#openCalculator").hasClass("action");h.config.calculatorVisibility=!t,C.update.calcVisibility(),_()}),$("#showInfoTable").on("click",e=>{h.config.showInfoTable=!h.config.showInfoTable,C.update.infoTableVisibility(),_()}),$("#avgStart, #avgLength, #avgRepeats, #avgThreads").on("input",pt),$("#avgPrecise, #avgEdenTax").on("change",pt),$("#avgSimForm").on("submit",_t),n.callbacks.saveMech=Mt,Ae=$("#goToTop").on("click",e=>{window.scroll({top:0,behavior:"instant"})}),$(window).on("scroll",e=>{document.body.scrollTop<mt&&document.documentElement.scrollTop<mt?Ae.hide():Ae.show()})}var C={update:{spireCount(){$("#spireCount").val(r.portal.spire.count)},terrain(){$("#spireTerrain").val(r.portal.spire.type).text(b(`portal_spire_type_${r.portal.spire.type}`))},boss(){$("#spireBoss").val(r.portal.spire.boss).text(b(`portal_mech_boss_${r.portal.spire.boss}`))},hazards(){let e=[];Object.keys(r.portal.spire.status).forEach(function(t){e.push(t)}),$(".statusButton").text(t=>t<e.length?b(`portal_spire_status_${e[t]}`):"\u{1F7AD}"),$(".statusButton").each((t,s)=>{t<e.length?($(s).val(e[t]),$(s).parent().toggleClass("inactive",!1)):($(s).val(0),$(s).parent().toggleClass("inactive",!0))})},warlord(){$("#warlord").text(r.race.warlord?"\u2714":"\u{1F7AD}").parent().toggleClass("faded",!r.race.warlord),$("#terrainTable").toggleClass("warlord",r.race.warlord==!0)},prepared(){$("#mechLists").toggleClass("prepared-3",r.blood.prepared==3)},sorting(){$("#sortingDirection").parent().toggleClass("faded",h.config.sortingType==0||h.config.sortingType==4),$("#groupingSelector").parent().toggleClass("faded",h.config.sortingType==0||h.config.sortingType==4||h.config.groupingType==0),$("#mechLists, #mechListHeader, #mechConstructor").toggleClass("sortedByFactor",h.config.sortingType==1).toggleClass("sortedByRating",h.config.sortingType==2).toggleClass("isSorted",h.config.sortingType!=0&&h.config.sortingType!=4)},mathStyle(){$("body").children("section").attr("class",ue[h.config.mathVisStyle].val)},calcVisibility(){$("#avgCalculator").toggleClass("show",h.config.calculatorVisibility),$("#openCalculator").toggleClass("action",h.config.calculatorVisibility),$("#mechListHeader").toggleClass("shadowed",h.config.calculatorVisibility)},infoTableVisibility(){$("#showInfoTable").html(Ke[h.config.showInfoTable?0:1].short).parent().toggleClass("faded",!h.config.showInfoTable),$("#infoTable").toggleClass("show",h.config.showInfoTable)},calcEdenTax(){$("#avgEdenTaxLabel").toggle(r.eden?.mech_station?.mechs>0)}}},Ae,mt=160;(()=>{let e;h.localStorage&&(e=localStorage.getItem(h.LS_SString)),e&&e.length>0&&$("#saveString").val(e),$("#saveString").on("focus",t=>{t.target.select()}),console.log(r),$("html").attr("lang",h.config.locale),$("#prepared").val(r.blood.prepared),$("#wrathlvl").val(r.blood.wrath),$("#gladiatorlvl").val(r.stats.achieve.gladiator.l),$("#scouts").val(r.portal.mechbay.scouts),$("#resets").val(r.stats.reset),C.update.spireCount(),C.update.warlord(),C.update.mathStyle(),n.setSize(h.config.defaultMSize),n.setType(h.config.defaultMType),n.setWarlord(r.race.warlord),ut(),setTimeout(qt,0),setTimeout(n.init,0),setTimeout(()=>{c.init(),C.update.calcEdenTax()},0),setTimeout(i.init,0),jt(),Rt(),Wt(),h.localStorage||E("error","Local Storage is not available")})();export{lt as closeDropdownActions,L as highlightHazards,ie as highlightTarget,ct as importFloorum,ht as importSaveString,E as inform,R as isSpireSetup};
