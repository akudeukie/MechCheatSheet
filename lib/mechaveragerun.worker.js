var Q=(()=>{try{return typeof window<"u"?window.localStorage:{getItem(){return""},setItem(){}}}catch{return{getItem(){return""},setItem(){}}}})(),a={seed:1,warseed:1,resource:{},evolution:{},tech:{},city:{},space:{},interstellar:{},portal:{},eden:{},tauceti:{},civic:{},race:{},genes:{},blood:{},stats:{start:Date.now(),days:0,tdays:0},event:{t:200,l:!1},m_event:{t:499,l:!1}};Math.rand=function(e,l){return Math.floor(Math.random()*(l-e))+e};a.seed=2;a.warseed=2;function o(e,l,s,i){l=l||1,e=e||0;let n=((i||a[s?"warseed":"seed"])*9301+49297)%233280,t=n/233280;return i||(a[s?"warseed":"seed"]=n),e+t*(l-e)}function N(e){a=e}a.version||(a.version="0.2.0");a.version="1.4.8";delete a.revision;delete a.beta;a.settings||(a.settings={showEvolve:!0,showAchieve:!1,animated:!0,disableReset:!1,font:"standard",q_merge:"merge_nearby",cLabels:!0,theme:"gruvboxDark",locale:"en-US",icon:"star"});a.eden||(a.eden={});a.settings.locale||(a.settings.locale="en-US");function X(){["reset","plasmid","antiplasmid","universes","phage","starved","tstarved","died","tdied","sac","tsac","know","tknow","portals","dkills","attacks","cfood","tfood","cstone","tstone","clumber","tlumber","mad","bioseed","cataclysm","blackhole","ascend","descend","apotheosis","terraform","aiappoc","matrix","retire","eden","geck","dark","harmony","blood","cores","artifact","supercoiled","cattle","tcattle","murders","tmurders","psykill","tpsykill","pdebt","uDead"].forEach(function(e){a.stats.hasOwnProperty(e)||(a.stats[e]=0)}),a.stats.achieve||(a.stats.achieve={}),a.stats.feat||(a.stats.feat={}),a.stats.hasOwnProperty("womling")||(a.stats.womling={god:{l:0},lord:{l:0},friend:{l:0}}),a.stats.spire||(a.stats.spire={}),a.stats.synth||(a.stats.synth={}),a.stats.hasOwnProperty("banana")||(a.stats.banana={b1:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b2:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b3:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b4:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b5:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1}}),a.stats.hasOwnProperty("endless_hunger")||(a.stats.endless_hunger={b1:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b2:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b3:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b4:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1},b5:{l:!1,h:!1,a:!1,e:!1,m:!1,mg:!1}}),a.stats.hasOwnProperty("death_tour")||(a.stats.death_tour={ct:{l:0,h:0,a:0,e:0,m:0,mg:0},bh:{l:0,h:0,a:0,e:0,m:0,mg:0},di:{l:0,h:0,a:0,e:0,m:0,mg:0},ai:{l:0,h:0,a:0,e:0,m:0,mg:0},vc:{l:0,h:0,a:0,e:0,m:0,mg:0},md:{l:0,h:0,a:0,e:0,m:0,mg:0}}),a.stats.death_tour&&!a.stats.death_tour.hasOwnProperty("md")&&(a.stats.death_tour.md={l:0,h:0,a:0,e:0,m:0,mg:0}),a.stats.warlord||(a.stats.warlord={k:!1,p:!1,a:!1,r:!1,g:!1})}X();a.race.universe||(a.race.universe="standard");a.settings.affix||(a.settings.affix="si");var R={fire_elm:{weapon:{laser:1.05,flame:0,plasma:.25,kinetic:.5,missile:.5,sonic:1,shotgun:.75,tesla:.65,claws:.5,venom:.62,cold:1.25,shock:.68,fire:0,acid:.25,stone:.5,iron:.5,flesh:.3,ice:1.12,magma:0,axe:.5,hammer:.5},nozone:{freeze:!0,flooded:!0},amp:{hot:1.75,humid:.8,steam:.9}},water_elm:{weapon:{laser:.65,flame:.5,plasma:1,kinetic:.2,missile:.5,sonic:.5,shotgun:.25,tesla:.75,claws:.4,venom:.8,cold:1.1,shock:.68,fire:.8,acid:.25,stone:.4,iron:.3,flesh:.5,ice:1.1,magma:.75,axe:.45,hammer:.45},nozone:{hot:!0,freeze:!0},amp:{steam:1.5,river:1.1,flooded:2,rain:1.75,humid:1.25}},rock_golem:{weapon:{laser:1,flame:.5,plasma:1,kinetic:.65,missile:.95,sonic:.75,shotgun:.35,tesla:0,claws:.7,venom:.25,cold:.35,shock:0,fire:.9,acid:1,stone:.5,iron:.65,flesh:.3,ice:.3,magma:.9,axe:.2,hammer:1},nozone:{},amp:{}},bone_golem:{weapon:{laser:.45,flame:.35,plasma:.55,kinetic:1,missile:1,sonic:.75,shotgun:.75,tesla:.15,claws:.75,venom:0,cold:.2,shock:.15,fire:.4,acid:.85,stone:.9,iron:1,flesh:.15,ice:.3,magma:.9,axe:.65,hammer:1.2},nozone:{},amp:{}},mech_dino:{weapon:{laser:.85,flame:.05,plasma:.55,kinetic:.45,missile:.5,sonic:.35,shotgun:.5,tesla:1,claws:.38,venom:.1,cold:.5,shock:1.1,fire:.5,acid:.75,stone:.5,iron:.5,flesh:.15,ice:.3,magma:.9,axe:.6,hammer:.4},nozone:{},amp:{}},plant:{weapon:{laser:.42,flame:1,plasma:.65,kinetic:.2,missile:.25,sonic:.75,shotgun:.35,tesla:.38,claws:.25,venom:.25,cold:.65,shock:.28,fire:1,acid:.45,stone:.6,iron:.5,flesh:.5,ice:.55,magma:1,axe:.25,hammer:.15},nozone:{},amp:{}},crazed:{weapon:{laser:.5,flame:.85,plasma:.65,kinetic:1,missile:.35,sonic:.15,shotgun:.95,tesla:.6,claws:1,venom:.5,cold:.5,shock:.75,fire:.5,acid:.5,stone:.7,iron:.8,flesh:.9,ice:.4,magma:.5,axe:1,hammer:.75},nozone:{},amp:{}},minotaur:{weapon:{laser:.32,flame:.5,plasma:.82,kinetic:.44,missile:1,sonic:.15,shotgun:.2,tesla:.35,claws:.6,venom:1.1,cold:.5,shock:.3,fire:.5,acid:1,stone:.6,iron:.9,flesh:.3,ice:.4,magma:.55,axe:.75,hammer:.6},nozone:{},amp:{}},ooze:{weapon:{laser:.2,flame:.65,plasma:1,kinetic:0,missile:0,sonic:.85,shotgun:0,tesla:.15,claws:0,venom:.15,cold:1.5,shock:.2,fire:.6,acid:.5,stone:0,iron:0,flesh:0,ice:1.25,magma:.7,axe:0,hammer:0},nozone:{},amp:{}},zombie:{weapon:{laser:.35,flame:1,plasma:.45,kinetic:.08,missile:.8,sonic:.18,shotgun:.95,tesla:.05,claws:.85,venom:0,cold:.2,shock:.35,fire:.95,acid:.5,stone:.5,iron:.5,flesh:.35,ice:.25,magma:.9,axe:1,hammer:.5},nozone:{},amp:{}},raptor:{weapon:{laser:.68,flame:.55,plasma:.85,kinetic:1,missile:.44,sonic:.22,shotgun:.33,tesla:.66,claws:.85,venom:.5,cold:.5,shock:.88,fire:.6,acid:.6,stone:1,iron:.85,flesh:.45,ice:.5,magma:.65,axe:.9,hammer:.6},nozone:{},amp:{}},frost_giant:{weapon:{laser:.9,flame:.82,plasma:1,kinetic:.25,missile:.08,sonic:.45,shotgun:.28,tesla:.5,claws:.35,venom:.15,cold:0,shock:.6,fire:1.2,acid:.5,stone:.35,iron:1,flesh:.3,ice:0,magma:1.1,axe:.5,hammer:1},nozone:{hot:!0},amp:{freeze:2.5,hail:1.65}},swarm:{weapon:{laser:.02,flame:1,plasma:.04,kinetic:.01,missile:.08,sonic:.66,shotgun:.38,tesla:.45,claws:.05,venom:.01,cold:.8,shock:.75,fire:.8,acid:.75,stone:.03,iron:.03,flesh:.03,ice:.3,magma:.5,axe:.01,hammer:.05},nozone:{},amp:{}},dragon:{weapon:{laser:.18,flame:0,plasma:.12,kinetic:.35,missile:1,sonic:.22,shotgun:.65,tesla:.15,claws:.38,venom:.88,cold:.8,shock:.35,fire:0,acid:.85,stone:.03,iron:.03,flesh:.03,ice:.3,magma:0,axe:.4,hammer:.55},nozone:{},amp:{}},mech_dragon:{weapon:{laser:.84,flame:.1,plasma:.68,kinetic:.18,missile:.75,sonic:.22,shotgun:.28,tesla:1,claws:.28,venom:0,cold:.35,shock:1,fire:.15,acid:.72,stone:.5,iron:.5,flesh:.5,ice:.2,magma:.15,axe:.25,hammer:.8},nozone:{},amp:{}},construct:{weapon:{laser:.5,flame:.2,plasma:.6,kinetic:.34,missile:.9,sonic:.08,shotgun:.28,tesla:1,claws:.28,venom:0,cold:.45,shock:1.1,fire:.22,acid:.68,stone:.55,iron:.55,flesh:.4,ice:.4,magma:.18,axe:.42,hammer:.95},nozone:{},amp:{}},beholder:{weapon:{laser:.75,flame:.15,plasma:1,kinetic:.45,missile:.05,sonic:.01,shotgun:.12,tesla:.3,claws:.48,venom:.9,cold:.88,shock:.24,fire:.18,acid:.9,stone:.72,iron:.45,flesh:.85,ice:.92,magma:.16,axe:.44,hammer:.08},nozone:{},amp:{}},worm:{weapon:{laser:.55,flame:.38,plasma:.45,kinetic:.2,missile:.05,sonic:1,shotgun:.02,tesla:.01,claws:.18,venom:.65,cold:1,shock:.02,fire:.38,acid:.48,stone:.22,iron:.24,flesh:.35,ice:1,magma:.4,axe:.15,hammer:.05},nozone:{},amp:{}},hydra:{weapon:{laser:.85,flame:.75,plasma:.85,kinetic:.25,missile:.45,sonic:.5,shotgun:.6,tesla:.65,claws:.3,venom:.65,cold:.55,shock:.65,fire:.75,acid:.85,stone:.25,iron:.15,flesh:.2,ice:.55,magma:.75,axe:.45,hammer:.65},nozone:{},amp:{}},colossus:{weapon:{laser:1,flame:.05,plasma:.75,kinetic:.45,missile:1,sonic:.35,shotgun:.35,tesla:.5,claws:.48,venom:.22,cold:.25,shock:.65,fire:.15,acid:.95,stone:.55,iron:.95,flesh:.25,ice:.35,magma:.2,axe:.55,hammer:.35},nozone:{},amp:{}},lich:{weapon:{laser:.1,flame:.1,plasma:.1,kinetic:.45,missile:.75,sonic:.35,shotgun:.75,tesla:.5,claws:.4,venom:.01,cold:.1,shock:.5,fire:.1,acid:.1,stone:.35,iron:.25,flesh:.95,ice:.1,magma:.1,axe:.4,hammer:1},nozone:{},amp:{}},ape:{weapon:{laser:1,flame:.95,plasma:.85,kinetic:.5,missile:.5,sonic:.05,shotgun:.35,tesla:.68,claws:.65,venom:.95,cold:.5,shock:.5,fire:.75,acid:.65,stone:.5,iron:.5,flesh:.5,ice:.5,magma:.75,axe:.65,hammer:.5},nozone:{},amp:{}},bandit:{weapon:{laser:.65,flame:.5,plasma:.85,kinetic:1,missile:.5,sonic:.25,shotgun:.75,tesla:.25,claws:1,venom:.15,cold:.5,shock:.25,fire:.5,acid:.5,stone:.5,iron:.8,flesh:.5,ice:.5,magma:.5,axe:1,hammer:.5},nozone:{},amp:{}},croc:{weapon:{laser:.65,flame:.05,plasma:.6,kinetic:.5,missile:.5,sonic:1,shotgun:.2,tesla:.75,claws:1,venom:.5,cold:1,shock:.75,fire:.05,acid:.08,stone:.6,iron:.5,flesh:.25,ice:.95,magma:.05,axe:.75,hammer:.5},nozone:{},amp:{}},djinni:{weapon:{laser:0,flame:.35,plasma:1,kinetic:.15,missile:0,sonic:.65,shotgun:.22,tesla:.4,claws:.18,venom:.12,cold:.9,shock:.45,fire:.3,acid:.1,stone:.2,iron:.95,flesh:.2,ice:.9,magma:.3,axe:.12,hammer:0},nozone:{},amp:{}},snake:{weapon:{laser:.5,flame:.5,plasma:.5,kinetic:.5,missile:.5,sonic:.5,shotgun:.5,tesla:.5,claws:.5,venom:.02,cold:.75,shock:.5,fire:.5,acid:.5,stone:.5,iron:.5,flesh:.5,ice:.75,magma:.5,axe:.5,hammer:.5},nozone:{},amp:{}},centipede:{weapon:{laser:.5,flame:.85,plasma:.95,kinetic:.65,missile:.6,sonic:0,shotgun:.5,tesla:.01,claws:.65,venom:.01,cold:0,shock:.01,fire:.88,acid:.95,stone:.6,iron:.45,flesh:.55,ice:0,magma:.88,axe:.7,hammer:.4},nozone:{},amp:{}},spider:{weapon:{laser:.65,flame:1,plasma:.22,kinetic:.75,missile:.15,sonic:.38,shotgun:.9,tesla:.18,claws:.12,venom:.05,cold:.5,shock:.32,fire:1,acid:.65,stone:.8,iron:.5,flesh:.5,ice:.5,magma:1,axe:.18,hammer:.75},nozone:{},amp:{}},manticore:{weapon:{laser:.05,flame:.25,plasma:.95,kinetic:.5,missile:.15,sonic:.48,shotgun:.4,tesla:.6,claws:.5,venom:.5,cold:.8,shock:.75,fire:.15,acid:.95,stone:.25,iron:.5,flesh:.8,ice:.8,magma:.15,axe:.5,hammer:.25},nozone:{},amp:{}},fiend:{weapon:{laser:.75,flame:.25,plasma:.5,kinetic:.25,missile:.75,sonic:.25,shotgun:.5,tesla:.5,claws:.65,venom:.1,cold:.65,shock:.5,fire:.2,acid:.5,stone:.25,iron:.75,flesh:1,ice:.65,magma:.2,axe:.75,hammer:.25},nozone:{},amp:{}},bat:{weapon:{laser:.16,flame:.18,plasma:.12,kinetic:.25,missile:.02,sonic:1,shotgun:.9,tesla:.58,claws:.1,venom:.1,cold:.8,shock:.65,fire:.15,acid:.5,stone:.1,iron:.1,flesh:.5,ice:.8,magma:.2,axe:.1,hammer:.1},nozone:{},amp:{}},medusa:{weapon:{laser:.35,flame:.1,plasma:.3,kinetic:.95,missile:1,sonic:.15,shotgun:.88,tesla:.26,claws:.42,venom:.3,cold:.48,shock:.28,fire:.1,acid:.85,stone:1,iron:.25,flesh:.75,ice:.52,magma:.12,axe:.34,hammer:1},nozone:{},amp:{}},ettin:{weapon:{laser:.5,flame:.35,plasma:.8,kinetic:.5,missile:.25,sonic:.3,shotgun:.6,tesla:.09,claws:.5,venom:.95,cold:.3,shock:.8,fire:.38,acid:.9,stone:.6,iron:.75,flesh:.4,ice:.28,magma:.32,axe:.45,hammer:.25},nozone:{},amp:{}},faceless:{weapon:{laser:.6,flame:.28,plasma:.6,kinetic:0,missile:.05,sonic:.8,shotgun:.15,tesla:1,claws:.02,venom:.01,cold:0,shock:1,fire:.25,acid:.55,stone:.15,iron:.15,flesh:.95,ice:0,magma:.25,axe:.01,hammer:.05},nozone:{},amp:{}},enchanted:{weapon:{laser:1,flame:.02,plasma:.95,kinetic:.2,missile:.7,sonic:.05,shotgun:.65,tesla:.01,claws:.1,venom:0,cold:.5,shock:.01,fire:.02,acid:1,stone:.25,iron:.75,flesh:.1,ice:.5,magma:.03,axe:.1,hammer:.5},nozone:{},amp:{}},gargoyle:{weapon:{laser:.15,flame:.4,plasma:.3,kinetic:.5,missile:.5,sonic:.85,shotgun:1,tesla:.2,claws:.45,venom:.05,cold:.15,shock:.08,fire:.38,acid:.85,stone:1,iron:.85,flesh:.25,ice:.15,magma:.35,axe:.42,hammer:1},nozone:{},amp:{}},chimera:{weapon:{laser:.38,flame:.6,plasma:.42,kinetic:.85,missile:.35,sonic:.5,shotgun:.65,tesla:.8,claws:.92,venom:.5,cold:.45,shock:.8,fire:.56,acid:.4,stone:.5,iron:.5,flesh:.5,ice:.48,magma:.54,axe:.88,hammer:.42},nozone:{},amp:{}},gorgon:{weapon:{laser:.65,flame:.65,plasma:.64,kinetic:.65,missile:.66,sonic:.65,shotgun:.65,tesla:.65,claws:.65,venom:.65,cold:.65,shock:.65,fire:.65,acid:.65,stone:.65,iron:.65,flesh:.65,ice:.65,magma:.65,axe:.65,hammer:.65},nozone:{},amp:{}},kraken:{weapon:{laser:.75,flame:.35,plasma:.75,kinetic:.35,missile:.5,sonic:.18,shotgun:.05,tesla:.85,claws:.32,venom:.8,cold:.66,shock:.82,fire:.33,acid:.75,stone:.45,iron:.35,flesh:.4,ice:.66,magma:.33,axe:.36,hammer:.5},nozone:{},amp:{}},homunculus:{weapon:{laser:.05,flame:1,plasma:.1,kinetic:.85,missile:.65,sonic:.5,shotgun:.75,tesla:.2,claws:.85,venom:.4,cold:.12,shock:.22,fire:1,acid:.13,stone:.65,iron:.68,flesh:.95,ice:.18,magma:.9,axe:.85,hammer:.65},nozone:{},amp:{}},giant_chicken:{weapon:{laser:.95,flame:.95,plasma:.95,kinetic:.95,missile:.95,sonic:.95,shotgun:.95,tesla:.95,claws:.95,venom:.96,cold:.95,shock:.95,fire:.95,acid:.95,stone:.95,iron:.95,flesh:.94,ice:.95,magma:.95,axe:.95,hammer:.95},nozone:{},amp:{}},skeleton_pack:{weapon:{laser:.5,flame:.1,plasma:.5,kinetic:1,missile:1.2,sonic:.5,shotgun:1.05,tesla:.2,claws:.65,venom:0,cold:.11,shock:.22,fire:.1,acid:.5,stone:1,iron:.65,flesh:.25,ice:.1,magma:.12,axe:.15,hammer:1.08},nozone:{},amp:{}}};function F(e,l){let s=R[e].weapon[l],i=a.stats.reset+(a.portal?.spire?.count||1),r=Math.floor(o(0,25e3,!1,i+(a.portal?.spire?.count||1)*2)),n=Math.floor(o(0,25e3,!1,i+a.stats.reset*2)),t=a.race.warlord?["laser","kinetic","shotgun","missile","flame","plasma","sonic","tesla","claws","venom","cold","shock","fire","acid","stone","iron","flesh","ice","magma","axe","hammer"]:["laser","kinetic","shotgun","missile","flame","plasma","sonic","tesla"],d=t[Math.floor(o(0,t.length,!1,r))],h=t[Math.floor(o(0,t.length,!1,n))];if(l===d){let c=Math.floor(o(0,25e3,!1,r+(a.portal?.spire?.count||1)*3));s-=Math.floor(o(0,26,!1,c))/100,s<0&&(s=0)}else if(l===h){let c=Math.floor(o(0,25e3,!1,n+a.stats.reset*3));s+=Math.floor(o(0,26,!1,c))/100}return s}function D(){let e=["sand","swamp","forest","jungle","rocky","gravel","muddy","grass","brush","concrete"];if(a.portal.spire.type=e[Math.floor(o(0,e.length))],a.portal.spire.count>=10){a.portal.spire.status={};let s=["freeze","hot","corrosive","humid","windy","hilly","mountain","radioactive","quake","dust","river","tar","steam","flooded","fog","rain","hail","chasm","dark","gravity"];if(f(s[Math.floor(o(0,s.length))]),a.portal.spire.count>=25&&a.portal.spire.count<=100){let i=105-a.portal.spire.count;Math.floor(o(0,i)<=5)&&f(s[Math.floor(o(0,s.length))])}else if(a.portal.spire.count>100&&a.portal.spire.count<=250){f(s[Math.floor(o(0,s.length))]);let i=260-a.portal.spire.count;Math.floor(o(0,i)<=10)&&f(s[Math.floor(o(0,s.length))])}else if(a.portal.spire.count>250&&a.portal.spire.count<=1e3){f(s[Math.floor(o(0,s.length))]),f(s[Math.floor(o(0,s.length))]);let i=1025-a.portal.spire.count;Math.floor(o(0,i)<=25)&&f(s[Math.floor(o(0,s.length))])}else a.portal.spire.count>1e3&&(f(s[Math.floor(o(0,s.length))]),f(s[Math.floor(o(0,s.length))]),f(s[Math.floor(o(0,s.length))]))}let l=Object.keys(R).filter(function(s){let i=Object.keys(R[s].nozone);return!(i.some(r=>Object.keys(a.portal.spire.status).includes(r))||i.includes(a.portal.spire.type))});a.portal.spire.boss=l[Math.floor(o(0,l.length))]}function f(e){a.portal.spire.status.freeze||a.portal.spire.status.hot?e!=="freeze"&&e!=="hot"&&(a.portal.spire.status[e]=!0):a.portal.spire.status.rain||a.portal.spire.status.hail?e!=="rain"&&e!=="hail"&&(a.portal.spire.status[e]=!0):a.portal.spire.status[e]=!0}function E(e,l,s){return e.equip.includes("special")&&(e.size==="small"||e.size==="medium"||e.size==="collector")&&l<1&&(l+=(1-l)*(s.includes("gravity")?.1:.2)),e.size!=="small"&&l<1&&(l+=(s.includes("fog")||s.includes("dark")?.005:.01)*a.portal.mechbay.scouts,l>1&&(l=1)),l}function v(e,l){return l<1&&l!==0&&e.equip.includes("special")&&e.size==="titan"&&(l+=(1-l)*.25),e.equip.includes("special")&&(e.size==="large"||e.size==="cyberdemon")&&(l*=1.02),l}function S(e,l){let s=1;switch(l){case"freeze":!e.equip.includes("radiator")&&!e.equip.includes("cold")&&(s=.25);break;case"hot":!e.equip.includes("coolant")&&!e.equip.includes("heat")&&(s=.25);break;case"corrosive":e.equip.includes("ablative")||(e.equip.includes("stoneskin")?s=.9:e.equip.includes("shields")?s=.75:s=e.equip.includes("manashield")?.5:.25);break;case"humid":e.equip.includes("seals")||(s=e.equip.includes("heat")?.85:.75);break;case"windy":["hover","flying_imp","harpy","dragon"].includes(e.chassis)&&(s=.5);break;case"hilly":["spider","flying_imp","harpy","dragon"].includes(e.chassis)||(s=.75);break;case"mountain":e.chassis!=="spider"&&!e.equip.includes("grapple")&&(s=e.equip.includes("flare")||e.equip.includes("echo")?.75:.5);break;case"radioactive":!e.equip.includes("shields")&&e.equip.includes("manashield")&&(s=.5);break;case"quake":e.equip.includes("stabilizer")||(s=e.equip.includes("athletic")?.75:.25);break;case"dust":!e.equip.includes("seals")&&!e.equip.includes("thermal")&&(s=.5);break;case"river":["hover","flying_imp","harpy","dragon"].includes(e.chassis)||(s=.65);break;case"tar":e.chassis!=="quad"&&(s=e.chassis==="tread"||e.chassis==="wheel"?.5:.75);break;case"steam":!e.equip.includes("shields")&&!e.equip.includes("heat")&&(s=.75);break;case"flooded":e.chassis!=="hover"&&(s=["snake"].includes(e.chassis)?.85:.35);break;case"fog":!e.equip.includes("sonar")&&!e.equip.includes("echo")&&(s=.2);break;case"rain":e.equip.includes("seals")||(s=e.equip.includes("cold")?.9:.75);break;case"hail":!e.equip.includes("ablative")&&!e.equip.includes("shields")&&!e.equip.includes("manashield")&&!e.equip.includes("stoneskin")&&(s=.75);break;case"chasm":!e.equip.includes("grapple")&&!["flying_imp","harpy","dragon"].includes(e.chassis)&&(s=e.equip.includes("athletic")?.35:.1);break;case"dark":!e.equip.includes("infrared")&&!e.equip.includes("darkvision")&&(s=e.equip.includes("flare")?.25:.1);break;case"gravity":{switch(e.size){case"fiend":case"medium":s=.8;break;case"cyberdemon":s=.5;case"large":s=.45;break;case"archfiend":s=.35;case"titan":s=.25;break}["flying_imp","harpy","dragon"].includes(e.chassis)&&(s-=.15),e.equip.includes("athletic")&&s<1&&(s+=.1)}break}return e.equip.includes("lucky")&&(s+=.01*Math.floor(o(1,10,!1,a.stats.resets+(a.portal?.spire?.count||1)*42)),s>1&&(s=1)),s}function j(e,l){let s=l||a.portal.spire.type,i=1;switch(e.chassis){case"wheel":case"nightmare":case"hound":switch(s){case"sand":i=["small","medium","minion","fiend"].includes(e.size)?.9:.85;break;case"swamp":i=["small","medium","minion","fiend"].includes(e.size)?.35:.18;break;case"jungle":i=["small","medium","minion","fiend"].includes(e.size)?.92:.85;break;case"rocky":i=["small","medium","minion","fiend"].includes(e.size)?.65:.5;break;case"gravel":i=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"muddy":i=["small","medium","minion","fiend"].includes(e.size)?.85:.58;break;case"grass":i=["small","medium","minion","fiend"].includes(e.size)?1.3:1.2;break;case"brush":i=["small","medium","minion","fiend"].includes(e.size)?.9:.8;break;case"concrete":i=["small","medium","minion","fiend"].includes(e.size)?1.1:1;break}break;case"tread":case"rakshasa":case"harpy":case"dragon":switch(s){case"sand":i=["small","medium","minion","fiend"].includes(e.size)?1.15:1.1;break;case"swamp":i=["small","medium","minion","fiend"].includes(e.size)?.55:.4;break;case"forest":i=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"jungle":i=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break;case"rocky":i=["small","medium","minion","fiend"].includes(e.size)?.65:.5;break;case"gravel":i=["small","medium","minion","fiend"].includes(e.size)?1.3:1.2;break;case"muddy":i=["small","medium","minion","fiend"].includes(e.size)?.88:.72;break}break;case"cambion":case"biped":case"imp":case"gorgon":switch(s){case"sand":i=["small","medium","minion","fiend"].includes(e.size)?.78:.65;break;case"swamp":i=["small","medium","minion","fiend"].includes(e.size)?.68:.5;break;case"forest":i=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"jungle":i=["small","medium","minion","fiend"].includes(e.size)?.82:.7;break;case"rocky":i=["small","medium","minion","fiend"].includes(e.size)?.48:.4;break;case"muddy":i=["small","medium","minion","fiend"].includes(e.size)?.85:.7;break;case"grass":i=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"brush":i=["small","medium","minion","fiend"].includes(e.size)?.92:.85;break}break;case"quad":case"golem":case"barghest":switch(s){case"sand":i=["small","medium","minion","fiend"].includes(e.size)?.86:.75;break;case"swamp":i=["small","medium","minion","fiend"].includes(e.size)?.58:.42;break;case"forest":i=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"rocky":i=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break;case"gravel":i=["small","medium","minion","fiend"].includes(e.size)?.9:.8;break;case"muddy":i=["small","medium","minion","fiend"].includes(e.size)?.68:.5;break;case"grass":i=["small","medium","minion","fiend"].includes(e.size)?1:.95;break;case"brush":i=["small","medium","minion","fiend"].includes(e.size)?.95:.9;break}break;case"spider":case"minotaur":case"hydra":switch(s){case"sand":i=["small","medium","minion","fiend"].includes(e.size)?.75:.65;break;case"swamp":i=["small","medium","minion","fiend"].includes(e.size)?.9:.78;break;case"forest":i=["small","medium","minion","fiend"].includes(e.size)?.82:.75;break;case"jungle":i=["small","medium","minion","fiend"].includes(e.size)?.77:.65;break;case"rocky":i=["small","medium","minion","fiend"].includes(e.size)?1.25:1.2;break;case"gravel":i=["small","medium","minion","fiend"].includes(e.size)?.86:.75;break;case"muddy":i=["small","medium","minion","fiend"].includes(e.size)?.92:.82;break;case"brush":i=["small","medium","minion","fiend"].includes(e.size)?1:.95;break}break;case"hover":case"flying_imp":case"snake":switch(s){case"swamp":i=["small","medium","minion","fiend"].includes(e.size)?1.35:1.2;break;case"forest":i=["small","medium","minion","fiend"].includes(e.size)?.65:.48;break;case"jungle":i=["small","medium","minion","fiend"].includes(e.size)?.55:.35;break;case"rocky":i=["small","medium","minion","fiend"].includes(e.size)?.82:.68;break;case"muddy":i=["small","medium","minion","fiend"].includes(e.size)?1.15:1.08;break;case"brush":i=["small","medium","minion","fiend"].includes(e.size)?.78:.7;break}break}return i}function $(e){switch(e){case"minion":return .0015;case"small":return .0025;case"fiend":return .006;case"medium":return .0075;case"cyberdemon":return .009;case"large":return .01;case"archfiend":return .011;case"titan":return .012;default:return 0}}function A(e,l){let s=$(e.size);if(s===0)return 0;if(e.hasOwnProperty("infernal")&&e.infernal&&a.blood.prepared&&a.blood.prepared>=3&&(s*=1.25),a.blood.wrath&&(s*=1+a.blood.wrath/20),e.size==="archfiend"&&e.chassis!="hydra"&&(s*=2),l){a.stats.achieve.gladiator&&a.stats.achieve.gladiator.l>0&&(s*=1+a.stats.achieve.gladiator.l*.1),(e.size==="titan"||e.size==="archfiend")&&(s*=1.1);let i=universeAffix();a.stats.spire.hasOwnProperty(i)&&a.stats.spire[i].hasOwnProperty("dlstr")?s/=100+a.stats.spire[i].dlstr*25:s/=100;let r=0;for(let n=0;n<e.hardpoint.length;n++)r+=s*v(e,1);return r}else{if(a.stats.achieve.gladiator&&a.stats.achieve.gladiator.l>0&&(s*=1+a.stats.achieve.gladiator.l*.2),a.portal.spire.type==="concrete")switch(e.size){case"minion":case"small":s*=.92;break;case"fiend":case"medium":s*=.95;break;case"archfiend":case"titan":s*=1.25;break}let i=j(e),r=[];Object.keys(a.portal.spire.status).forEach(function(t){r.push(t),s*=S(e,t)}),s*=E(e,i,r),s/=a.portal.spire.count;let n=0;for(let t=0;t<e.hardpoint.length;t++){let d=F(a.portal.spire.boss,e.hardpoint[t]);n+=s*v(e,d)}return n}}function P(){this.min=Number.MAX_VALUE,this.max=Number.MIN_VALUE,this.med=0,this.avg=0}function g(e,l,s,i){this.count=e,this.boss=l,this.type=s,this.status=structuredClone(i)}g.areEqual=function(e,l){if(!e||!l||e.count!=l.count||e.boss!=l.boss||e.type!=l.type)return!1;let s=Object.keys(e.status),i=Object.keys(l.status);if(s.length!=i.length)return!1;for(let r of s)if(!i.includes(r))return!1;return!0};function m(e){return e.length==0?0:e.length%2==0?(e[e.length/2-1]+e[e.length/2])/2:e[(e.length+1)/2-1]}function C(e,l){return e-l}function W(e){if(!a||!a.portal?.spire||a.portal?.spire.boss=="")return 0;let l=1,s=j(e),i=[];return Object.keys(a.portal.spire.status).forEach(function(r){i.push(r),l*=S(e,r)}),l*=E(e,s,i),l}function G(e){if(!a||!a.portal?.spire||a.portal?.spire.boss==""||e.hardpoint.length==0)return 0;let l=0;for(let s=0;s<e.hardpoint.length;s++){let i=F(a.portal.spire.boss,e.hardpoint[s]);l+=v(e,i)}return l/e.hardpoint.length}onmessage=e=>{switch(e.data.a){case"start":Z(e.data);break;case"stop":J();break;default:let l=`>working hard>${e.data[0]} ${a.seed}`;postMessage(l);break}};var b=0,M,q=!1,z=75,_=!1,k=200,I=50,B=1,U;var K=0,y=0,w=1,p=0,V=0,x=!1;function Z(e){if(clearTimeout(M),_=!1,q=!0,e.mechs&&e.mechs.length>0&&e.global){b=e.wId,U=e.global,N(U),a.portal.mechbay={count:0,on:0,bay:0,max:0,active:0,scouts:0,mechs:[]},a.portal.mechbay.mechs=e.mechs,K=e.edenTax>0,y=e.edenTax||0;let l=0,s=0;for(let i of a.portal.mechbay.mechs)i.size!="collector"&&((i.size=="small"||i.size=="minion")&&(a.portal.mechbay.scouts++,i.equip.includes("scouter")&&a.portal.mechbay.scouts++),s<y?s++:l++);if(l==0){y>0?postMessage({a:"error",error:"mechs_busy"}):postMessage({a:"error",error:"no_mechs"});return}x=e.precise==!0,w=e.global.portal.spire.count||1,w=e.start,a.portal.spire.count=w,I=e.length,k=e.repeats,V=k*I,B=Math.min(Math.max(Math.round(k/100),1),15),p=0,M=setTimeout(H,200+e.wId*3)}else postMessage({a:"error",error:"no_mechs"})}function J(){_=!0,clearTimeout(M),q&&postMessage({a:"done",w:b}),q=!1}function H(){a.seed=Math.rand(0,1e4),a.warseed=Math.rand(0,1e4);let e=!0,l=[],s=[],i=new P,r=new P,n={e:new g(0,0,0,{}),t:new g(0,0,0,{})},t=Math.floor(p/z);for(var d=0;t*z+d<k;d++){a.portal.spire.status={},D();let c=0,T=0,O=0,L=0;for(var h=0;h<a.portal.mechbay.mechs.length;h++)if(a.portal.mechbay.mechs[h].size!="collector"){if(L<y){L++;continue}O+=A(a.portal.mechbay.mechs[h],!1),c=(G(a.portal.mechbay.mechs[h])*W(a.portal.mechbay.mechs[h])+T*c)/(T+1),T++}c>i.max&&(i.max=c),c<i.min&&(i.min=c,n.e=new g(a.portal.spire.count,a.portal.spire.boss,a.portal.spire.type,a.portal.spire.status)),i.avg=(c+i.avg*d)/(d+1),l.push(c);let u=O>0?100/O:0;if(u==0&&(r.max=-1,n.t=new g(a.portal.spire.count,a.portal.spire.boss,a.portal.spire.type,a.portal.spire.status)),r.max!==-1&&u>r.max&&(r.max=u,n.t=new g(a.portal.spire.count,a.portal.spire.boss,a.portal.spire.type,a.portal.spire.status)),u>0&&u<r.min&&(r.min=u),r.avg=((u>0?u:r.avg)+r.avg*d)/(d+1),s.push(u),p++,p%z==0)break}if(_){l.length=0,r.length=0,_=!1,postMessage({a:"done",w:b});return}if(p%z!=0&&(e=!1),l.sort(C),s.sort(C),l.length>4&&!x&&(i.med=[l[0],m(l.slice(0,Math.ceil(l.length/2))),m(l),m(l.slice(Math.floor(l.length/2))),l[l.length-1]],r.med=[s[0],m(s.slice(0,Math.ceil(s.length/2))),m(s),m(s.slice(0,Math.floor(s.length/2))),s[s.length-1]]),l.length>2&&!x?(i.med=[l[0],m(l),l[l.length-1]],r.med=[s[0],m(s),s[s.length-1]]):(i.med=m(l),r.med=m(s)),postMessage({a:"result",f:a.portal.spire.count,e:i,t:r,raw:x?{e:l,t:s}:null,slow:n}),(a.portal.spire.count+(a.portal.spire.count-w)*p)%B==0&&postMessage({a:"progress",w:b,progress:((a.portal.spire.count-w)*k+p/k)/V}),p>=k&&(a.portal.spire.count++,p=0),a.portal.spire.count-w>=I){postMessage({a:"progress",w:b,progress:1}),postMessage({a:"done",w:b}),q=!1,l.length=0,r.length=0;return}else M=setTimeout(H,e?5:0)}
